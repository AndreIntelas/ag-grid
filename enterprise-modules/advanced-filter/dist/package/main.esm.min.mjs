var Fe=Object.defineProperty,Ie=Object.defineProperties,Ne=Object.getOwnPropertyDescriptor,ke=Object.getOwnPropertyDescriptors,Pe=Object.getOwnPropertySymbols,Re=Object.prototype.hasOwnProperty,Ge=Object.prototype.propertyIsEnumerable,Ce=(e,t,i)=>t in e?Fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Q=(e,t)=>{for(var i in t||(t={}))Re.call(t,i)&&Ce(e,i,t[i]);if(Pe)for(var i of Pe(t))Ge.call(t,i)&&Ce(e,i,t[i]);return e},Y=(e,t)=>Ie(e,ke(t)),l=(e,t,i,r)=>{for(var s=r>1?void 0:r?Ne(t,i):t,a=e.length-1,n;a>=0;a--)(n=e[a])&&(s=(r?n(t,i,s):n(s))||s);return r&&s&&Fe(t,i,s),s};import{ModuleNames as We}from"@ag-grid-community/core";import{EnterpriseCoreModule as He}from"@ag-grid-enterprise/core";import{AgAutocomplete as U,Autowired as X,Component as Ue,PostConstruct as je,RefSelector as w,_ as A}from"@ag-grid-community/core";import{AgDialog as ye,Autowired as j,BeanStub as $e,Events as Z,PostConstruct as Ke,_ as ee}from"@ag-grid-community/core";import{Autowired as te,Component as qe,Events as Je,KeyCode as I,PostConstruct as ze,_ as T}from"@ag-grid-community/core";var N=class extends qe{constructor(e){super(`
            <div class="ag-advanced-filter-header" role="row">
            </div>`),this.enabled=e}postConstruct(){this.setupAdvancedFilter(this.enabled),this.addDestroyFunc(()=>this.destroyBean(this.eAdvancedFilter)),this.addManagedListener(this.eventService,Je.EVENT_GRID_COLUMNS_CHANGED,()=>this.onGridColumnsChanged()),this.addGuiEventListener("keydown",e=>this.onKeyDown(e)),this.addGuiEventListener("focusout",e=>{this.getFocusableElement().contains(e.relatedTarget)||this.focusService.clearAdvancedFilterColumn()})}getFocusableElement(){var e,t;return(t=(e=this.eAdvancedFilter)==null?void 0:e.getGui())!=null?t:this.getGui()}setEnabled(e){e!==this.enabled&&this.setupAdvancedFilter(e)}refresh(){var e;(e=this.eAdvancedFilter)==null||e.refresh()}getHeight(){return this.height}setInputDisabled(e){var t;(t=this.eAdvancedFilter)==null||t.setInputDisabled(e)}setupAdvancedFilter(e){const t=this.getGui();if(e){this.eAdvancedFilter=this.createBean(new E);const i=this.eAdvancedFilter.getGui();this.eAdvancedFilter.addCssClass("ag-advanced-filter-header-cell"),this.height=this.columnModel.getFloatingFiltersHeight();const r=`${this.height}px`;t.style.height=r,t.style.minHeight=r,this.setAriaRowIndex(),T.setAriaRole(i,"gridcell"),T.setAriaColIndex(i,1),this.setAriaColumnCount(i),t.appendChild(i)}else T.clearElement(t),this.destroyBean(this.eAdvancedFilter),this.height=0;T.setDisplayed(t,e),this.enabled=e}setAriaColumnCount(e){T.setAriaColSpan(e,this.columnModel.getAllGridColumns().length)}setAriaRowIndex(){T.setAriaRowIndex(this.getGui(),this.headerNavigationService.getHeaderRowCount())}onGridColumnsChanged(){this.eAdvancedFilter&&(this.setAriaColumnCount(this.eAdvancedFilter.getGui()),this.setAriaRowIndex())}onKeyDown(e){switch(e.key){case I.ENTER:{this.hasFocus()&&this.focusService.focusInto(this.getFocusableElement())&&e.preventDefault();break}case I.ESCAPE:this.hasFocus()||this.getFocusableElement().focus();break;case I.UP:this.navigateUpDown(!0,e);break;case I.DOWN:this.navigateUpDown(!1,e);break;case I.TAB:if(this.hasFocus())this.navigateLeftRight(e);else{const t=this.focusService.findNextFocusableElement(this.getFocusableElement(),null,e.shiftKey);t?(e.preventDefault(),t.focus()):this.navigateLeftRight(e)}break}}navigateUpDown(e,t){this.hasFocus()&&this.focusService.focusNextFromAdvancedFilter(e)&&t.preventDefault()}navigateLeftRight(e){(e.shiftKey?this.focusService.focusLastHeader():this.focusService.focusNextFromAdvancedFilter(!1,!0))&&e.preventDefault()}hasFocus(){return this.gridOptionsService.getDocument().activeElement===this.getFocusableElement()}};l([te("columnModel")],N.prototype,"columnModel",2),l([te("focusService")],N.prototype,"focusService",2),l([te("headerNavigationService")],N.prototype,"headerNavigationService",2),l([ze],N.prototype,"postConstruct",1);import{Autowired as $,Component as Qe,PostConstruct as Ye,RefSelector as ie,TooltipFeature as Xe,VirtualList as Ze,_ as xe}from"@ag-grid-community/core";import{Autowired as re,DragAndDropService as et,DragSourceType as tt,Events as se,KeyCode as ae,PostConstruct as it,RefSelector as P,TabGuardComp as rt,TooltipFeature as k,_ as h}from"@ag-grid-community/core";import{AgRichSelect as st,_ as K}from"@ag-grid-community/core";var Ae=class extends st{constructor(e){super(Y(Q({},e),{template:`
                <div class="ag-picker-field" role="presentation">
                    <div ref="eLabel"></div>
                    <div ref="eWrapper" class="ag-wrapper ag-picker-collapsed">
                        <div ref="eDisplayField" class="ag-picker-field-display"></div>
                        <ag-input-text-field ref="eInput" class="ag-rich-select-field-input"></ag-input-text-field>
                        <div ref="eIcon" class="ag-picker-field-icon" aria-hidden="true"></div>
                    </div>
                </div>`})),this.params=e}showPicker(){setTimeout(()=>super.showPicker())}hidePicker(){setTimeout(()=>super.hidePicker())}postConstruct(){super.postConstruct();const{wrapperClassName:e,ariaLabel:t}=this.params;K.setDisplayed(this.eDisplayField,!1),e&&this.eWrapper.classList.add(e),K.setAriaLabelledBy(this.eWrapper,""),K.setAriaLabel(this.eWrapper,t)}onEnterKeyDown(e){K.stopPropagationForAgGrid(e),this.isPickerDisplayed?super.onEnterKeyDown(e):(e.preventDefault(),this.showPicker())}};import{BeanStub as at,DragSourceType as nt,PostConstruct as ot,VirtualListDragFeature as lt}from"@ag-grid-community/core";var q=class fe extends at{constructor(t,i){super(),this.comp=t,this.virtualList=i}postConstruct(){this.createManagedBean(new lt(this.comp,this.virtualList,{dragSourceType:nt.AdvancedFilterBuilder,listItemDragStartEvent:fe.EVENT_DRAG_STARTED,listItemDragEndEvent:fe.EVENT_DRAG_ENDED,eventSource:this,getCurrentDragValue:t=>this.getCurrentDragValue(t),isMoveBlocked:()=>!1,getNumRows:t=>t.getNumItems(),moveItem:(t,i)=>this.moveItem(t,i)}))}getCurrentDragValue(t){return t.item}moveItem(t,i){this.comp.moveItem(t,i)}};q.EVENT_DRAG_STARTED="advancedFilterBuilderDragStarted",q.EVENT_DRAG_ENDED="advancedFilterBuilderDragEnded",l([ot],q.prototype,"postConstruct",1);var ne=q;import{BeanStub as dt,KeyCode as R,PostConstruct as pt,_ as M}from"@ag-grid-community/core";var oe=class extends dt{constructor(e,t,i){super(),this.eGui=e,this.focusWrapper=t,this.eFocusableComp=i}postConstruct(){this.addManagedListener(this.eGui,"keydown",e=>{switch(e.key){case R.TAB:e.defaultPrevented||M.stopPropagationForAgGrid(e);break;case R.UP:case R.DOWN:M.stopPropagationForAgGrid(e);break;case R.ESCAPE:if(M.isStopPropagationForAgGrid(e))return;const t=this.gridOptionsService.getDocument();this.eGui.contains(t.activeElement)&&(e.preventDefault(),M.stopPropagationForAgGrid(e),this.focusWrapper.focus());break}}),this.addManagedListener(this.focusWrapper,"keydown",e=>{switch(e.key){case R.ENTER:if(M.isStopPropagationForAgGrid(e))return;this.gridOptionsService.getDocument().activeElement===this.focusWrapper&&(e.preventDefault(),M.stopPropagationForAgGrid(e),this.eFocusableComp.getFocusableElement().focus());break}}),this.addManagedListener(this.focusWrapper,"focusin",()=>{this.focusWrapper.classList.add("ag-advanced-filter-builder-virtual-list-item-highlight")}),this.addManagedListener(this.focusWrapper,"focusout",e=>{this.focusWrapper.contains(e.relatedTarget)||this.focusWrapper.classList.remove("ag-advanced-filter-builder-virtual-list-item-highlight")})}};l([pt],oe.prototype,"postConstruct",1);function be(e,t){return{pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderAddField",pickerAriaLabelValue:"Advanced Filter Builder Add Field",pickerType:"ag-list",valueList:[{key:"condition",displayValue:e("advancedFilterBuilderAddCondition")},{key:"join",displayValue:e("advancedFilterBuilderAddJoin")}],valueFormatter:i=>{var r;return i==null?null:(r=i.displayValue)!=null?r:i.key},pickerIcon:"advancedFilterBuilderAdd",maxPickerWidth:`${t??120}px`,wrapperClassName:"ag-advanced-filter-builder-item-button",ariaLabel:e("advancedFilterBuilderAddButtonTooltip")}}import{Autowired as De,Component as ut,_ as G}from"@ag-grid-community/core";var m=class{};m.EVENT_ADDED="advancedFilterBuilderAdded",m.EVENT_MOVED="advancedFilterBuilderMoved",m.EVENT_REMOVED="advancedFilterBuilderRemoved",m.EVENT_VALUE_CHANGED="advancedFilterBuilderValueChanged",m.EVENT_VALID_CHANGED="advancedFilterBuilderValidChanged";var le=class extends ut{constructor(){super(`
            <div class="ag-advanced-filter-builder-item-condition" role="presentation"></div>
        `),this.validationMessage=null}init(e){const{item:t,createPill:i}=e;this.item=t,this.createPill=i,this.filterModel=t.filterModel,this.setupColumnCondition(this.filterModel),this.validate(),this.addDestroyFunc(()=>this.destroyBeans([this.eColumnPill,this.eOperatorPill,this.eOperandPill]))}getDragName(){return this.filterModel.colId?this.advancedFilterExpressionService.parseColumnFilterModel(this.filterModel):this.getDefaultColumnDisplayValue()}getAriaLabel(){return`${this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderFilterItem")} ${this.getDragName()}`}getValidationMessage(){return this.validationMessage}getFocusableElement(){return this.eColumnPill.getFocusableElement()}setupColumnCondition(e){var t;const i=this.advancedFilterExpressionService.getColumnDetails(e.colId);this.baseCellDataType=i.baseCellDataType,this.column=i.column,this.numOperands=this.getNumOperands(this.getOperatorKey()),this.eColumnPill=this.createPill({key:this.getColumnKey(),displayValue:(t=this.getColumnDisplayValue())!=null?t:this.getDefaultColumnDisplayValue(),cssClass:"ag-advanced-filter-builder-column-pill",isSelect:!0,getEditorParams:()=>({values:this.advancedFilterExpressionService.getColumnAutocompleteEntries()}),update:r=>this.setColumnKey(r),pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderColumnSelectField",pickerAriaLabelValue:"Advanced Filter Builder Column Select Field",ariaLabel:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderColumn")}),this.getGui().appendChild(this.eColumnPill.getGui()),G.exists(this.getColumnKey())&&(this.createOperatorPill(),this.hasOperand()&&this.createOperandPill())}createOperatorPill(){var e;this.eOperatorPill=this.createPill({key:this.getOperatorKey(),displayValue:(e=this.getOperatorDisplayValue())!=null?e:this.getDefaultOptionSelectValue(),cssClass:"ag-advanced-filter-builder-option-pill",isSelect:!0,getEditorParams:()=>({values:this.getOperatorAutocompleteEntries()}),update:t=>this.setOperatorKey(t),pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderOptionSelectField",pickerAriaLabelValue:"Advanced Filter Builder Option Select Field",ariaLabel:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderOption")}),this.eColumnPill.getGui().insertAdjacentElement("afterend",this.eOperatorPill.getGui())}createOperandPill(){var e;const t=(e=this.getOperandDisplayValue())!=null?e:"";this.eOperandPill=this.createPill({key:t,displayValue:t,baseCellDataType:this.baseCellDataType,cssClass:"ag-advanced-filter-builder-value-pill",isSelect:!1,update:i=>this.setOperand(i),ariaLabel:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderValue")}),this.getGui().appendChild(this.eOperandPill.getGui())}getColumnKey(){return this.filterModel.colId}getColumnDisplayValue(){return this.advancedFilterExpressionService.getColumnDisplayValue(this.filterModel)}getOperatorKey(){return this.filterModel.type}getOperatorDisplayValue(){return this.advancedFilterExpressionService.getOperatorDisplayValue(this.filterModel)}getOperandDisplayValue(){return this.advancedFilterExpressionService.getOperandDisplayValue(this.filterModel,!0)}hasOperand(){return this.numOperands>0}getOperatorAutocompleteEntries(){return this.column?this.advancedFilterExpressionService.getOperatorAutocompleteEntries(this.column,this.baseCellDataType):[]}setColumnKey(e){this.eOperatorPill||this.createOperatorPill();const t=this.advancedFilterExpressionService.getColumnDetails(e);this.column=t.column;const i=t.baseCellDataType;this.baseCellDataType!==i&&(this.baseCellDataType=i,this.setOperatorKey(void 0),this.eOperatorPill&&(G.removeFromParent(this.eOperatorPill.getGui()),this.destroyBean(this.eOperatorPill),this.createOperatorPill()),this.validate()),this.filterModel.colId=e,this.filterModel.filterType=this.baseCellDataType}setOperatorKey(e){const t=this.getNumOperands(e);t!==this.numOperands&&(this.numOperands=t,t===0?this.destroyOperandPill():(this.createOperandPill(),this.baseCellDataType!=="number"&&this.setOperand(""))),this.filterModel.type=e,this.validate()}setOperand(e){var t;let i=e;this.column&&(i=(t=this.advancedFilterExpressionService.getOperandModelValue(e,this.baseCellDataType,this.column))!=null?t:""),this.filterModel.filter=i,this.validate()}getNumOperands(e){var t,i;return(i=(t=this.advancedFilterExpressionService.getExpressionOperator(this.baseCellDataType,e))==null?void 0:t.numOperands)!=null?i:0}destroyOperandPill(){delete this.filterModel.filter,this.getGui().removeChild(this.eOperandPill.getGui()),this.destroyBean(this.eOperandPill),this.eOperandPill=void 0}validate(){let e=null;G.exists(this.getColumnKey())?G.exists(this.getOperatorKey())?this.numOperands>0&&!G.exists(this.getOperandDisplayValue())&&(e=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationEnterValue")):e=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationSelectOption"):e=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationSelectColumn"),this.item.valid=!e,e!==this.validationMessage&&(this.validationMessage=e,this.dispatchEvent({type:m.EVENT_VALID_CHANGED}))}getDefaultColumnDisplayValue(){return this.advancedFilterExpressionService.translate("advancedFilterBuilderSelectColumn")}getDefaultOptionSelectValue(){return this.advancedFilterExpressionService.translate("advancedFilterBuilderSelectOption")}};l([De("advancedFilterExpressionService")],le.prototype,"advancedFilterExpressionService",2),l([De("valueParserService")],le.prototype,"valueParserService",2);import{AgInputDateField as ct,AgInputNumberField as ht,AgInputTextField as vt,Autowired as mt,Component as gt,Events as ft,KeyCode as de,PostConstruct as Et,RefSelector as Se,_ as b}from"@ag-grid-community/core";var W=class extends gt{constructor(e){super(`
            <div class="ag-advanced-filter-builder-pill-wrapper" role="presentation">
                <div ref="ePill" class="ag-advanced-filter-builder-pill" role="button">
                    <span ref="eLabel" class="ag-advanced-filter-builder-pill-display"></span>
                </div>
            </div>
        `),this.params=e,this.value=e.value}postConstruct(){const{cssClass:e,ariaLabel:t}=this.params;this.ePill.classList.add(e),this.activateTabIndex([this.ePill]),this.eLabel.id=`${this.getCompId()}`,b.setAriaDescribedBy(this.ePill,this.eLabel.id),b.setAriaLabel(this.ePill,t),this.renderValue(),this.addManagedListener(this.ePill,"click",i=>{i.preventDefault(),this.showEditor()}),this.addManagedListener(this.ePill,"keydown",i=>{switch(i.key){case de.ENTER:i.preventDefault(),b.stopPropagationForAgGrid(i),this.showEditor();break}}),this.addDestroyFunc(()=>this.destroyBean(this.eEditor))}getFocusableElement(){return this.ePill}showEditor(){if(this.eEditor)return;b.setDisplayed(this.ePill,!1),this.eEditor=this.createEditorComp(this.params.type),this.eEditor.setValue(this.value);const e=this.eEditor.getGui();this.eEditor.addManagedListener(e,"keydown",t=>{switch(t.key){case de.ENTER:t.preventDefault(),b.stopPropagationForAgGrid(t),this.updateValue(!0);break;case de.ESCAPE:t.preventDefault(),b.stopPropagationForAgGrid(t),this.hideEditor(!0);break}}),this.eEditor.addManagedListener(e,"focusout",()=>{this.updateValue(!1)}),this.getGui().appendChild(e),this.eEditor.getFocusableElement().focus()}createEditorComp(e){let t;switch(e){case"text":t=new vt;break;case"number":t=new ht;break;case"date":t=new ct;break}return this.createBean(t)}hideEditor(e){const{eEditor:t}=this;t&&(this.eEditor=void 0,this.getGui().removeChild(t.getGui()),this.destroyBean(t),b.setDisplayed(this.ePill,!0),e&&this.ePill.focus())}renderValue(){let e;this.eLabel.classList.remove("ag-advanced-filter-builder-value-empty","ag-advanced-filter-builder-value-number","ag-advanced-filter-builder-value-text"),b.exists(this.value)?this.params.type==="number"?(e=this.value,this.eLabel.classList.add("ag-advanced-filter-builder-value-number")):(e=`"${this.value}"`,this.eLabel.classList.add("ag-advanced-filter-builder-value-text")):(e=this.advancedFilterExpressionService.translate("advancedFilterBuilderEnterValue"),this.eLabel.classList.add("ag-advanced-filter-builder-value-empty")),this.eLabel.innerText=e}updateValue(e){var t;if(!this.eEditor)return;const i=(t=this.eEditor.getValue())!=null?t:"";this.dispatchEvent({type:ft.EVENT_FIELD_VALUE_CHANGED,value:i}),this.value=i,this.renderValue(),this.hideEditor(e)}};l([Se("ePill")],W.prototype,"ePill",2),l([Se("eLabel")],W.prototype,"eLabel",2),l([mt("advancedFilterExpressionService")],W.prototype,"advancedFilterExpressionService",2),l([Et],W.prototype,"postConstruct",1);import{Autowired as Ft,Component as Pt}from"@ag-grid-community/core";var Be=class extends Pt{constructor(){super(`
            <div class="ag-advanced-filter-builder-item-condition" role="presentation"></div>
        `)}init(e){const{item:t,createPill:i}=e,r=t.filterModel;this.filterModel=r,this.ePill=i({key:r.type,displayValue:this.advancedFilterExpressionService.parseJoinOperator(r),cssClass:"ag-advanced-filter-builder-join-pill",isSelect:!0,getEditorParams:()=>({values:this.advancedFilterExpressionService.getJoinOperatorAutocompleteEntries()}),update:s=>r.type=s,pickerAriaLabelKey:"ariaLabelAdvancedFilterBuilderJoinSelectField",pickerAriaLabelValue:"Advanced Filter Builder Join Operator Select Field",ariaLabel:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderJoinOperator")}),this.getGui().appendChild(this.ePill.getGui()),this.addDestroyFunc(()=>this.destroyBean(this.ePill))}getDragName(){return this.advancedFilterExpressionService.parseJoinOperator(this.filterModel)}getAriaLabel(){return`${this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderGroupItem")} ${this.getDragName()}`}getValidationMessage(){return null}getFocusableElement(){return this.ePill.getFocusableElement()}};l([Ft("advancedFilterExpressionService")],Be.prototype,"advancedFilterExpressionService",2);import{AgRichSelect as Ct,_ as pe}from"@ag-grid-community/core";var yt=class extends Ct{constructor(e){super(Y(Q({},e),{template:`
                <div class="ag-picker-field ag-advanced-filter-builder-pill-wrapper" role="presentation">
                    <div ref="eLabel"></div>
                    <div ref="eWrapper" class="ag-wrapper ag-advanced-filter-builder-pill ag-picker-collapsed">
                        <div ref="eDisplayField" class="ag-picker-field-display ag-advanced-filter-builder-pill-display"></div>
                        <ag-input-text-field ref="eInput" class="ag-rich-select-field-input"></ag-input-text-field>
                        <div ref="eIcon" class="ag-picker-field-icon" aria-hidden="true"></div>
                    </div>
                </div>`})),this.params=e}getFocusableElement(){return this.eWrapper}showPicker(){setTimeout(()=>super.showPicker())}hidePicker(){setTimeout(()=>super.hidePicker())}postConstruct(){super.postConstruct();const{wrapperClassName:e,ariaLabel:t}=this.params;this.eWrapper.classList.add(e),pe.setAriaLabelledBy(this.eWrapper,""),pe.setAriaLabel(this.eWrapper,t)}createPickerComponent(){var e;if(!this.values){const{values:t}=this.params.getEditorParams();this.values=t;const i=this.value.key,r=(e=t.find(s=>s.key===i))!=null?e:{key:i,displayValue:this.value.displayValue};this.value=r}return super.createPickerComponent()}onEnterKeyDown(e){pe.stopPropagationForAgGrid(e),this.isPickerDisplayed?super.onEnterKeyDown(e):(e.preventDefault(),this.showPicker())}},g=class extends rt{constructor(e,t,i){super(`
            <div class="ag-advanced-filter-builder-item-wrapper" role="presentation">
                <div ref="eItem" class="ag-advanced-filter-builder-item" role="presentation">
                    <div ref="eTreeLines" class="ag-advanced-filter-builder-item-tree-lines" aria-hidden="true"></div>
                    <span ref="eDragHandle" class="ag-drag-handle" aria-hidden="true"></span>
                    <span ref="eValidation" class="ag-advanced-filter-builder-item-button ag-advanced-filter-builder-invalid" aria-hidden="true"></span>
                </div>
                <div ref="eButtons" class="ag-advanced-filter-builder-item-buttons">
                    <span ref="eMoveUpButton" class="ag-advanced-filter-builder-item-button" role="button"></span>
                    <span ref="eMoveDownButton" class="ag-advanced-filter-builder-item-button" role="button"></span>
                    <div ref="eAddButton" role="presentation"></div>
                    <span ref="eRemoveButton" class="ag-advanced-filter-builder-item-button" role="button"></span>
                </div>
            </div>
        `),this.item=e,this.dragFeature=t,this.focusWrapper=i,this.moveUpDisabled=!1,this.moveDownDisabled=!1}postConstruct(){const{filterModel:e,level:t,showMove:i}=this.item,r=e.filterType==="join";if(this.ePillWrapper=this.createManagedBean(r?new Be:new le),this.ePillWrapper.init({item:this.item,createPill:s=>this.createPill(s)}),this.eDragHandle.insertAdjacentElement("afterend",this.ePillWrapper.getGui()),t===0){const s=document.createElement("div");s.classList.add("ag-advanced-filter-builder-item-tree-line-vertical-bottom"),s.classList.add("ag-advanced-filter-builder-item-tree-line-root"),this.eTreeLines.appendChild(s),h.setDisplayed(this.eDragHandle,!1),h.setDisplayed(this.eButtons,!1),h.setAriaExpanded(this.focusWrapper,!0)}else this.setupTreeLines(t),this.eDragHandle.appendChild(h.createIconNoSpan("advancedFilterBuilderDrag",this.gridOptionsService)),this.setupValidation(),this.setupMoveButtons(i),this.setupAddButton(),this.setupRemoveButton(),this.setupDragging(),this.updateAriaExpanded();h.setAriaLevel(this.focusWrapper,t+1),this.initialiseTabGuard({}),this.createManagedBean(new oe(this.getGui(),this.focusWrapper,this.ePillWrapper)),this.updateAriaLabel(),this.addManagedListener(this.ePillWrapper,m.EVENT_VALUE_CHANGED,()=>this.dispatchEvent({type:m.EVENT_VALUE_CHANGED})),this.addManagedListener(this.ePillWrapper,m.EVENT_VALID_CHANGED,()=>this.updateValidity())}setState(e){const{level:t}=this.item;if(t===0)return;const{showMove:i}=this.item,{disableMoveUp:r,disableMoveDown:s,treeLines:a,showStartTreeLine:n}=e;this.updateTreeLines(a,n),this.updateAriaExpanded(),i&&(this.moveUpDisabled=!!r,this.moveDownDisabled=!!s,this.eMoveUpButton.classList.toggle("ag-advanced-filter-builder-item-button-disabled",r),this.eMoveDownButton.classList.toggle("ag-advanced-filter-builder-item-button-disabled",s),h.setAriaDisabled(this.eMoveUpButton,!!r),h.setAriaDisabled(this.eMoveDownButton,!!s),this.moveUpTooltipFeature.refreshToolTip(),this.moveDownTooltipFeature.refreshToolTip())}focusMoveButton(e){(e?this.eMoveUpButton:this.eMoveDownButton).focus()}afterAdd(){this.ePillWrapper.getFocusableElement().focus()}setupTreeLines(e){for(let t=0;t<e;t++){const i=document.createElement("div");this.eTreeLines.appendChild(i)}}updateTreeLines(e,t){const i=e.length-1,{children:r}=this.eTreeLines;for(let a=0;a<i;a++){const n=r.item(a);n&&n.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical",!e[a])}const s=r.item(i);if(s){s.classList.add("ag-advanced-filter-builder-item-tree-line-horizontal");const a=e[i];s.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical-top",a),s.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical",!a)}this.eDragHandle.classList.toggle("ag-advanced-filter-builder-item-tree-line-vertical-bottom",t)}setupValidation(){this.eValidation.appendChild(h.createIconNoSpan("advancedFilterBuilderInvalid",this.gridOptionsService)),this.validationTooltipFeature=this.createManagedBean(new k({getGui:()=>this.eValidation,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.ePillWrapper.getValidationMessage(),getTooltipShowDelayOverride:()=>1e3})),this.updateValidity()}setupAddButton(){var e;const t=be(r=>this.advancedFilterExpressionService.translate(r),(e=this.gridOptionsService.get("advancedFilterBuilderParams"))==null?void 0:e.addSelectWidth),i=this.createManagedBean(new Ae(t));this.addManagedListener(i,se.EVENT_FIELD_PICKER_VALUE_SELECTED,({value:r})=>this.dispatchEvent({type:m.EVENT_ADDED,item:this.item,isJoin:r.key==="join"})),this.eAddButton.appendChild(i.getGui()),this.createManagedBean(new k({getGui:()=>this.eAddButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.advancedFilterExpressionService.translate("advancedFilterBuilderAddButtonTooltip")}))}setupRemoveButton(){this.eRemoveButton.appendChild(h.createIconNoSpan("advancedFilterBuilderRemove",this.gridOptionsService)),this.addManagedListener(this.eRemoveButton,"click",()=>this.removeItem()),this.addManagedListener(this.eRemoveButton,"keydown",e=>{switch(e.key){case ae.ENTER:e.preventDefault(),h.stopPropagationForAgGrid(e),this.removeItem();break}}),this.createManagedBean(new k({getGui:()=>this.eRemoveButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.advancedFilterExpressionService.translate("advancedFilterBuilderRemoveButtonTooltip")})),h.setAriaLabel(this.eRemoveButton,this.advancedFilterExpressionService.translate("advancedFilterBuilderRemoveButtonTooltip")),this.activateTabIndex([this.eRemoveButton])}setupMoveButtons(e){e?(this.eMoveUpButton.appendChild(h.createIconNoSpan("advancedFilterBuilderMoveUp",this.gridOptionsService)),this.addManagedListener(this.eMoveUpButton,"click",()=>this.moveItem(!0)),this.addManagedListener(this.eMoveUpButton,"keydown",t=>{switch(t.key){case ae.ENTER:t.preventDefault(),h.stopPropagationForAgGrid(t),this.moveItem(!0);break}}),this.moveUpTooltipFeature=this.createManagedBean(new k({getGui:()=>this.eMoveUpButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.moveUpDisabled?null:this.advancedFilterExpressionService.translate("advancedFilterBuilderMoveUpButtonTooltip")})),h.setAriaLabel(this.eMoveUpButton,this.advancedFilterExpressionService.translate("advancedFilterBuilderMoveUpButtonTooltip")),this.eMoveDownButton.appendChild(h.createIconNoSpan("advancedFilterBuilderMoveDown",this.gridOptionsService)),this.addManagedListener(this.eMoveDownButton,"click",()=>this.moveItem(!1)),this.addManagedListener(this.eMoveDownButton,"keydown",t=>{switch(t.key){case ae.ENTER:t.preventDefault(),h.stopPropagationForAgGrid(t),this.moveItem(!1);break}}),this.moveDownTooltipFeature=this.createManagedBean(new k({getGui:()=>this.eMoveDownButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.moveDownDisabled?null:this.advancedFilterExpressionService.translate("advancedFilterBuilderMoveDownButtonTooltip")})),h.setAriaLabel(this.eMoveDownButton,this.advancedFilterExpressionService.translate("advancedFilterBuilderMoveDownButtonTooltip")),this.activateTabIndex([this.eMoveUpButton,this.eMoveDownButton])):(h.setDisplayed(this.eMoveUpButton,!1),h.setDisplayed(this.eMoveDownButton,!1))}updateValidity(){h.setVisible(this.eValidation,!this.item.valid),this.validationTooltipFeature.refreshToolTip(),this.updateAriaLabel()}createPill(e){var t,i;const{key:r,displayValue:s,cssClass:a,update:n,ariaLabel:o}=e,d=p=>{p!=null&&(n(p),this.dispatchEvent({type:m.EVENT_VALUE_CHANGED}))};if(e.isSelect){const{getEditorParams:p,pickerAriaLabelKey:u,pickerAriaLabelValue:v}=e,f=this.gridOptionsService.get("advancedFilterBuilderParams"),c=`${(t=f?.pillSelectMinWidth)!=null?t:140}px`,O=`${(i=f?.pillSelectMaxWidth)!=null?i:200}px`,L=this.createBean(new yt({pickerAriaLabelKey:u,pickerAriaLabelValue:v,pickerType:"ag-list",value:{key:r,displayValue:s},valueFormatter:x=>{var Ee;return x==null?null:(Ee=x.displayValue)!=null?Ee:x.key},variableWidth:!0,minPickerWidth:c,maxPickerWidth:O,getEditorParams:p,wrapperClassName:a,ariaLabel:o}));return this.addManagedListener(L,se.EVENT_FIELD_PICKER_VALUE_SELECTED,({value:x})=>d(x?.key)),L}else{const p=this.createBean(new W({value:s,cssClass:a,type:this.getInputType(e.baseCellDataType),ariaLabel:o}));return this.addManagedListener(p,se.EVENT_FIELD_VALUE_CHANGED,({value:u})=>d(u)),p}}getInputType(e){switch(e){case"text":case"object":case"boolean":return"text";case"number":return"number";case"date":case"dateString":return"date"}}setupDragging(){const e={type:tt.AdvancedFilterBuilder,eElement:this.eDragHandle,dragItemName:()=>this.ePillWrapper.getDragName(),getDefaultIconName:()=>et.ICON_NOT_ALLOWED,getDragItem:()=>({}),onDragStarted:()=>this.dragFeature.dispatchEvent({type:ne.EVENT_DRAG_STARTED,item:this.item}),onDragStopped:()=>this.dragFeature.dispatchEvent({type:ne.EVENT_DRAG_ENDED})};this.dragAndDropService.addDragSource(e,!0),this.addDestroyFunc(()=>this.dragAndDropService.removeDragSource(e))}updateAriaLabel(){const e=this.ePillWrapper.getAriaLabel(),t=`${this.item.level+1}`,i=this.ePillWrapper.getValidationMessage();let r;i?r=this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderItemValidation",[e,t,i]):r=this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderItem",[e,t]),h.setAriaLabel(this.focusWrapper,r)}updateAriaExpanded(){h.removeAriaExpanded(this.focusWrapper);const{filterModel:e}=this.item;e?.filterType==="join"&&e.conditions.length&&h.setAriaExpanded(this.focusWrapper,!0)}removeItem(){this.dispatchEvent({type:m.EVENT_REMOVED,item:this.item})}moveItem(e){this.dispatchEvent({type:m.EVENT_MOVED,item:this.item,backwards:e})}};l([P("eTreeLines")],g.prototype,"eTreeLines",2),l([P("eDragHandle")],g.prototype,"eDragHandle",2),l([P("eItem")],g.prototype,"eItem",2),l([P("eButtons")],g.prototype,"eButtons",2),l([P("eValidation")],g.prototype,"eValidation",2),l([P("eMoveUpButton")],g.prototype,"eMoveUpButton",2),l([P("eMoveDownButton")],g.prototype,"eMoveDownButton",2),l([P("eAddButton")],g.prototype,"eAddButton",2),l([P("eRemoveButton")],g.prototype,"eRemoveButton",2),l([re("beans")],g.prototype,"beans",2),l([re("dragAndDropService")],g.prototype,"dragAndDropService",2),l([re("advancedFilterExpressionService")],g.prototype,"advancedFilterExpressionService",2),l([it],g.prototype,"postConstruct",1);import{Autowired as Oe,Component as xt,Events as At,PostConstruct as bt,RefSelector as Dt,TooltipFeature as St,_ as Ve}from"@ag-grid-community/core";var H=class extends xt{constructor(e,t){super(`
            <div class="ag-advanced-filter-builder-item-wrapper" role="presentation">
                <div ref="eItem" class="ag-advanced-filter-builder-item" role="presentation">
                    <div class="ag-advanced-filter-builder-item-tree-lines" aria-hidden="true">
                        <div class="ag-advanced-filter-builder-item-tree-line-vertical-top ag-advanced-filter-builder-item-tree-line-horizontal"></div>
                    </div>
                </div>
            </div>
        `),this.item=e,this.focusWrapper=t}postConstruct(){var e;Ve.setAriaLevel(this.focusWrapper,2);const t=be(r=>this.advancedFilterExpressionService.translate(r),(e=this.gridOptionsService.get("advancedFilterBuilderParams"))==null?void 0:e.addSelectWidth),i=this.createManagedBean(new Ae(t));this.addManagedListener(i,At.EVENT_FIELD_PICKER_VALUE_SELECTED,({value:r})=>{this.dispatchEvent({type:m.EVENT_ADDED,item:this.item,isJoin:r.key==="join"})}),this.eItem.appendChild(i.getGui()),this.createManagedBean(new St({getGui:()=>i.getGui(),getLocation:()=>"advancedFilter",getTooltipValue:()=>this.advancedFilterExpressionService.translate("advancedFilterBuilderAddButtonTooltip")})),this.createManagedBean(new oe(this.getGui(),this.focusWrapper,i)),Ve.setAriaLabel(this.focusWrapper,this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderItem",[this.advancedFilterExpressionService.translate("advancedFilterBuilderAddButtonTooltip"),`${this.item.level+1}`]))}afterAdd(){}};l([Oe("beans")],H.prototype,"beans",2),l([Oe("advancedFilterExpressionService")],H.prototype,"advancedFilterExpressionService",2),l([Dt("eItem")],H.prototype,"eItem",2),l([bt],H.prototype,"postConstruct",1);var C=class extends Qe{constructor(){super(`
            <div role="presentation" class="ag-advanced-filter-builder" tabindex="-1">
                <div role="presentation" class="ag-advanced-filter-builder-list" ref="eList"></div>
                <div role="presentation" class="ag-advanced-filter-builder-button-panel">
                    <button class="ag-button ag-standard-button ag-advanced-filter-builder-apply-button" ref="eApplyFilterButton"></button>
                    <button class="ag-button ag-standard-button ag-advanced-filter-builder-cancel-button" ref="eCancelFilterButton"></button>
                </div>
            </div>`),this.validationMessage=null}postConstruct(){var e;const{showMoveButtons:t}=(e=this.gridOptionsService.get("advancedFilterBuilderParams"))!=null?e:{};this.showMove=!!t,this.addManagedPropertyListener("advancedFilterBuilderParams",({currentValue:i})=>{this.showMove=!!i?.showMoveButtons,this.refreshList(!1)}),this.filterModel=this.setupFilterModel(),this.setupVirtualList(),this.dragFeature=this.createManagedBean(new ne(this,this.virtualList)),this.setupButtons()}refresh(){let e=this.virtualList.getLastFocusedRow();this.setupFilterModel(),this.validateItems(),this.refreshList(!1),e!=null&&(this.virtualList.getComponentAt(e)||(e=0),this.virtualList.focusRow(e))}getNumItems(){return this.items.length}moveItem(e,t){!t||!e||this.moveItemToIndex(e,t.rowIndex,t.position)}afterGuiAttached(){this.virtualList.focusRow(0)}setupVirtualList(){this.virtualList=this.createManagedBean(new Ze({cssIdentifier:"advanced-filter-builder",ariaRole:"tree",listName:this.advancedFilterExpressionService.translate("ariaAdvancedFilterBuilderList")})),this.virtualList.setComponentCreator(this.createItemComponent.bind(this)),this.virtualList.setComponentUpdater(this.updateItemComponent.bind(this)),this.virtualList.setRowHeight(40),this.eList.appendChild(this.virtualList.getGui()),this.virtualList.setModel({getRowCount:()=>this.items.length,getRow:e=>this.items[e],areRowsEqual:(e,t)=>e===t}),this.buildList(),this.virtualList.refresh()}setupButtons(){this.eApplyFilterButton.innerText=this.advancedFilterExpressionService.translate("advancedFilterBuilderApply"),this.activateTabIndex([this.eApplyFilterButton]),this.addManagedListener(this.eApplyFilterButton,"click",()=>{this.advancedFilterService.setModel(this.filterModel),this.filterManager.onFilterChanged({source:"advancedFilter"}),this.close()}),this.validationTooltipFeature=this.createManagedBean(new Xe({getGui:()=>this.eApplyFilterButton,getLocation:()=>"advancedFilter",getTooltipValue:()=>this.validationMessage,getTooltipShowDelayOverride:()=>1e3})),this.validate(),this.addManagedListener(this.eApplyFilterButton,"mouseenter",()=>this.addOrRemoveCssClass("ag-advanced-filter-builder-validation",!0)),this.addManagedListener(this.eApplyFilterButton,"mouseleave",()=>this.addOrRemoveCssClass("ag-advanced-filter-builder-validation",!1)),this.eCancelFilterButton.innerText=this.advancedFilterExpressionService.translate("advancedFilterBuilderCancel"),this.activateTabIndex([this.eCancelFilterButton]),this.addManagedListener(this.eCancelFilterButton,"click",()=>this.close())}removeItemFromParent(e){const t=e.parent.conditions.indexOf(e.filterModel);return e.parent.conditions.splice(t,1),t}moveItemToIndex(e,t,i){var r;const s=this.items[t],a=((r=s.filterModel)==null?void 0:r.filterType)==="join"&&i==="bottom",n=a?s.filterModel:s.parent;if(!n||this.isChildOrSelf(n,e.filterModel)||s===e)return;this.removeItemFromParent(e);let o;a?o=0:(o=n.conditions.indexOf(s.filterModel),o===-1?o=n.conditions.length:i==="bottom"&&(o+=1)),n.conditions.splice(o,0,e.filterModel),this.refreshList(!1)}isChildOrSelf(e,t){return e===t||t.filterType==="join"&&t.conditions.some(i=>this.isChildOrSelf(e,i))}setupFilterModel(){const e=this.formatFilterModel(this.advancedFilterService.getModel());return this.stringifiedModel=JSON.stringify(e),e}formatFilterModel(e){return e=e??{filterType:"join",type:"AND",conditions:[]},e.filterType!=="join"&&(e={filterType:"join",type:"AND",conditions:[e]}),e}buildList(){const e=(t,i,r,s)=>{i.push({filterModel:t,level:r,parent:s,valid:!0,showMove:this.showMove}),t.filterType==="join"&&(t.conditions.forEach(a=>e(a,i,r+1,t)),r===0&&i.push({filterModel:null,level:r+1,parent:t,valid:!0}))};this.items=[],e(this.filterModel,this.items,0)}refreshList(e){if(!e){const t=[];this.items.forEach(i=>{i.valid||t.push(i.filterModel)}),this.buildList(),t.length&&this.items.forEach(i=>{i.filterModel&&t.includes(i.filterModel)&&(i.valid=!1)})}this.virtualList.refresh(e),this.validate()}updateItemComponent(e,t){const i=this.items.indexOf(e),r=(o,d)=>{const p=this.items.find(v=>v.filterModel===o),u=p?.parent;if(u){const{conditions:v}=u;r(u,d),d.push(v[v.length-1]===o)}},s=[],{filterModel:a}=e;a&&(r(a,s),s[0]=!1);const n=a?.filterType==="join"&&!!a.conditions.length;t.setState({disableMoveUp:i===1,disableMoveDown:!this.canMoveDown(e,i),treeLines:s,showStartTreeLine:n})}createItemComponent(e,t){const i=this.createBean(e.filterModel?new g(e,this.dragFeature,t):new H(e,t));return i.addManagedListener(i,m.EVENT_REMOVED,({item:r})=>this.removeItem(r)),i.addManagedListener(i,m.EVENT_VALUE_CHANGED,()=>this.validate()),i.addManagedListener(i,m.EVENT_ADDED,({item:r,isJoin:s})=>this.addItem(r,s)),i.addManagedListener(i,m.EVENT_MOVED,({item:r,backwards:s})=>this.moveItemUpDown(r,s)),i instanceof g&&this.updateItemComponent(e,i),i}addItem(e,t){var i;const{parent:r,level:s,filterModel:a}=e,n=a?.filterType==="join",o=t?{filterType:"join",type:"AND",conditions:[]}:{},d=n?a:r;let p=n?0:d.conditions.indexOf(a);p>=0?(n||(p+=1),d.conditions.splice(p,0,o)):d.conditions.push(o);let u=this.items.indexOf(e);const v=u>=0;if(v){e.filterModel&&u++;const f=[{filterModel:o,level:n?s+1:s,parent:d,valid:t,showMove:this.showMove}];this.items.splice(u,0,...f)}this.refreshList(v),v&&((i=this.virtualList.getComponentAt(u))==null||i.afterAdd())}removeItem(e){var t;const i=e.parent,{filterModel:r}=e,s=i.conditions.indexOf(r);i.conditions.splice(s,1);const a=((t=e.filterModel)==null?void 0:t.filterType)==="join",n=this.items.indexOf(e),o=!a&&n>=0;o&&this.items.splice(n,1),this.refreshList(o),n>=0&&this.virtualList.focusRow(n)}moveItemUpDown(e,t){const i=this.items.indexOf(e),r=t?i-1:i+1;if(r===0||!t&&!this.canMoveDown(e,i))return;const s=this.items[r],a=this.removeItemFromParent(e),{level:n,filterModel:o,parent:d}=e,{level:p,filterModel:u,parent:v}=s;if(t)if(p===n&&u.filterType==="join")u.conditions.push(o);else if(p<=n){const c=v.conditions.indexOf(u);v.conditions.splice(c,0,o)}else d.conditions[a-1].conditions.push(o);else if(p===n)if(u.filterType==="join")u.conditions.splice(0,0,o);else{const c=v.conditions.indexOf(u);v.conditions.splice(c+1,0,o)}else if(a<d.conditions.length)d.conditions.splice(a+1,0,o);else{const c=this.items.find(L=>L.filterModel===d),O=c.parent.conditions.indexOf(c.filterModel)+1;c.parent.conditions.splice(O,0,o)}this.refreshList(!1);const f=this.items.findIndex(({filterModel:c})=>c===o);if(f>=0){const c=this.virtualList.getComponentAt(f);c instanceof g&&c.focusMoveButton(t)}}canMoveDown(e,t){return!(e.level===1&&t===this.items.length-2||e.level===1&&e.parent.conditions[e.parent.conditions.length-1]===e.filterModel)}close(){this.advancedFilterService.getCtrl().toggleFilterBuilder("ui")}validate(){let e=!this.items.every(({valid:t})=>t);e?this.validationMessage=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationIncomplete"):(e=JSON.stringify(this.filterModel)===this.stringifiedModel,e?this.validationMessage=this.advancedFilterExpressionService.translate("advancedFilterBuilderValidationAlreadyApplied"):this.validationMessage=null),xe.setDisabled(this.eApplyFilterButton,e),this.validationTooltipFeature.refreshToolTip()}validateItems(){const e=i=>{i.type=void 0},t=i=>{delete i.filter};this.items.forEach(i=>{if(!i.valid||!i.filterModel||i.filterModel.filterType==="join")return;const{filterModel:r}=i,{colId:s}=r,a=this.advancedFilterExpressionService.getColumnAutocompleteEntries().find(({key:p})=>p===s),n=this.advancedFilterExpressionService.getColumnDetails(r.colId);if(!a||!n.column){i.valid=!1,r.colId=void 0,e(r),t(r);return}const d=this.advancedFilterExpressionService.getDataTypeExpressionOperator(n.baseCellDataType).operators[r.type];if(!d){i.valid=!1,e(r),t(r);return}if(d.numOperands>0&&!xe.exists(r.filter)){i.valid=!1;return}})}};l([ie("eList")],C.prototype,"eList",2),l([ie("eApplyFilterButton")],C.prototype,"eApplyFilterButton",2),l([ie("eCancelFilterButton")],C.prototype,"eCancelFilterButton",2),l([$("filterManager")],C.prototype,"filterManager",2),l([$("advancedFilterService")],C.prototype,"advancedFilterService",2),l([$("advancedFilterExpressionService")],C.prototype,"advancedFilterExpressionService",2),l([$("beans")],C.prototype,"beans",2),l([Ye],C.prototype,"postConstruct",1);var V=class _e extends $e{constructor(t){super(),this.enabled=t}postConstruct(){this.hasAdvancedFilterParent=!!this.gridOptionsService.get("advancedFilterParent"),this.ctrlsService.whenReady(()=>this.setAdvancedFilterComp()),this.addManagedListener(this.eventService,Z.EVENT_ADVANCED_FILTER_ENABLED_CHANGED,({enabled:t})=>this.onEnabledChanged(t)),this.addManagedPropertyListener("advancedFilterParent",()=>this.updateComps()),this.addDestroyFunc(()=>{this.destroyAdvancedFilterComp(),this.destroyBean(this.eBuilderComp),this.eBuilderDialog&&this.eBuilderDialog.isAlive()&&this.destroyBean(this.eBuilderDialog)})}setupHeaderComp(t){this.eHeaderComp=this.createManagedBean(new N(this.enabled&&!this.hasAdvancedFilterParent)),t.insertAdjacentElement("beforebegin",this.eHeaderComp.getGui())}focusHeaderComp(){return this.eHeaderComp?(this.eHeaderComp.getFocusableElement().focus(),!0):!1}refreshComp(){var t,i;(t=this.eFilterComp)==null||t.refresh(),(i=this.eHeaderComp)==null||i.refresh()}refreshBuilderComp(){var t;(t=this.eBuilderComp)==null||t.refresh()}getHeaderHeight(){var t,i;return(i=(t=this.eHeaderComp)==null?void 0:t.getHeight())!=null?i:0}setInputDisabled(t){var i,r;(i=this.eFilterComp)==null||i.setInputDisabled(t),(r=this.eHeaderComp)==null||r.setInputDisabled(t)}toggleFilterBuilder(t,i){if(i&&this.eBuilderDialog||i===!1&&!this.eBuilderDialog)return;if(this.eBuilderDialog){this.builderDestroySource=t,this.destroyBean(this.eBuilderDialog);return}this.setInputDisabled(!0);const{width:r,height:s,minWidth:a}=this.getBuilderDialogSize();this.eBuilderComp=this.createBean(new C),this.eBuilderDialog=this.createBean(new ye({title:this.advancedFilterExpressionService.translate("advancedFilterBuilderTitle"),component:this.eBuilderComp,width:r,height:s,resizable:!0,movable:!0,maximizable:!0,centered:!0,closable:!0,minWidth:a,afterGuiAttached:()=>{var n;return(n=this.eBuilderComp)==null?void 0:n.afterGuiAttached()}})),this.dispatchFilterBuilderVisibleChangedEvent(t,!0),this.eBuilderDialog.addEventListener(ye.EVENT_DESTROYED,()=>{var n;this.destroyBean(this.eBuilderComp),this.eBuilderComp=void 0,this.eBuilderDialog=void 0,this.setInputDisabled(!1),this.dispatchEvent({type:_e.EVENT_BUILDER_CLOSED}),this.dispatchFilterBuilderVisibleChangedEvent((n=this.builderDestroySource)!=null?n:"ui",!1),this.builderDestroySource=void 0})}dispatchFilterBuilderVisibleChangedEvent(t,i){const r={type:Z.EVENT_ADVANCED_FILTER_BUILDER_VISIBLE_CHANGED,source:t,visible:i};this.eventService.dispatchEvent(r)}getBuilderDialogSize(){var t,i;const r=(i=(t=this.gridOptionsService.get("advancedFilterBuilderParams"))==null?void 0:t.minWidth)!=null?i:500,s=this.popupService.getPopupParent(),a=Math.round(ee.getAbsoluteWidth(s))-2,n=Math.round(ee.getAbsoluteHeight(s)*.75)-2,o=Math.min(Math.max(600,r),a),d=Math.min(600,n);return{width:o,height:d,minWidth:r}}onEnabledChanged(t){this.enabled=t,this.updateComps()}updateComps(){this.setAdvancedFilterComp(),this.setHeaderCompEnabled(),this.eventService.dispatchEvent({type:Z.EVENT_HEADER_HEIGHT_CHANGED})}setAdvancedFilterComp(){if(this.destroyAdvancedFilterComp(),!this.enabled)return;const t=this.gridOptionsService.get("advancedFilterParent");if(this.hasAdvancedFilterParent=!!t,t){const i=this.createBean(new E),r=i.getGui(),{allThemes:s}=this.environment.getTheme();s.length&&r.classList.add(...s),r.classList.add(this.gridOptionsService.get("enableRtl")?"ag-rtl":"ag-ltr"),t.appendChild(r),this.eFilterComp=i}}setHeaderCompEnabled(){var t;(t=this.eHeaderComp)==null||t.setEnabled(this.enabled&&!this.hasAdvancedFilterParent)}destroyAdvancedFilterComp(){this.eFilterComp&&(ee.removeFromParent(this.eFilterComp.getGui()),this.destroyBean(this.eFilterComp))}};V.EVENT_BUILDER_CLOSED="advancedFilterBuilderClosed",l([j("focusService")],V.prototype,"focusService",2),l([j("ctrlsService")],V.prototype,"ctrlsService",2),l([j("popupService")],V.prototype,"popupService",2),l([j("advancedFilterExpressionService")],V.prototype,"advancedFilterExpressionService",2),l([Ke],V.prototype,"postConstruct",1);var Le=V,E=class extends Ue{constructor(){super(`
            <div class="ag-advanced-filter" role="presentation" tabindex="-1">
                <ag-autocomplete ref="eAutocomplete"></ag-autocomplete>
                <button class="ag-button ag-standard-button ag-advanced-filter-apply-button" ref="eApplyFilterButton"></button>
                <button class="ag-advanced-filter-builder-button" ref="eBuilderFilterButton">
                    <span ref="eBuilderFilterButtonIcon" aria-hidden="true"></span>
                    <span class="ag-advanced-filter-builder-button-label" ref="eBuilderFilterButtonLabel"></span>
                </button>
            </div>`),this.expressionParser=null,this.isApplyDisabled=!0,this.builderOpen=!1}postConstruct(){this.eAutocomplete.setListGenerator((e,t)=>this.generateAutocompleteListParams(t)).setValidator(()=>this.validateValue()).setForceLastSelection((e,t)=>this.forceLastSelection(e,t)).setInputAriaLabel(this.advancedFilterExpressionService.translate("ariaAdvancedFilterInput")).setListAriaLabel(this.advancedFilterExpressionService.translate("ariaLabelAdvancedFilterAutocomplete")),this.refresh(),this.addManagedListener(this.eAutocomplete,U.EVENT_VALUE_CHANGED,({value:e})=>this.onValueChanged(e)),this.addManagedListener(this.eAutocomplete,U.EVENT_VALUE_CONFIRMED,({isValid:e})=>this.onValueConfirmed(e)),this.addManagedListener(this.eAutocomplete,U.EVENT_OPTION_SELECTED,({position:e,updateEntry:t,autocompleteType:i})=>this.onOptionSelected(e,t,i)),this.addManagedListener(this.eAutocomplete,U.EVENT_VALID_CHANGED,({isValid:e,validationMessage:t})=>this.onValidChanged(e,t)),this.setupApplyButton(),this.setupBuilderButton()}refresh(){const e=this.advancedFilterService.getExpressionDisplayValue();this.eAutocomplete.setValue({value:e??"",position:e?.length,updateListOnlyIfOpen:!0})}setInputDisabled(e){this.eAutocomplete.setInputDisabled(e),A.setDisabled(this.eApplyFilterButton,e||this.isApplyDisabled)}getTooltipParams(){const e=super.getTooltipParams();return e.location="advancedFilter",e}setupApplyButton(){this.eApplyFilterButton.innerText=this.advancedFilterExpressionService.translate("advancedFilterApply"),this.activateTabIndex([this.eApplyFilterButton]),this.addManagedListener(this.eApplyFilterButton,"click",()=>this.onValueConfirmed(this.eAutocomplete.isValid())),A.setDisabled(this.eApplyFilterButton,this.isApplyDisabled)}setupBuilderButton(){this.eBuilderFilterButtonIcon.appendChild(A.createIconNoSpan("advancedFilterBuilder",this.gridOptionsService)),this.eBuilderFilterButtonLabel.innerText=this.advancedFilterExpressionService.translate("advancedFilterBuilder"),this.activateTabIndex([this.eBuilderFilterButton]),this.addManagedListener(this.eBuilderFilterButton,"click",()=>this.openBuilder()),this.addManagedListener(this.advancedFilterService.getCtrl(),Le.EVENT_BUILDER_CLOSED,()=>this.closeBuilder())}onValueChanged(e){var t;e=A.makeNull(e),this.advancedFilterService.setExpressionDisplayValue(e),this.expressionParser=this.advancedFilterService.createExpressionParser(e);const i=(t=this.expressionParser)==null?void 0:t.parseExpression();i&&i!==e&&this.eAutocomplete.setValue({value:i,silent:!0,restoreFocus:!0})}onValueConfirmed(e){!e||this.isApplyDisabled||(A.setDisabled(this.eApplyFilterButton,!0),this.advancedFilterService.applyExpression(),this.filterManager.onFilterChanged({source:"advancedFilter"}))}onOptionSelected(e,t,i){const{updatedValue:r,updatedPosition:s,hideAutocomplete:a}=this.updateExpression(e,t,i);this.eAutocomplete.setValue({value:r,position:s,updateListOnlyIfOpen:a,restoreFocus:!0})}validateValue(){var e,t,i;return(e=this.expressionParser)!=null&&e.isValid()?null:(i=(t=this.expressionParser)==null?void 0:t.getValidationMessage())!=null?i:null}onValidChanged(e,t){this.isApplyDisabled=!e||this.advancedFilterService.isCurrentExpressionApplied(),A.setDisabled(this.eApplyFilterButton,this.isApplyDisabled),this.setTooltip({newTooltipText:t,showDelayOverride:1e3})}generateAutocompleteListParams(e){return this.expressionParser?this.expressionParser.getAutocompleteListParams(e):this.advancedFilterExpressionService.getDefaultAutocompleteListParams("")}updateExpression(e,t,i){var r,s;return this.advancedFilterExpressionService.updateAutocompleteCache(t,i),(s=(r=this.expressionParser)==null?void 0:r.updateExpression(e,t,i))!=null?s:this.advancedFilterService.getDefaultExpression(t)}forceLastSelection({key:e,displayValue:t},i){return!!i.toLocaleLowerCase().match(`^${(t??e).toLocaleLowerCase()}\\s*$`)}openBuilder(){this.builderOpen||(this.builderOpen=!0,A.setDisabled(this.eBuilderFilterButton,!0),this.advancedFilterService.getCtrl().toggleFilterBuilder("ui"))}closeBuilder(){this.builderOpen&&(this.builderOpen=!1,A.setDisabled(this.eBuilderFilterButton,!1),this.eBuilderFilterButton.focus())}};l([w("eAutocomplete")],E.prototype,"eAutocomplete",2),l([w("eApplyFilterButton")],E.prototype,"eApplyFilterButton",2),l([w("eBuilderFilterButton")],E.prototype,"eBuilderFilterButton",2),l([w("eBuilderFilterButtonIcon")],E.prototype,"eBuilderFilterButtonIcon",2),l([w("eBuilderFilterButtonLabel")],E.prototype,"eBuilderFilterButtonLabel",2),l([X("advancedFilterService")],E.prototype,"advancedFilterService",2),l([X("advancedFilterExpressionService")],E.prototype,"advancedFilterExpressionService",2),l([X("filterManager")],E.prototype,"filterManager",2),l([je],E.prototype,"postConstruct",1);import{Autowired as J,Bean as Bt,BeanStub as Ot,PostConstruct as Vt,_ as D}from"@ag-grid-community/core";var Lt={ariaAdvancedFilterBuilderItem:e=>`${e[0]}. Level ${e[1]}. Press ENTER to edit.`,ariaAdvancedFilterBuilderItemValidation:e=>`${e[0]}. Level ${e[1]}. ${e[2]} Press ENTER to edit.`,ariaAdvancedFilterBuilderList:"Advanced Filter Builder List",ariaAdvancedFilterBuilderFilterItem:"Filter Condition",ariaAdvancedFilterBuilderGroupItem:"Filter Group",ariaAdvancedFilterBuilderColumn:"Column",ariaAdvancedFilterBuilderOption:"Option",ariaAdvancedFilterBuilderValue:"Value",ariaAdvancedFilterBuilderJoinOperator:"Join Operator",ariaAdvancedFilterInput:"Advanced Filter Input",ariaLabelAdvancedFilterAutocomplete:"Advanced Filter Autocomplete",advancedFilterContains:"contains",advancedFilterNotContains:"does not contain",advancedFilterTextEquals:"equals",advancedFilterTextNotEqual:"does not equal",advancedFilterStartsWith:"begins with",advancedFilterEndsWith:"ends with",advancedFilterBlank:"is blank",advancedFilterNotBlank:"is not blank",advancedFilterEquals:"=",advancedFilterNotEqual:"!=",advancedFilterGreaterThan:">",advancedFilterGreaterThanOrEqual:">=",advancedFilterLessThan:"<",advancedFilterLessThanOrEqual:"<=",advancedFilterTrue:"is true",advancedFilterFalse:"is false",advancedFilterAnd:"AND",advancedFilterOr:"OR",advancedFilterApply:"Apply",advancedFilterBuilder:"Builder",advancedFilterValidationMissingColumn:"Column is missing",advancedFilterValidationMissingOption:"Option is missing",advancedFilterValidationMissingValue:"Value is missing",advancedFilterValidationInvalidColumn:"Column not found",advancedFilterValidationInvalidOption:"Option not found",advancedFilterValidationMissingQuote:"Value is missing an end quote",advancedFilterValidationNotANumber:"Value is not a number",advancedFilterValidationInvalidDate:"Value is not a valid date",advancedFilterValidationMissingCondition:"Condition is missing",advancedFilterValidationJoinOperatorMismatch:"Join operators within a condition must be the same",advancedFilterValidationInvalidJoinOperator:"Join operator not found",advancedFilterValidationMissingEndBracket:"Missing end bracket",advancedFilterValidationExtraEndBracket:"Too many end brackets",advancedFilterValidationMessage:e=>`Expression has an error. ${e[0]} - ${e[1]}.`,advancedFilterValidationMessageAtEnd:e=>`Expression has an error. ${e[0]} at end of expression.`,advancedFilterBuilderTitle:"Advanced Filter",advancedFilterBuilderApply:"Apply",advancedFilterBuilderCancel:"Cancel",advancedFilterBuilderAddButtonTooltip:"Add Filter or Group",advancedFilterBuilderRemoveButtonTooltip:"Remove",advancedFilterBuilderMoveUpButtonTooltip:"Move Up",advancedFilterBuilderMoveDownButtonTooltip:"Move Down",advancedFilterBuilderAddJoin:"Add Group",advancedFilterBuilderAddCondition:"Add Filter",advancedFilterBuilderSelectColumn:"Select a column",advancedFilterBuilderSelectOption:"Select an option",advancedFilterBuilderEnterValue:"Enter a value...",advancedFilterBuilderValidationAlreadyApplied:"Current filter already applied.",advancedFilterBuilderValidationIncomplete:"Not all conditions are complete.",advancedFilterBuilderValidationSelectColumn:"Must select a column.",advancedFilterBuilderValidationSelectOption:"Must select an option.",advancedFilterBuilderValidationEnterValue:"Must enter a value."};function ue(e,t,i){if(!e)return"";const r=i-t;return r?e.slice(0,e.length-r):e}function S(e,t,i,r,s,a,n){const o=i+(!e.length||n?0:1);let d=0;return s&&(e[o]===" "?d=1:(r+=" ",a&&(r+='"'))),{updatedValue:e.slice(0,t)+r+e.slice(o),updatedPosition:t+r.length+d}}function Tt(e,t,i){let r=t;for(;r<i&&e[r]===" ";)r++;return r}function ce(e,t,i,r){let s=t,a=!1;for(;s<e.length;){const n=e[s];if(n==="("){r&&e[s-1]===" "?a=!0:s=s-1;break}else if(n===" "||i&&n===")"){s=s-1;break}s++}return{endPosition:s,isEmpty:a}}function he(e,t,i,r){i!==t&&(e.expression=S(e.expression,r-t.length+1,r,i).updatedValue)}function Mt(e){return e.replace(/(['"])/,"\\$1")}var _t=class{constructor(e,t){this.params=e,this.startPosition=t,this.type="column",this.valid=!0,this.hasStartChar=!1,this.hasEndChar=!1,this.colName=""}parse(e,t){if(e===y.COL_START_CHAR&&!this.colName)this.hasStartChar=!0;else if(e===y.COL_END_CHAR&&this.hasStartChar){if(this.parseColumn(!1,t))return this.hasEndChar=!0,!1;this.colName+=e}else this.colName+=e}getDisplayValue(){return(this.hasStartChar?y.COL_START_CHAR:"")+this.colName+(this.hasEndChar?y.COL_END_CHAR:"")}getColId(){return this.colId}complete(e){this.parseColumn(!0,e)}getValidationError(){var e;return this.valid?null:{message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationInvalidColumn"),startPosition:this.startPosition,endPosition:(e=this.endPosition)!=null?e:this.params.expression.length-1}}parseColumn(e,t){var i;this.endPosition=t;const r=this.params.advancedFilterExpressionService.getColId(this.colName);return r&&this.hasStartChar&&(this.colId=r.colId,he(this.params,this.colName,r.columnName,t-1),this.colName=r.columnName,this.column=this.params.columnModel.getPrimaryColumn(this.colId),this.column)?(this.baseCellDataType=(i=this.params.dataTypeService.getBaseDataType(this.column))!=null?i:"text",!0):(e&&(this.valid=!1),this.baseCellDataType="text",!1)}},wt=class{constructor(e,t,i){this.params=e,this.startPosition=t,this.baseCellDataType=i,this.type="operator",this.valid=!0,this.expectedNumOperands=0,this.operator=""}parse(e,t){if(e===" "||e===")"){if(this.parseOperator(!1,t-1))return!0;this.operator+=e}else this.operator+=e}complete(e){this.parseOperator(!0,e)}getValidationError(){var e;return this.valid?null:{message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationInvalidOption"),startPosition:this.startPosition,endPosition:(e=this.endPosition)!=null?e:this.params.expression.length-1}}getDisplayValue(){return this.operator}getOperatorKey(){return this.parsedOperator}parseOperator(e,t){const i=this.params.advancedFilterExpressionService.getDataTypeExpressionOperator(this.baseCellDataType),r=i.findOperator(this.operator);if(this.endPosition=t,r){this.parsedOperator=r;const a=i.operators[r];this.expectedNumOperands=a.numOperands;const n=a.displayValue;return he(this.params,this.operator,n,t),this.operator=n,!0}return(e||!(r===null))&&(this.valid=!1),!1}},It=class{constructor(e,t,i,r){this.params=e,this.startPosition=t,this.baseCellDataType=i,this.column=r,this.type="operand",this.valid=!0,this.operand="",this.validationMessage=null}parse(e,t){if(e===" ")if(this.quotes)this.operand+=e;else return this.parseOperand(!1,t),!0;else if(e===")"){if(this.baseCellDataType==="number"||!this.quotes)return this.parseOperand(!1,t-1),!0;this.operand+=e}else if(!this.operand&&!this.quotes&&(e==="'"||e==='"'))this.quotes=e;else{if(this.quotes&&e===this.quotes)return this.parseOperand(!1,t),!1;this.operand+=e}}complete(e){this.parseOperand(!0,e)}getValidationError(){var e;return this.validationMessage?{message:this.validationMessage,startPosition:this.startPosition,endPosition:(e=this.endPosition)!=null?e:this.params.expression.length-1}:null}getRawValue(){return this.operand}getModelValue(){return this.modelValue}parseOperand(e,t){const{advancedFilterExpressionService:i}=this.params;if(this.endPosition=t,this.modelValue=this.operand,e&&this.quotes)this.valid=!1,this.validationMessage=i.translate("advancedFilterValidationMissingQuote");else if(this.modelValue==="")this.valid=!1,this.validationMessage=i.translate("advancedFilterValidationMissingValue");else{const r=i.getOperandModelValue(this.operand,this.baseCellDataType,this.column);switch(r!=null&&(this.modelValue=r),this.baseCellDataType){case"number":(this.quotes||isNaN(this.modelValue))&&(this.valid=!1,this.validationMessage=i.translate("advancedFilterValidationNotANumber"));break;case"date":case"dateString":r==null&&(this.valid=!1,this.validationMessage=i.translate("advancedFilterValidationInvalidDate"));break}}}},y=class{constructor(e,t){this.params=e,this.startPosition=t,this.isAwaiting=!0}parseExpression(){var e,t;let i=this.startPosition;const{expression:r}=this.params;for(;i<r.length;){const s=r[i];if(!(s===" "&&this.isAwaiting)){if(this.isAwaiting=!1,!this.parser){let n;this.columnParser?this.operatorParser?(this.operandParser=new It(this.params,i,this.columnParser.baseCellDataType,this.columnParser.column),n=this.operandParser):(this.operatorParser=new wt(this.params,i,this.columnParser.baseCellDataType),n=this.operatorParser):(this.columnParser=new _t(this.params,i),n=this.columnParser),this.parser=n}const a=this.parser.parse(s,i);if(a!=null){if(this.isComplete())return this.returnEndPosition(a?i-1:i,!0);this.parser=void 0,this.isAwaiting=!0}}i++}return(t=(e=this.parser)==null?void 0:e.complete)==null||t.call(e,i-1),this.returnEndPosition(i)}isValid(){return this.isComplete()&&this.columnParser.valid&&this.operatorParser.valid&&(!this.operandParser||this.operandParser.valid)}getValidationError(){var e,t,i,r,s;const a=(s=(i=(e=this.columnParser)==null?void 0:e.getValidationError())!=null?i:(t=this.operatorParser)==null?void 0:t.getValidationError())!=null?s:(r=this.operandParser)==null?void 0:r.getValidationError();if(a)return a;const n=this.params.expression.length;let o;return this.columnParser?this.operatorParser?this.operatorParser.expectedNumOperands&&!this.operandParser&&(o="advancedFilterValidationMissingValue"):o="advancedFilterValidationMissingOption":o="advancedFilterValidationMissingColumn",o?{message:this.params.advancedFilterExpressionService.translate(o),startPosition:n,endPosition:n}:null}getFunction(e){var t,i;const r=this.columnParser.getColId(),s=Mt(r),a=(t=this.operatorParser)==null?void 0:t.getOperatorKey(),{operators:n,evaluatorParams:o,operands:d}=e,p=this.params.advancedFilterExpressionService.getExpressionOperator(this.columnParser.baseCellDataType,a),u=this.addToListAndGetIndex(n,p),v=this.params.advancedFilterExpressionService.getExpressionEvaluatorParams(r),f=this.addToListAndGetIndex(o,v);let c;return((i=this.operatorParser)==null?void 0:i.expectedNumOperands)===0?c="":c=`, params.operands[${this.addToListAndGetIndex(d,this.getOperandValue())}]`,`params.operators[${u}].evaluator(expressionProxy.getValue('${s}', node), node, params.evaluatorParams[${f}]${c})`}getAutocompleteListParams(e){if(this.isColumnPosition(e))return this.getColumnAutocompleteListParams(e);if(this.isOperatorPosition(e))return this.getOperatorAutocompleteListParams(e);if(!this.isBeyondEndPosition(e))return{enabled:!1}}updateExpression(e,t,i){var r,s,a,n,o;const{expression:d}=this.params;if(this.isColumnPosition(e))return S(this.params.expression,this.startPosition,(r=this.columnParser)!=null&&r.getColId()?this.columnParser.endPosition:ce(d,e).endPosition,this.params.advancedFilterExpressionService.getColumnValue(t),!0);if(this.isOperatorPosition(e)){const p=this.getBaseCellDataTypeFromOperatorAutocompleteType(i),u=this.hasOperand(p,t.key),v=u&&this.doesOperandNeedQuotes(p);let f;if(((s=this.operatorParser)==null?void 0:s.startPosition)!=null&&e<this.operatorParser.startPosition)f=S(d,e,e,(a=t.displayValue)!=null?a:t.key,u,v);else{let c,O=!1;if((n=this.operatorParser)!=null&&n.getOperatorKey())c=this.operatorParser.endPosition;else{const{endPosition:L,isEmpty:x}=ce(d,e,!0,!0);c=L,O=x}f=S(d,Tt(d,this.columnParser.endPosition+1,c),c,(o=t.displayValue)!=null?o:t.key,u,v,O)}return Y(Q({},f),{hideAutocomplete:!u})}return null}getModel(){const e=this.columnParser.getColId(),t={filterType:this.columnParser.baseCellDataType,colId:e,type:this.operatorParser.getOperatorKey()};return this.operatorParser.expectedNumOperands&&(t.filter=this.operandParser.getModelValue()),t}getOperandValue(){let e=this.operandParser.getRawValue();const{baseCellDataType:t,column:i}=this.columnParser;switch(t){case"number":e=Number(e);break;case"date":case"dateString":e=this.params.valueParserService.parseValue(i,null,e,void 0);break}return t==="dateString"?this.params.dataTypeService.getDateParserFunction(i)(e):e}isComplete(){return!!(this.operatorParser&&(!this.operatorParser.expectedNumOperands||this.operatorParser.expectedNumOperands&&this.operandParser))}isColumnPosition(e){return!this.columnParser||this.columnParser.endPosition==null||e<=this.columnParser.endPosition+1}isOperatorPosition(e){return!this.operatorParser||this.operatorParser.endPosition==null||e<=this.operatorParser.endPosition+1}isBeyondEndPosition(e){return this.isComplete()&&this.endPosition!=null&&e>this.endPosition+1&&this.endPosition+1<this.params.expression.length}returnEndPosition(e,t){return this.endPosition=t?e:e-1,e}getColumnAutocompleteListParams(e){return this.params.advancedFilterExpressionService.generateAutocompleteListParams(this.params.advancedFilterExpressionService.getColumnAutocompleteEntries(),"column",this.getColumnSearchString(e))}getColumnSearchString(e){var t,i,r,s,a;const n=(i=(t=this.columnParser)==null?void 0:t.getDisplayValue())!=null?i:"",o=ue(n,e,((r=this.columnParser)==null?void 0:r.endPosition)==null?this.params.expression.length:this.columnParser.endPosition+1),d=((s=this.columnParser)==null?void 0:s.hasStartChar)&&o.length>0,p=((a=this.columnParser)==null?void 0:a.hasEndChar)&&o.length===n.length+2;return d?o.slice(1,p?-1:void 0):o}getOperatorAutocompleteListParams(e){var t,i,r,s,a;const n=(t=this.columnParser)==null?void 0:t.column;if(!n)return{enabled:!1};const o=this.columnParser.baseCellDataType,d=((i=this.operatorParser)==null?void 0:i.startPosition)!=null&&e<this.operatorParser.startPosition?"":ue((s=(r=this.operatorParser)==null?void 0:r.getDisplayValue())!=null?s:"",e,((a=this.operatorParser)==null?void 0:a.endPosition)==null?this.params.expression.length:this.operatorParser.endPosition+1);return this.params.advancedFilterExpressionService.generateAutocompleteListParams(this.params.advancedFilterExpressionService.getOperatorAutocompleteEntries(n,o),`operator-${o}`,d)}getBaseCellDataTypeFromOperatorAutocompleteType(e){return e?.replace("operator-","")}hasOperand(e,t){var i,r;return!e||!t||((r=(i=this.params.advancedFilterExpressionService.getExpressionOperator(e,t))==null?void 0:i.numOperands)!=null?r:0)>0}doesOperandNeedQuotes(e){return e!=="number"}addToListAndGetIndex(e,t){const i=e.length;return e.push(t),i}};y.COL_START_CHAR="[",y.COL_END_CHAR="]";function z(e,t,i){let r=!1;const s=e.toLocaleLowerCase(),a=s+" ",n=Object.entries(t).find(([o,d])=>{const p=i(d).toLocaleLowerCase();return p.startsWith(a)&&(r=!0),p===s});return n?n[0]:r?null:void 0}function ve(e,t){return(t??Object.keys(e)).map(r=>({key:r,displayValue:e[r].displayValue}))}var Te=class{constructor(e){this.params=e,this.initOperators()}getEntries(e){return ve(this.operators,e)}findOperator(e){return z(e,this.operators,({displayValue:t})=>t)}initOperators(){const{translate:e}=this.params;this.operators={contains:{displayValue:e("advancedFilterContains"),evaluator:(t,i,r,s)=>this.evaluateExpression(t,i,r,s,!1,(a,n)=>a.includes(n)),numOperands:1},notContains:{displayValue:e("advancedFilterNotContains"),evaluator:(t,i,r,s)=>this.evaluateExpression(t,i,r,s,!0,(a,n)=>!a.includes(n)),numOperands:1},equals:{displayValue:e("advancedFilterTextEquals"),evaluator:(t,i,r,s)=>this.evaluateExpression(t,i,r,s,!1,(a,n)=>a===n),numOperands:1},notEqual:{displayValue:e("advancedFilterTextNotEqual"),evaluator:(t,i,r,s)=>this.evaluateExpression(t,i,r,s,!0,(a,n)=>a!=n),numOperands:1},startsWith:{displayValue:e("advancedFilterStartsWith"),evaluator:(t,i,r,s)=>this.evaluateExpression(t,i,r,s,!1,(a,n)=>a.startsWith(n)),numOperands:1},endsWith:{displayValue:e("advancedFilterEndsWith"),evaluator:(t,i,r,s)=>this.evaluateExpression(t,i,r,s,!1,(a,n)=>a.endsWith(n)),numOperands:1},blank:{displayValue:e("advancedFilterBlank"),evaluator:t=>t==null||typeof t=="string"&&t.trim().length===0,numOperands:0},notBlank:{displayValue:e("advancedFilterNotBlank"),evaluator:t=>t!=null&&(typeof t!="string"||t.trim().length>0),numOperands:0}}}evaluateExpression(e,t,i,r,s,a){return e==null?s:i.caseSensitive?a(i.valueConverter(e,t),r):a(i.valueConverter(e,t).toLocaleLowerCase(),r.toLocaleLowerCase())}},me=class{constructor(e){this.params=e,this.initOperators()}getEntries(e){return ve(this.operators,e)}findOperator(e){return z(e,this.operators,({displayValue:t})=>t)}initOperators(){const{translate:e,equals:t}=this.params;this.operators={equals:{displayValue:e("advancedFilterEquals"),evaluator:(i,r,s,a)=>this.evaluateSingleOperandExpression(i,r,s,a,!!s.includeBlanksInEquals,t),numOperands:1},notEqual:{displayValue:e("advancedFilterNotEqual"),evaluator:(i,r,s,a)=>this.evaluateSingleOperandExpression(i,r,s,a,!!s.includeBlanksInEquals,(n,o)=>!t(n,o)),numOperands:1},greaterThan:{displayValue:e("advancedFilterGreaterThan"),evaluator:(i,r,s,a)=>this.evaluateSingleOperandExpression(i,r,s,a,!!s.includeBlanksInGreaterThan,(n,o)=>n>o),numOperands:1},greaterThanOrEqual:{displayValue:e("advancedFilterGreaterThanOrEqual"),evaluator:(i,r,s,a)=>this.evaluateSingleOperandExpression(i,r,s,a,!!s.includeBlanksInGreaterThan,(n,o)=>n>=o),numOperands:1},lessThan:{displayValue:e("advancedFilterLessThan"),evaluator:(i,r,s,a)=>this.evaluateSingleOperandExpression(i,r,s,a,!!s.includeBlanksInLessThan,(n,o)=>n<o),numOperands:1},lessThanOrEqual:{displayValue:e("advancedFilterLessThanOrEqual"),evaluator:(i,r,s,a)=>this.evaluateSingleOperandExpression(i,r,s,a,!!s.includeBlanksInLessThan,(n,o)=>n<=o),numOperands:1},blank:{displayValue:e("advancedFilterBlank"),evaluator:i=>i==null,numOperands:0},notBlank:{displayValue:e("advancedFilterNotBlank"),evaluator:i=>i!=null,numOperands:0}}}evaluateSingleOperandExpression(e,t,i,r,s,a){return e==null?s:a(i.valueConverter(e,t),r)}},Nt=class{constructor(e){this.params=e,this.initOperators()}getEntries(e){return ve(this.operators,e)}findOperator(e){return z(e,this.operators,({displayValue:t})=>t)}initOperators(){const{translate:e}=this.params;this.operators={true:{displayValue:e("advancedFilterTrue"),evaluator:t=>!!t,numOperands:0},false:{displayValue:e("advancedFilterFalse"),evaluator:t=>t===!1,numOperands:0},blank:{displayValue:e("advancedFilterBlank"),evaluator:t=>t==null,numOperands:0},notBlank:{displayValue:e("advancedFilterNotBlank"),evaluator:t=>t!=null,numOperands:0}}}},B=class extends Ot{constructor(){super(...arguments),this.columnNameToIdMap={},this.columnAutocompleteEntries=null,this.expressionEvaluatorParams={}}postConstruct(){this.expressionJoinOperators=this.generateExpressionJoinOperators(),this.expressionOperators=this.generateExpressionOperators()}parseJoinOperator(e){var t;const{type:i}=e;return(t=this.expressionJoinOperators[i])!=null?t:i}getColumnDisplayValue(e){const{colId:t}=e,r=this.getColumnAutocompleteEntries().find(({key:a})=>a===t);let s;return r?(s=r.displayValue,this.columnNameToIdMap[s.toLocaleUpperCase()]={colId:t,columnName:s}):s=t,s}getOperatorDisplayValue(e){var t,i;return(i=(t=this.getExpressionOperator(e.filterType,e.type))==null?void 0:t.displayValue)!=null?i:e.type}getOperandModelValue(e,t,i){var r;switch(t){case"number":return D.exists(e)?Number(e):null;case"date":return D.serialiseDate(this.valueParserService.parseValue(i,null,e,void 0),!1);case"dateString":const s=this.valueParserService.parseValue(i,null,e,void 0);return D.serialiseDate((r=this.dataTypeService.getDateParserFunction(i)(s))!=null?r:null,!1)}return e}getOperandDisplayValue(e,t){var i,r;const{colId:s,filter:a}=e,n=this.columnModel.getPrimaryColumn(s);let o="";if(a!=null){let d;switch(e.filterType){case"number":d=(i=D.toStringOrNull(a))!=null?i:"";break;case"date":const p=D.parseDateTimeFromString(a);d=n?this.valueFormatterService.formatValue(n,null,p):null;break;case"dateString":const u=D.parseDateTimeFromString(a),v=n?this.dataTypeService.getDateFormatterFunction(n)(u??void 0):null;d=n?this.valueFormatterService.formatValue(n,null,v):null;break}e.filterType!=="number"&&(d=(r=d??D.toStringOrNull(a))!=null?r:"",t||(d=`"${d}"`)),o=t?d:` ${d}`}return o}parseColumnFilterModel(e){var t,i;const r=(t=this.getColumnDisplayValue(e))!=null?t:"",s=(i=this.getOperatorDisplayValue(e))!=null?i:"",a=this.getOperandDisplayValue(e);return`[${r}] ${s}${a}`}updateAutocompleteCache(e,t){if(t==="column"){const{key:i,displayValue:r}=e;this.columnNameToIdMap[e.displayValue.toLocaleUpperCase()]={colId:i,columnName:r}}}translate(e,t){let i=Lt[e];return typeof i=="function"&&(i=i(t)),this.localeService.getLocaleTextFunc()(e,i,t)}generateAutocompleteListParams(e,t,i){return{enabled:!0,type:t,searchString:i,entries:e}}getColumnAutocompleteEntries(){var e;if(this.columnAutocompleteEntries)return this.columnAutocompleteEntries;const t=(e=this.columnModel.getAllPrimaryColumns())!=null?e:[],i=[],r=this.gridOptionsService.get("includeHiddenColumnsInAdvancedFilter");return t.forEach(s=>{s.getColDef().filter&&(r||s.isVisible()||s.isRowGroupActive())&&i.push({key:s.getColId(),displayValue:this.columnModel.getDisplayNameForColumn(s,"advancedFilter")})}),i.sort((s,a)=>{var n,o;const d=(n=s.displayValue)!=null?n:"",p=(o=a.displayValue)!=null?o:"";return d<p?-1:p>d?1:0}),i}getOperatorAutocompleteEntries(e,t){const i=this.getActiveOperators(e);return this.getDataTypeExpressionOperator(t).getEntries(i)}getJoinOperatorAutocompleteEntries(){return Object.entries(this.expressionJoinOperators).map(([e,t])=>({key:e,displayValue:t}))}getDefaultAutocompleteListParams(e){return this.generateAutocompleteListParams(this.getColumnAutocompleteEntries(),"column",e)}getDataTypeExpressionOperator(e){return this.expressionOperators[e]}getExpressionOperator(e,t){var i,r;return(r=(i=this.getDataTypeExpressionOperator(e))==null?void 0:i.operators)==null?void 0:r[t]}getExpressionJoinOperators(){return this.expressionJoinOperators}getColId(e){const t=e.toLocaleUpperCase(),i=this.columnNameToIdMap[t];if(i)return i;const s=this.getColumnAutocompleteEntries().find(({displayValue:a})=>a.toLocaleUpperCase()===t);if(s){const{key:a,displayValue:n}=s,o={colId:a,columnName:n};return this.columnNameToIdMap[t]=o,o}return null}getExpressionEvaluatorParams(e){let t=this.expressionEvaluatorParams[e];if(t)return t;const i=this.columnModel.getPrimaryColumn(e);if(!i)return{valueConverter:a=>a};switch(this.dataTypeService.getBaseDataType(i)){case"dateString":t={valueConverter:this.dataTypeService.getDateParserFunction(i)};break;case"object":i.getColDef().filterValueGetter?t={valueConverter:a=>a}:t={valueConverter:(a,n)=>{var o;return(o=this.valueFormatterService.formatValue(i,n,a))!=null?o:typeof a.toString=="function"?a.toString():""}};break;case"text":case void 0:t={valueConverter:a=>D.toStringOrNull(a)};break;default:t={valueConverter:a=>a};break}const{filterParams:s}=i.getColDef();return s&&["caseSensitive","includeBlanksInEquals","includeBlanksInLessThan","includeBlanksInGreaterThan"].forEach(a=>{const n=s[a];n&&(t[a]=n)}),this.expressionEvaluatorParams[e]=t,t}getColumnDetails(e){var t,i;const r=(t=this.columnModel.getPrimaryColumn(e))!=null?t:void 0,s=(i=r?this.dataTypeService.getBaseDataType(r):void 0)!=null?i:"text";return{column:r,baseCellDataType:s}}generateExpressionOperators(){const e=(t,i)=>this.translate(t,i);return{text:new Te({translate:e}),boolean:new Nt({translate:e}),object:new Te({translate:e}),number:new me({translate:e,equals:(t,i)=>t===i}),date:new me({translate:e,equals:(t,i)=>t.getTime()===i.getTime()}),dateString:new me({translate:e,equals:(t,i)=>t.getTime()===i.getTime()})}}getColumnValue({displayValue:e}){return`${y.COL_START_CHAR}${e}${y.COL_END_CHAR}`}generateExpressionJoinOperators(){return{AND:this.translate("advancedFilterAnd"),OR:this.translate("advancedFilterOr")}}getActiveOperators(e){var t;const i=(t=e.getColDef().filterParams)==null?void 0:t.filterOptions;return i&&i.every(s=>typeof s=="string")?i:void 0}resetColumnCaches(){this.columnAutocompleteEntries=null,this.columnNameToIdMap={},this.expressionEvaluatorParams={}}};l([J("valueFormatterService")],B.prototype,"valueFormatterService",2),l([J("valueParserService")],B.prototype,"valueParserService",2),l([J("columnModel")],B.prototype,"columnModel",2),l([J("dataTypeService")],B.prototype,"dataTypeService",2),l([Vt],B.prototype,"postConstruct",1),B=l([Bt("advancedFilterExpressionService")],B);import{Autowired as _,Bean as kt,BeanStub as Rt,Events as ge,PostConstruct as Gt,_ as Me}from"@ag-grid-community/core";var Wt=class{constructor(e){this.params=e,this.operators=[],this.operatorStartPositions=[],this.operatorEndPositions=[],this.activeOperator=0,this.validationError=null}parseExpression(e){this.operators.push(""),this.operatorStartPositions.push(e),this.operatorEndPositions.push(void 0);const{expression:t}=this.params;for(;e<t.length;){const i=t[e];if(i===" "){if(this.parseOperator(e-1))return this.activeOperator++,e-1;this.operators[this.activeOperator]+=i}else this.operators[this.activeOperator]+=i;e++}return this.parseOperator(e-1),e}isValid(){return!this.validationError&&(!this.operators.length||!!this.parsedOperator)}getValidationError(){return this.validationError}getFunction(){return this.parsedOperator==="OR"?"||":"&&"}getModel(){return this.parsedOperator==="OR"?"OR":"AND"}getAutocompleteListParams(e,t){let i;if(t==null)i="";else{const s=this.operators[t],a=this.operatorEndPositions[t];i=ue(s,e,a==null?this.params.expression.length:a+1)}let r=this.params.advancedFilterExpressionService.getJoinOperatorAutocompleteEntries();return(t||t==null&&this.activeOperator)&&(r=r.filter(({key:s})=>s===this.parsedOperator)),this.params.advancedFilterExpressionService.generateAutocompleteListParams(r,"join",i)}updateExpression(e,t,i){var r,s;let{expression:a}=this.params;const n=(r=t.displayValue)!=null?r:t.key;if(i===0)for(let p=this.operatorEndPositions.length-1;p>0;p--){const u=this.operatorEndPositions[p];u!=null&&(a=S(a,this.operatorStartPositions[p],u,n).updatedValue)}const o=this.operatorStartPositions.length>i?this.operatorStartPositions[i]:e,d=(s=this.operatorEndPositions.length>i?this.operatorEndPositions[i]:void 0)!=null?s:ce(a,e,!0).endPosition;return S(a,o,d,n,!0)}getNumOperators(){return this.operators.length}getLastOperatorEndPosition(){return this.operatorEndPositions[this.operatorEndPositions.length-1]}parseOperator(e){const t=this.operators.length>this.activeOperator?this.operators[this.activeOperator]:"",i=this.params.advancedFilterExpressionService.getExpressionJoinOperators(),r=z(t,i,s=>s);if(r){this.operatorEndPositions[this.activeOperator]=e;const s=i[r];if(this.activeOperator){if(r!==this.parsedOperator)return this.validationError||(this.validationError={message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationJoinOperatorMismatch"),startPosition:e-t.length+1,endPosition:e}),!1}else this.parsedOperator=r;return t!==s&&(he(this.params,t,s,e),this.operators[this.activeOperator]=s),!0}else return r===null?!1:(this.validationError||(this.validationError={message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationInvalidJoinOperator"),startPosition:e-t.length+1,endPosition:e}),!0)}},Ht=class we{constructor(t,i){this.params=t,this.startPosition=i,this.expectingExpression=!0,this.expectingOperator=!1,this.expressionParsers=[],this.operatorParser=new Wt(this.params),this.missingEndBracket=!1,this.extraEndBracket=!1}parseExpression(){let t=this.startPosition;const{expression:i}=this.params;for(;t<i.length;){const r=i[t];if(r==="("&&!this.expectingOperator){const s=new we(this.params,t+1);t=s.parseExpression(),this.expressionParsers.push(s),this.expectingExpression=!1,this.expectingOperator=!0}else{if(r===")")return this.endPosition=t-1,this.startPosition===0&&(this.extraEndBracket=!0),t;if(r!==" ")if(this.expectingExpression){const s=new y(this.params,t);t=s.parseExpression(),this.expressionParsers.push(s),this.expectingExpression=!1,this.expectingOperator=!0}else this.expectingOperator&&(t=this.operatorParser.parseExpression(t),this.expectingOperator=!1,this.expectingExpression=!0)}t++}return this.startPosition>0&&(this.missingEndBracket=!0),t}isValid(){return!this.missingEndBracket&&!this.extraEndBracket&&this.expressionParsers.length===this.operatorParser.getNumOperators()+1&&this.operatorParser.isValid()&&this.expressionParsers.every(t=>t.isValid())}getValidationError(){const t=this.operatorParser.getValidationError();for(let r=0;r<this.expressionParsers.length;r++){const s=this.expressionParsers[r].getValidationError();if(s)return t&&t.startPosition<s.startPosition?t:s}if(t)return t;if(this.extraEndBracket)return{message:this.params.advancedFilterExpressionService.translate("advancedFilterValidationExtraEndBracket"),startPosition:this.endPosition+1,endPosition:this.endPosition+1};let i;return this.expressionParsers.length===this.operatorParser.getNumOperators()?i="advancedFilterValidationMissingCondition":this.missingEndBracket&&(i="advancedFilterValidationMissingEndBracket"),i?{message:this.params.advancedFilterExpressionService.translate(i),startPosition:this.params.expression.length,endPosition:this.params.expression.length}:null}getFunction(t){const i=this.expressionParsers.length>1,r=this.expressionParsers.map(s=>s.getFunction(t)).join(` ${this.operatorParser.getFunction()} `);return i?`(${r})`:r}getAutocompleteListParams(t){if(this.endPosition!=null&&t>this.endPosition+1)return;if(!this.expressionParsers.length)return this.getColumnAutocompleteListParams();const i=this.getExpressionParserIndex(t);if(i==null)return this.params.expression[t]==="("?{enabled:!1}:this.getColumnAutocompleteListParams();const s=this.expressionParsers[i].getAutocompleteListParams(t);if(!s){if(i<this.expressionParsers.length-1)return this.operatorParser.getAutocompleteListParams(t,i);if(this.expressionParsers.length===this.operatorParser.getNumOperators()){const a=this.operatorParser.getLastOperatorEndPosition();return a==null||t<=a+1?this.operatorParser.getAutocompleteListParams(t,this.operatorParser.getNumOperators()-1):this.getColumnAutocompleteListParams()}return this.params.expression[t-1]===")"?{enabled:!1}:this.operatorParser.getAutocompleteListParams(t)}return s}updateExpression(t,i,r){var s;const a=this.params.expression,n=this.getExpressionParserIndex(t);if(n==null){const p=r==="column"?this.params.advancedFilterExpressionService.getColumnValue(i):(s=i.displayValue)!=null?s:i.key;return S(a,this.startPosition,this.startPosition,p,!0)}const d=this.expressionParsers[n].updateExpression(t,i,r);return d??(r==="column"?S(a,t,a.length-1,this.params.advancedFilterExpressionService.getColumnValue(i),!0):this.endPosition!=null&&t>this.endPosition+1?null:this.operatorParser.updateExpression(t,i,n))}getModel(){return this.expressionParsers.length>1?{filterType:"join",type:this.operatorParser.getModel(),conditions:this.expressionParsers.map(t=>t.getModel())}:this.expressionParsers[0].getModel()}getColumnAutocompleteListParams(){return this.params.advancedFilterExpressionService.generateAutocompleteListParams(this.params.advancedFilterExpressionService.getColumnAutocompleteEntries(),"column","")}getExpressionParserIndex(t){let i;for(let r=0;r<this.expressionParsers.length&&!(this.expressionParsers[r].startPosition>t);r++)i=r;return i}},Ut=class{constructor(e){this.params=e,this.valid=!1}parseExpression(){this.joinExpressionParser=new Ht(this.params,0);const e=this.joinExpressionParser.parseExpression();return this.valid=e>=this.params.expression.length-1&&this.joinExpressionParser.isValid(),this.params.expression}isValid(){return this.valid}getValidationMessage(){const e=this.joinExpressionParser.getValidationError();if(!e)return null;const{message:t,startPosition:i,endPosition:r}=e;return i<this.params.expression.length?this.params.advancedFilterExpressionService.translate("advancedFilterValidationMessage",[t,this.params.expression.slice(i,r+1).trim()]):this.params.advancedFilterExpressionService.translate("advancedFilterValidationMessageAtEnd",[t])}getFunction(){const e={operands:[],operators:[],evaluatorParams:[]};return{functionBody:`return ${this.joinExpressionParser.getFunction(e)};`,params:e}}getAutocompleteListParams(e){var t;return(t=this.joinExpressionParser.getAutocompleteListParams(e))!=null?t:{enabled:!1}}updateExpression(e,t,i){return this.joinExpressionParser.updateExpression(e,t,i)}getModel(){return this.isValid()?this.joinExpressionParser.getModel():null}},F=class extends Rt{constructor(){super(...arguments),this.appliedExpression=null,this.expression=null,this.isValid=!0}postConstruct(){this.setEnabled(this.gridOptionsService.get("enableAdvancedFilter"),!0),this.ctrl=this.createManagedBean(new Le(this.enabled)),this.expressionProxy={getValue:(e,t)=>{const i=this.columnModel.getPrimaryColumn(e);return i?this.valueService.getValue(i,t,!0):void 0}},this.addManagedPropertyListener("enableAdvancedFilter",e=>this.setEnabled(!!e.currentValue)),this.addManagedListener(this.eventService,ge.EVENT_NEW_COLUMNS_LOADED,e=>this.onNewColumnsLoaded(e)),this.addManagedPropertyListener("includeHiddenColumnsInAdvancedFilter",()=>this.updateValidity())}isEnabled(){return this.enabled}isFilterPresent(){return!!this.expressionFunction}doesFilterPass(e){return this.expressionFunction(this.expressionProxy,e,this.expressionParams)}getModel(){var e;const t=this.createExpressionParser(this.appliedExpression);return t?.parseExpression(),(e=t?.getModel())!=null?e:null}setModel(e){const t=(r,s)=>{if(r.filterType==="join"){const a=this.advancedFilterExpressionService.parseJoinOperator(r),n=r.conditions.map(o=>t(o)).filter(o=>Me.exists(o)).join(` ${a} `);return s||r.conditions.length<=1?n:`(${n})`}else return this.advancedFilterExpressionService.parseColumnFilterModel(r)},i=e?t(e,!0):null;this.setExpressionDisplayValue(i),this.applyExpression(),this.ctrl.refreshComp(),this.ctrl.refreshBuilderComp()}getExpressionDisplayValue(){return this.expression}setExpressionDisplayValue(e){this.expression=e}isCurrentExpressionApplied(){return this.appliedExpression===this.expression}createExpressionParser(e){return e?new Ut({expression:e,columnModel:this.columnModel,dataTypeService:this.dataTypeService,valueParserService:this.valueParserService,advancedFilterExpressionService:this.advancedFilterExpressionService}):null}getDefaultExpression(e){const t=this.advancedFilterExpressionService.getColumnValue(e)+" ";return{updatedValue:t,updatedPosition:t.length}}isHeaderActive(){return!this.gridOptionsService.get("advancedFilterParent")}getCtrl(){return this.ctrl}setEnabled(e,t){const i=this.enabled,r=this.rowModel.getType(),s=r==="clientSide"||r==="serverSide";if(e&&!r&&Me.warnOnce("Advanced Filter is only supported with the Client-Side Row Model or Server-Side Row Model."),this.enabled=e&&s,!t&&this.enabled!==i){const a={type:ge.EVENT_ADVANCED_FILTER_ENABLED_CHANGED,enabled:this.enabled};this.eventService.dispatchEvent(a)}}applyExpression(){const e=this.createExpressionParser(this.expression);e?.parseExpression(),this.applyExpressionFromParser(e)}applyExpressionFromParser(e){if(this.isValid=!e||e.isValid(),!e||!this.isValid){this.expressionFunction=null,this.expressionParams=null,this.appliedExpression=null;return}const{functionBody:t,params:i}=e.getFunction();this.expressionFunction=new Function("expressionProxy","node","params",t),this.expressionParams=i,this.appliedExpression=this.expression}updateValidity(){this.advancedFilterExpressionService.resetColumnCaches();const e=this.createExpressionParser(this.expression);e?.parseExpression();const i=(!e||e.isValid())!==this.isValid;return this.applyExpressionFromParser(e),this.ctrl.refreshComp(),this.ctrl.refreshBuilderComp(),i}onNewColumnsLoaded(e){if(e.source!=="gridInitializing"||!this.dataTypeService.isPendingInference())return;this.ctrl.setInputDisabled(!0);const t=this.addManagedListener(this.eventService,ge.EVENT_DATA_TYPES_INFERRED,()=>{t?.(),this.ctrl.setInputDisabled(!1)})}};l([_("valueService")],F.prototype,"valueService",2),l([_("columnModel")],F.prototype,"columnModel",2),l([_("dataTypeService")],F.prototype,"dataTypeService",2),l([_("valueParserService")],F.prototype,"valueParserService",2),l([_("rowModel")],F.prototype,"rowModel",2),l([_("advancedFilterExpressionService")],F.prototype,"advancedFilterExpressionService",2),l([Gt],F.prototype,"postConstruct",1),F=l([kt("advancedFilterService")],F);var jt="31.2.1",$t={version:jt,moduleName:We.AdvancedFilterModule,beans:[F,B],agStackComponents:[{componentName:"agAdvancedFilter",componentClass:E}],dependantModules:[He]};export{$t as AdvancedFilterModule};
