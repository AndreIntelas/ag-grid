var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__export=(e,t)=>{for(var o in t)__defProp(e,o,{get:t[o],enumerable:!0})},__copyProps=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of __getOwnPropNames(t))!__hasOwnProp.call(e,s)&&s!==o&&__defProp(e,s,{get:()=>t[s],enumerable:!(r=__getOwnPropDesc(t,s))||r.enumerable});return e},__toCommonJS=e=>__copyProps(__defProp({},"__esModule",{value:!0}),e),__decorateClass=(e,t,o,r)=>{for(var s=r>1?void 0:r?__getOwnPropDesc(t,o):t,i=e.length-1,n;i>=0;i--)(n=e[i])&&(s=(r?n(t,o,s):n(s))||s);return r&&s&&__defProp(t,o,s),s},main_exports={};__export(main_exports,{ViewportRowModelModule:()=>ViewportRowModelModule}),module.exports=__toCommonJS(main_exports);var import_core2=require("@ag-grid-community/core"),import_core3=require("@ag-grid-enterprise/core"),VERSION="31.2.1",import_core=require("@ag-grid-community/core"),ViewportRowModel=class extends import_core.BeanStub{constructor(){super(...arguments),this.firstRow=-1,this.lastRow=-1,this.rowCount=-1,this.rowNodesByIndex={}}ensureRowHeightsValid(e,t,o,r){return!1}init(){this.rowHeight=this.gridOptionsService.getRowHeightAsNumber(),this.addManagedListener(this.eventService,import_core.Events.EVENT_VIEWPORT_CHANGED,this.onViewportChanged.bind(this)),this.addManagedPropertyListener("viewportDatasource",()=>this.updateDatasource()),this.addManagedPropertyListener("rowHeight",()=>{this.rowHeight=this.gridOptionsService.getRowHeightAsNumber(),this.updateRowHeights()})}start(){this.updateDatasource()}isLastRowIndexKnown(){return!0}destroyDatasource(){this.viewportDatasource&&(this.viewportDatasource.destroy&&this.viewportDatasource.destroy(),this.rowRenderer.datasourceChanged(),this.firstRow=-1,this.lastRow=-1)}updateDatasource(){const e=this.gridOptionsService.get("viewportDatasource");e&&this.setViewportDatasource(e)}getViewportRowModelPageSize(){return this.gridOptionsService.get("viewportRowModelPageSize")}getViewportRowModelBufferSize(){return this.gridOptionsService.get("viewportRowModelBufferSize")}calculateFirstRow(e){const t=this.getViewportRowModelBufferSize(),o=this.getViewportRowModelPageSize(),r=e-t;return r<0?0:Math.floor(r/o)*o}calculateLastRow(e){if(e===-1)return e;const t=this.getViewportRowModelBufferSize(),o=this.getViewportRowModelPageSize(),r=e+t,s=Math.ceil(r/o)*o,i=this.rowCount-1;return Math.min(s,i)}onViewportChanged(e){const t=this.calculateFirstRow(e.firstRow),o=this.calculateLastRow(e.lastRow);(this.firstRow!==t||this.lastRow!==o)&&(this.firstRow=t,this.lastRow=o,this.purgeRowsNotInViewport(),this.viewportDatasource&&this.viewportDatasource.setViewportRange(this.firstRow,this.lastRow))}purgeRowsNotInViewport(){Object.keys(this.rowNodesByIndex).forEach(e=>{const t=parseInt(e,10);if(t<this.firstRow||t>this.lastRow){if(this.isRowFocused(t))return;delete this.rowNodesByIndex[t]}})}isRowFocused(e){const t=this.focusService.getFocusCellToUseAfterRefresh();return!t||t.rowPinned!=null?!1:t.rowIndex===e}setViewportDatasource(e){this.destroyDatasource(),this.viewportDatasource=e,this.rowCount=-1,e.init?e.init({setRowCount:this.setRowCount.bind(this),setRowData:this.setRowData.bind(this),getRow:this.getRow.bind(this)}):console.warn("AG Grid: viewport is missing init method.")}getType(){return"viewport"}getRow(e){return this.rowNodesByIndex[e]||(this.rowNodesByIndex[e]=this.createBlankRowNode(e)),this.rowNodesByIndex[e]}getRowNode(e){let t;return this.forEachNode(o=>{o.id===e&&(t=o)}),t}getRowCount(){return this.rowCount===-1?0:this.rowCount}getRowIndexAtPixel(e){return this.rowHeight!==0?Math.floor(e/this.rowHeight):0}getRowBounds(e){return{rowHeight:this.rowHeight,rowTop:this.rowHeight*e}}updateRowHeights(){this.forEachNode(t=>{t.setRowHeight(this.rowHeight),t.setRowTop(this.rowHeight*t.rowIndex)});const e={type:import_core.Events.EVENT_MODEL_UPDATED,newData:!1,newPage:!1,keepRenderedRows:!0,animate:!1};this.eventService.dispatchEvent(e)}getTopLevelRowCount(){return this.getRowCount()}getTopLevelRowDisplayedIndex(e){return e}isEmpty(){return this.rowCount>0}isRowsToRender(){return this.rowCount>0}getNodesInRangeForSelection(e,t){const o=import_core._.missing(e)?0:e.rowIndex,r=t.rowIndex,s=o<this.firstRow||o>this.lastRow,i=r<this.firstRow||r>this.lastRow;if(s||i)return[];const n=[],w=o<=r?o:r,h=o<=r?r:o;for(let a=w;a<=h;a++)n.push(this.rowNodesByIndex[a]);return n}forEachNode(e){let t=0;Object.keys(this.rowNodesByIndex).forEach(o=>{const r=parseInt(o,10),s=this.rowNodesByIndex[r];e(s,t),t++})}setRowData(e){import_core._.iterateObject(e,(t,o)=>{const r=parseInt(t,10);if(r>=this.firstRow&&r<=this.lastRow){let s=this.rowNodesByIndex[r];import_core._.missing(s)&&(s=this.createBlankRowNode(r),this.rowNodesByIndex[r]=s),s.setDataAndId(o,r.toString())}})}createBlankRowNode(e){const t=new import_core.RowNode(this.beans);return t.setRowHeight(this.rowHeight),t.setRowTop(this.rowHeight*e),t.setRowIndex(e),t}setRowCount(e,t=!1){if(e===this.rowCount)return;this.rowCount=e,this.eventService.dispatchEventOnce({type:import_core.Events.EVENT_ROW_COUNT_READY});const o={type:import_core.Events.EVENT_MODEL_UPDATED,newData:!1,newPage:!1,keepRenderedRows:t,animate:!1};this.eventService.dispatchEvent(o)}isRowPresent(e){return!!this.getRowNode(e.id)}};__decorateClass([(0,import_core.Autowired)("rowRenderer")],ViewportRowModel.prototype,"rowRenderer",2),__decorateClass([(0,import_core.Autowired)("focusService")],ViewportRowModel.prototype,"focusService",2),__decorateClass([(0,import_core.Autowired)("beans")],ViewportRowModel.prototype,"beans",2),__decorateClass([import_core.PostConstruct],ViewportRowModel.prototype,"init",1),__decorateClass([import_core.PreDestroy],ViewportRowModel.prototype,"destroyDatasource",1),ViewportRowModel=__decorateClass([(0,import_core.Bean)("rowModel")],ViewportRowModel);var ViewportRowModelModule={version:VERSION,moduleName:import_core2.ModuleNames.ViewportRowModelModule,rowModel:"viewport",beans:[ViewportRowModel],dependantModules:[import_core3.EnterpriseCoreModule]};
