var G=Object.defineProperty,j=Object.defineProperties,Y=Object.getOwnPropertyDescriptor,$=Object.getOwnPropertyDescriptors,R=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,w=(i,e,t)=>e in i?G(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Z=(i,e)=>{for(var t in e||(e={}))H.call(e,t)&&w(i,t,e[t]);if(R)for(var t of R(e))q.call(e,t)&&w(i,t,e[t]);return i},J=(i,e)=>j(i,$(e)),d=(i,e,t,o)=>{for(var s=o>1?void 0:o?Y(e,t):e,n=i.length-1,r;n>=0;n--)(r=i[n])&&(s=(o?r(e,t,s):r(s))||s);return o&&s&&G(e,t,s),s};import{ModuleNames as Q}from"@ag-grid-community/core";import{EnterpriseCoreModule as X}from"@ag-grid-enterprise/core";import{Autowired as ee,Component as te,PostConstruct as oe,Events as se}from"@ag-grid-community/core";var B=class extends te{constructor(){super('<div class="ag-tool-panel-horizontal-resize"></div>'),this.minWidth=100,this.maxWidth=null}setElementToResize(i){this.elementToResize=i}postConstruct(){const i=this.horizontalResizeService.addResizeBar({eResizeBar:this.getGui(),dragStartPixels:1,onResizeStart:this.onResizeStart.bind(this),onResizing:this.onResizing.bind(this),onResizeEnd:this.onResizeEnd.bind(this)});this.addDestroyFunc(i),this.setInverted(this.gridOptionsService.get("enableRtl"))}dispatchResizeEvent(i,e,t){const o={type:se.EVENT_TOOL_PANEL_SIZE_CHANGED,width:t,started:i,ended:e};this.eventService.dispatchEvent(o)}onResizeStart(){this.startingWidth=this.elementToResize.offsetWidth,this.dispatchResizeEvent(!0,!1,this.startingWidth)}onResizeEnd(i){return this.onResizing(i,!0)}onResizing(i,e=!1){const t=this.inverted?-1:1;let o=Math.max(this.minWidth,Math.floor(this.startingWidth-i*t));this.maxWidth!=null&&(o=Math.min(this.maxWidth,o)),this.elementToResize.style.width=`${o}px`,this.dispatchResizeEvent(!1,e,o)}setInverted(i){this.inverted=i}setMaxWidth(i){this.maxWidth=i}setMinWidth(i){i!=null?this.minWidth=i:this.minWidth=100}};d([ee("horizontalResizeService")],B.prototype,"horizontalResizeService",2),d([oe],B.prototype,"postConstruct",1);import{_ as E,Component as ne,Events as m,ModuleNames as L,ModuleRegistry as O,PostConstruct as ie,RefSelector as re,Autowired as _,ManagedFocusFeature as ae,KeyCode as y}from"@ag-grid-community/core";import{Autowired as M,Component as le,PostConstruct as de,PreDestroy as ue,_ as z,KeyCode as ce}from"@ag-grid-community/core";import{Component as pe,PostConstruct as he,RefSelector as S,_ as W}from"@ag-grid-community/core";var g=class U extends pe{constructor(e){super(),this.toolPanelDef=e}getToolPanelId(){return this.toolPanelDef.id}postConstruct(){const e=this.createTemplate();this.setTemplate(e),this.setLabel(),this.setIcon(),this.addManagedListener(this.eToggleButton,"click",this.onButtonPressed.bind(this)),this.eToggleButton.setAttribute("id",`ag-${this.getCompId()}-button`)}createTemplate(){return`<div class="ag-side-button" role="presentation">
                <button type="button" ref="eToggleButton" tabindex="-1" role="tab" aria-expanded="false" class="ag-button ag-side-button-button">
                    <div ref="eIconWrapper" class="ag-side-button-icon-wrapper" aria-hidden="true"></div>
                    <span ref ="eLabel" class="ag-side-button-label"></span>
                </button>
            </div>`}setLabel(){const e=this.localeService.getLocaleTextFunc(),t=this.toolPanelDef,o=e(t.labelKey,t.labelDefault);this.eLabel.innerText=o}setIcon(){this.eIconWrapper.insertAdjacentElement("afterbegin",W.createIconNoSpan(this.toolPanelDef.iconKey,this.gridOptionsService))}onButtonPressed(){this.dispatchEvent({type:U.EVENT_TOGGLE_BUTTON_CLICKED})}setSelected(e){this.addOrRemoveCssClass("ag-selected",e),W.setAriaExpanded(this.eToggleButton,e)}getButtonElement(){return this.eToggleButton}};g.EVENT_TOGGLE_BUTTON_CLICKED="toggleButtonClicked",d([S("eToggleButton")],g.prototype,"eToggleButton",2),d([S("eIconWrapper")],g.prototype,"eIconWrapper",2),d([S("eLabel")],g.prototype,"eLabel",2),d([he],g.prototype,"postConstruct",1);var N=g,h=class A extends le{constructor(){super(A.TEMPLATE),this.buttonComps=[]}postConstruct(){this.addManagedListener(this.getFocusableElement(),"keydown",this.handleKeyDown.bind(this))}handleKeyDown(e){if(e.key!==ce.TAB||!e.shiftKey)return;const t=z.last(this.columnModel.getAllDisplayedColumns());this.focusService.focusGridView(t,!0)&&e.preventDefault()}setActiveButton(e){this.buttonComps.forEach(t=>{t.setSelected(e===t.getToolPanelId())})}addButtonComp(e){const t=this.createBean(new N(e));return this.buttonComps.push(t),this.appendChild(t),t.addEventListener(N.EVENT_TOGGLE_BUTTON_CLICKED,()=>{this.dispatchEvent({type:A.EVENT_SIDE_BAR_BUTTON_CLICKED,toolPanelId:e.id})}),t}clearButtons(){this.buttonComps=this.destroyBeans(this.buttonComps),z.clearElement(this.getGui())}};h.EVENT_SIDE_BAR_BUTTON_CLICKED="sideBarButtonClicked",h.TEMPLATE='<div class="ag-side-buttons" role="tablist"></div>',d([M("focusService")],h.prototype,"focusService",2),d([M("columnModel")],h.prototype,"columnModel",2),d([de],h.prototype,"postConstruct",1),d([ue],h.prototype,"clearButtons",1);var F=h,P=class p{static parse(e){if(!e)return;if(e===!0)return{toolPanels:[p.DEFAULT_COLUMN_COMP,p.DEFAULT_FILTER_COMP],defaultToolPanel:"columns"};if(typeof e=="string")return p.parse([e]);if(Array.isArray(e)){const o=[];return e.forEach(s=>{const n=p.DEFAULT_BY_KEY[s];if(!n){console.warn(`AG Grid: the key ${s} is not a valid key for specifying a tool panel, valid keys are: ${Object.keys(p.DEFAULT_BY_KEY).join(",")}`);return}o.push(n)}),o.length===0?void 0:{toolPanels:o,defaultToolPanel:o[0].id}}return{toolPanels:p.parseComponents(e.toolPanels),defaultToolPanel:e.defaultToolPanel,hiddenByDefault:e.hiddenByDefault,position:e.position}}static parseComponents(e){const t=[];return e&&e.forEach(o=>{let s=null;if(typeof o=="string"){const n=p.DEFAULT_BY_KEY[o];if(!n){console.warn(`AG Grid: the key ${o} is not a valid key for specifying a tool panel, valid keys are: ${Object.keys(p.DEFAULT_BY_KEY).join(",")}`);return}s=n}else s=o;t.push(s)}),t}};P.DEFAULT_COLUMN_COMP={id:"columns",labelDefault:"Columns",labelKey:"columns",iconKey:"columns",toolPanel:"agColumnsToolPanel"},P.DEFAULT_FILTER_COMP={id:"filters",labelDefault:"Filters",labelKey:"filters",iconKey:"filter",toolPanel:"agFiltersToolPanel"},P.DEFAULT_BY_KEY={columns:P.DEFAULT_COLUMN_COMP,filters:P.DEFAULT_FILTER_COMP};var x=P;import{Autowired as fe,Component as me,PostConstruct as ge}from"@ag-grid-community/core";var D=class V extends me{constructor(){super(V.TEMPLATE)}setupResize(){const e=this.getGui(),t=this.resizeBar=this.createManagedBean(new B);e.setAttribute("id",`ag-${this.getCompId()}`),t.setElementToResize(e),this.appendChild(t)}getToolPanelId(){return this.toolPanelId}setToolPanelDef(e,t){const{id:o,minWidth:s,maxWidth:n,width:r}=e;this.toolPanelId=o,this.width=r;const a=this.userComponentFactory.getToolPanelCompDetails(e,t),l=a.newAgStackInstance();if(this.params=a.params,l==null){console.warn(`AG Grid: error processing tool panel component ${o}. You need to specify 'toolPanel'`);return}l.then(this.setToolPanelComponent.bind(this)),s!=null&&this.resizeBar.setMinWidth(s),n!=null&&this.resizeBar.setMaxWidth(n)}setToolPanelComponent(e){this.toolPanelCompInstance=e,this.appendChild(e.getGui()),this.addDestroyFunc(()=>{this.destroyBean(e)}),this.width&&(this.getGui().style.width=`${this.width}px`)}getToolPanelInstance(){return this.toolPanelCompInstance}setResizerSizerSide(e){const t=this.gridOptionsService.get("enableRtl"),o=e==="left",s=t?o:!o;this.resizeBar.setInverted(s)}refresh(){this.toolPanelCompInstance.refresh(this.params)}};D.TEMPLATE='<div class="ag-tool-panel-wrapper" role="tabpanel"/>',d([fe("userComponentFactory")],D.prototype,"userComponentFactory",2),d([ge],D.prototype,"setupResize",1);var Pe=D,f=class k extends ne{constructor(){super(k.TEMPLATE),this.toolPanelWrappers=[]}postConstruct(){var e;this.sideBarButtonsComp.addEventListener(F.EVENT_SIDE_BAR_BUTTON_CLICKED,this.onToolPanelButtonClicked.bind(this));const{sideBar:t}=(e=this.gridOptionsService.get("initialState"))!=null?e:{};this.setSideBarDef({sideBarDef:x.parse(this.gridOptionsService.get("sideBar")),sideBarState:t}),this.addManagedPropertyListener("sideBar",this.onSideBarUpdated.bind(this)),this.sideBarService.registerSideBarComp(this),this.createManagedBean(new ae(this.getFocusableElement(),{onTabKeyDown:this.onTabKeyDown.bind(this),handleKeyDown:this.handleKeyDown.bind(this)}))}onTabKeyDown(e){if(e.defaultPrevented)return;const{focusService:t,sideBarButtonsComp:o}=this,s=this.getGui(),n=o.getGui(),a=this.gridOptionsService.getDocument().activeElement,l=s.querySelector(".ag-tool-panel-wrapper:not(.ag-hidden)"),u=e.target;if(!l)return;if(n.contains(a)){t.focusInto(l,e.shiftKey)&&e.preventDefault();return}if(!e.shiftKey)return;let c=null;l.contains(a)?c=this.focusService.findNextFocusableElement(l,void 0,!0):t.isTargetUnderManagedComponent(l,u)&&e.shiftKey&&(c=this.focusService.findFocusableElementBeforeTabGuard(l,u)),c||(c=n.querySelector(".ag-selected button")),c&&c!==e.target&&(e.preventDefault(),c.focus())}handleKeyDown(e){const t=this.gridOptionsService.getDocument();if(!this.sideBarButtonsComp.getGui().contains(t.activeElement))return;const o=this.sideBarButtonsComp.getGui(),s=Array.prototype.slice.call(o.querySelectorAll(".ag-side-button")),n=t.activeElement,r=s.findIndex(u=>u.contains(n));let a=null;switch(e.key){case y.LEFT:case y.UP:a=Math.max(0,r-1);break;case y.RIGHT:case y.DOWN:a=Math.min(r+1,s.length-1);break}if(a===null)return;const l=s[a].querySelector("button");l&&(l.focus(),e.preventDefault())}onToolPanelButtonClicked(e){const t=e.toolPanelId;this.openedItem()===t?this.openToolPanel(void 0,"sideBarButtonClicked"):this.openToolPanel(t,"sideBarButtonClicked")}clearDownUi(){this.sideBarButtonsComp.clearButtons(),this.destroyToolPanelWrappers()}setSideBarDef({sideBarDef:e,sideBarState:t,existingToolPanelWrappers:o}){if(this.setDisplayed(!1),this.sideBar=e,this.sideBar&&this.sideBar.toolPanels){const s=this.sideBar.toolPanels;if(this.createToolPanelsAndSideButtons(s,t,o),!this.toolPanelWrappers.length)return;const n=t?t.visible:!this.sideBar.hiddenByDefault;if(this.setDisplayed(n),this.setSideBarPosition(t?t.position:this.sideBar.position),n)if(t){const{openToolPanel:r}=t;r&&this.openToolPanel(r,"sideBarInitializing")}else this.openToolPanel(this.sideBar.defaultToolPanel,"sideBarInitializing")}}getDef(){return this.sideBar}setSideBarPosition(e){e||(e="right"),this.position=e;const t=e==="left",o=t?"right":"left";return this.addOrRemoveCssClass("ag-side-bar-left",t),this.addOrRemoveCssClass("ag-side-bar-right",!t),this.toolPanelWrappers.forEach(s=>{s.setResizerSizerSide(o)}),this.eventService.dispatchEvent({type:m.EVENT_SIDE_BAR_UPDATED}),this}setDisplayed(e,t){super.setDisplayed(e,t),this.eventService.dispatchEvent({type:m.EVENT_SIDE_BAR_UPDATED})}getState(){const e={};return this.toolPanelWrappers.forEach(t=>{var o,s;e[t.getToolPanelId()]=(s=(o=t.getToolPanelInstance())==null?void 0:o.getState)==null?void 0:s.call(o)}),{visible:this.isDisplayed(),position:this.position,openToolPanel:this.openedItem(),toolPanels:e}}createToolPanelsAndSideButtons(e,t,o){var s;for(const n of e)this.createToolPanelAndSideButton(n,(s=t?.toolPanels)==null?void 0:s[n.id],o?.[n.id])}validateDef(e){if(e.id==null)return console.warn("AG Grid: please review all your toolPanel components, it seems like at least one of them doesn't have an id"),!1;if(e.toolPanel==="agColumnsToolPanel"&&!O.__assertRegistered(L.ColumnsToolPanelModule,"Column Tool Panel",this.context.getGridId()))return!1;if(e.toolPanel==="agFiltersToolPanel"){if(!O.__assertRegistered(L.FiltersToolPanelModule,"Filters Tool Panel",this.context.getGridId()))return!1;if(this.filterManager.isAdvancedFilterEnabled())return E.warnOnce("Advanced Filter does not work with Filters Tool Panel. Filters Tool Panel has been disabled."),!1}return!0}createToolPanelAndSideButton(e,t,o){if(!this.validateDef(e))return;const s=this.sideBarButtonsComp.addButtonComp(e);let n;o?n=o:(n=this.getContext().createBean(new Pe),n.setToolPanelDef(e,{initialState:t,onStateUpdated:()=>this.eventService.dispatchEvent({type:m.EVENT_SIDE_BAR_UPDATED})})),n.setDisplayed(!1);const r=n.getGui();this.appendChild(r),this.toolPanelWrappers.push(n),E.setAriaControls(s.getButtonElement(),r)}refresh(){this.toolPanelWrappers.forEach(e=>e.refresh())}openToolPanel(e,t="api"){const o=this.openedItem();if(o===e)return;this.toolPanelWrappers.forEach(r=>{const a=e===r.getToolPanelId();r.setDisplayed(a)});const s=this.openedItem();o!==s&&(this.sideBarButtonsComp.setActiveButton(e),this.raiseToolPanelVisibleEvent(e,o??void 0,t))}getToolPanelInstance(e){const t=this.toolPanelWrappers.filter(o=>o.getToolPanelId()===e)[0];if(!t){console.warn(`AG Grid: unable to lookup Tool Panel as invalid key supplied: ${e}`);return}return t.getToolPanelInstance()}raiseToolPanelVisibleEvent(e,t,o){const s=!!e&&!!t;if(t){const n={type:m.EVENT_TOOL_PANEL_VISIBLE_CHANGED,source:o,key:t,visible:!1,switchingToolPanel:s};this.eventService.dispatchEvent(n)}if(e){const n={type:m.EVENT_TOOL_PANEL_VISIBLE_CHANGED,source:o,key:e,visible:!0,switchingToolPanel:s};this.eventService.dispatchEvent(n)}}close(e="api"){this.openToolPanel(void 0,e)}isToolPanelShowing(){return!!this.openedItem()}openedItem(){let e=null;return this.toolPanelWrappers.forEach(t=>{t.isDisplayed()&&(e=t.getToolPanelId())}),e}onSideBarUpdated(){var e;const t=x.parse(this.gridOptionsService.get("sideBar"));let o={};t&&this.sideBar&&((e=t.toolPanels)==null||e.forEach(s=>{var n,r;const{id:a}=s;if(!a)return;const l=(n=this.sideBar.toolPanels)==null?void 0:n.find(v=>v.id===a);if(!l||s.toolPanel!==l.toolPanel)return;const u=this.toolPanelWrappers.find(v=>v.getToolPanelId()===a);if(!u)return;const c=this.gridOptionsService.addGridCommonParams(J(Z({},(r=s.toolPanelParams)!=null?r:{}),{onStateUpdated:()=>this.eventService.dispatchEvent({type:m.EVENT_SIDE_BAR_UPDATED})}));u.getToolPanelInstance().refresh(c)===!0&&(this.toolPanelWrappers=this.toolPanelWrappers.filter(v=>v!==u),E.removeFromParent(u.getGui()),o[a]=u)})),this.clearDownUi(),this.setSideBarDef({sideBarDef:t,existingToolPanelWrappers:o})}destroyToolPanelWrappers(){this.toolPanelWrappers.forEach(e=>{E.removeFromParent(e.getGui()),this.destroyBean(e)}),this.toolPanelWrappers.length=0}destroy(){this.destroyToolPanelWrappers(),super.destroy()}};f.TEMPLATE=`<div class="ag-side-bar ag-unselectable">
            <ag-side-bar-buttons ref="sideBarButtons"></ag-side-bar-buttons>
        </div>`,d([_("focusService")],f.prototype,"focusService",2),d([_("filterManager")],f.prototype,"filterManager",2),d([_("sideBarService")],f.prototype,"sideBarService",2),d([re("sideBarButtons")],f.prototype,"sideBarButtonsComp",2),d([ie],f.prototype,"postConstruct",1);var Ce=f;import{_ as b,Autowired as ve,Bean as Te,BeanStub as Be,ProvidedColumnGroup as K}from"@ag-grid-community/core";var T=class extends Be{constructor(){super(...arguments),this.isColGroupDef=i=>i&&typeof i.children<"u",this.getId=i=>this.isColGroupDef(i)?i.groupId:i.colId}createColumnTree(i){const e=[],t=(s,n)=>{if(this.isColGroupDef(s)){const r=s,a=typeof r.groupId<"u"?r.groupId:r.headerName,l=new K(r,a,!1,n),u=[];return r.children.forEach(c=>{const C=t(c,n+1);C&&u.push(C)}),l.setChildren(u),l}else{const r=s,a=r.colId?r.colId:r.field,l=this.columnModel.getPrimaryColumn(a);return l||e.push(r),l}},o=[];return i.forEach(s=>{const n=t(s,0);n&&o.push(n)}),e.length>0&&console.warn("AG Grid: unable to find grid columns for the supplied colDef(s):",e),o}syncLayoutWithGrid(i){const e=this.getLeafPathTrees(),t=this.mergeLeafPathTrees(e);i(t)}getLeafPathTrees(){const i=(o,s)=>{let n;if(o instanceof K)if(o.isPadding())n=s;else{const a=Object.assign({},o.getColGroupDef());a.groupId=o.getGroupId(),a.children=[s],n=a}else{const a=Object.assign({},o.getColDef());a.colId=o.getColId(),n=a}const r=o.getOriginalParent();return r?i(r,n):n};return this.columnModel.getAllGridColumns().filter(o=>{const s=o.getColDef();return o.isPrimary()&&!s.showRowGroup}).map(o=>i(o,o.getColDef()))}mergeLeafPathTrees(i){const e=(s,n)=>this.isColGroupDef(s)&&this.isColGroupDef(n)&&this.getId(s)===this.getId(n),t=(s,n)=>{if(!this.isColGroupDef(n))return s;const r=s,a=n;return a.children&&a.groupId&&this.addChildrenToGroup(r,a.groupId,a.children[0])||a.children.forEach(l=>t(r,l)),r},o=[];for(let s=1;s<=i.length;s++){const n=i[s-1],r=i[s];e(n,r)?i[s]=t(n,r):o.push(n)}return o}addChildrenToGroup(i,e,t){const o=(r,a)=>{const l=r.children.map(this.getId),u=b.includes(l,this.getId(a)),c=b.last(r.children),C=c&&this.getId(c)!==this.getId(a);return u&&C};if(!this.isColGroupDef(i))return!0;const s=i,n=t;if(o(s,n))return s.children.push(n),!0;if(s.groupId===e){const r=s.children.map(this.getId);if(!b.includes(r,this.getId(n)))return s.children.push(n),!0}return s.children.forEach(r=>this.addChildrenToGroup(r,e,t)),!1}};d([ve("columnModel")],T.prototype,"columnModel",2),T=d([Te("toolPanelColDefService")],T);var Ee="31.2.1";import{Bean as ye,BeanStub as De}from"@ag-grid-community/core";var I=class extends De{registerSideBarComp(i){this.sideBarComp=i}getSideBarComp(){return this.sideBarComp}};I=d([ye("sideBarService")],I);var _e={version:Ee,moduleName:Q.SideBarModule,beans:[T,I],agStackComponents:[{componentName:"AgHorizontalResize",componentClass:B},{componentName:"AgSideBar",componentClass:Ce},{componentName:"AgSideBarButtons",componentClass:F}],dependantModules:[X]};export{_e as SideBarModule,T as ToolPanelColDefService};
