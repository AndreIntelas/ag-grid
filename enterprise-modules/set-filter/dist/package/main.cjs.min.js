var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__export=(t,e)=>{for(var i in e)__defProp(t,i,{get:e[i],enumerable:!0})},__copyProps=(t,e,i,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of __getOwnPropNames(e))!__hasOwnProp.call(t,r)&&r!==i&&__defProp(t,r,{get:()=>e[r],enumerable:!(s=__getOwnPropDesc(e,r))||s.enumerable});return t},__toCommonJS=t=>__copyProps(__defProp({},"__esModule",{value:!0}),t),__decorateClass=(t,e,i,s)=>{for(var r=s>1?void 0:s?__getOwnPropDesc(e,i):e,l=t.length-1,a;l>=0;l--)(a=t[l])&&(r=(s?a(e,i,r):a(r))||r);return s&&r&&__defProp(e,i,r),r},main_exports={};__export(main_exports,{SetFilter:()=>SetFilter,SetFilterModule:()=>SetFilterModule}),module.exports=__toCommonJS(main_exports);var import_core7=require("@ag-grid-community/core"),import_core8=require("@ag-grid-enterprise/core"),import_core5=require("@ag-grid-community/core"),import_core3=require("@ag-grid-community/core"),import_core=require("@ag-grid-community/core"),ClientSideValuesExtractor=class{constructor(t,e,i,s,r,l,a,n,h,o,d){this.rowModel=t,this.filterParams=e,this.createKey=i,this.caseFormat=s,this.columnModel=r,this.valueService=l,this.treeDataOrGrouping=a,this.treeData=n,this.getDataPath=h,this.groupAllowUnbalanced=o,this.addManagedListener=d}extractUniqueValuesAsync(t,e){return new import_core.AgPromise(i=>{if(this.rowModel.isRowDataLoaded())i(this.extractUniqueValues(t,e));else{const s=this.addManagedListener(import_core.Events.EVENT_ROW_COUNT_READY,()=>{s?.(),i(this.extractUniqueValues(t,e))})}})}extractUniqueValues(t,e){const i=new Map,s=this.extractExistingFormattedKeys(e),r=new Set,l=this.treeData&&!!this.getDataPath,a=this.columnModel.getRowGroupColumns(),n=(h,o)=>{const d=this.caseFormat(h);if(!r.has(d)){r.add(d);let u=h,p=import_core._.makeNull(o);const c=s?.get(d);c!=null&&(u=c,p=e.get(c)),i.set(u,p)}};return this.rowModel.forEachLeafNode(h=>{if(!h.data||!t(h))return;if(this.treeDataOrGrouping){this.addValueForTreeDataOrGrouping(h,l,a,n);return}let o=this.getValue(h);if(this.filterParams.convertValuesToStrings){this.addValueForConvertValuesToString(h,o,n);return}o!=null&&Array.isArray(o)?(o.forEach(d=>{n(this.createKey(d,h),d)}),o.length===0&&n(null,null)):n(this.createKey(o,h),o)}),i}addValueForConvertValuesToString(t,e,i){const s=this.createKey(e,t);s!=null&&Array.isArray(s)?(s.forEach(r=>{const l=import_core._.toStringOrNull(import_core._.makeNull(r));i(l,l)}),s.length===0&&i(null,null)):i(s,s)}addValueForTreeDataOrGrouping(t,e,i,s){var r;let l;if(e){if((r=t.childrenAfterGroup)!=null&&r.length)return;l=this.getDataPath(t.data)}else l=i.map(a=>this.valueService.getKeyForNode(a,t)),l.push(this.getValue(t));l&&(l=l.map(a=>import_core._.toStringOrNull(import_core._.makeNull(a)))),!e&&this.groupAllowUnbalanced&&l?.some(a=>a==null)&&(l=l.filter(a=>a!=null)),s(this.createKey(l),l)}getValue(t){return this.filterParams.getValue(t)}extractExistingFormattedKeys(t){if(!t)return null;const e=new Map;return t.forEach((i,s)=>{e.set(this.caseFormat(s),s)}),e}},SetFilterDisplayValue=class{};SetFilterDisplayValue.SELECT_ALL="__AG_SELECT_ALL__",SetFilterDisplayValue.ADD_SELECTION_TO_FILTER="__AG_ADD_SELECTION_TO_FILTER__";var FlatSetDisplayValueModel=class{constructor(t,e,i,s){this.valueFormatterService=t,this.valueFormatter=e,this.formatter=i,this.column=s,this.displayedKeys=[]}updateDisplayedValuesToAllAvailable(t,e,i){this.displayedKeys=Array.from(i)}updateDisplayedValuesToMatchMiniFilter(t,e,i,s,r){this.displayedKeys=[];for(let l of i)if(l==null)r&&this.displayedKeys.push(l);else{const a=t(l),n=this.valueFormatterService.formatValue(this.column,null,a,this.valueFormatter,!1),h=this.formatter(n);s(h)&&this.displayedKeys.push(l)}}getDisplayedValueCount(){return this.displayedKeys.length}getDisplayedItem(t){return this.displayedKeys[t]}getSelectAllItem(){return SetFilterDisplayValue.SELECT_ALL}getAddSelectionToFilterItem(){return SetFilterDisplayValue.ADD_SELECTION_TO_FILTER}getDisplayedKeys(){return this.displayedKeys}forEachDisplayedKey(t){this.displayedKeys.forEach(t)}someDisplayedKey(t){return this.displayedKeys.some(t)}hasGroups(){return!1}refresh(){}},import_core2=require("@ag-grid-community/core"),_TreeSetDisplayValueModel=class w{constructor(e,i,s,r){this.formatter=e,this.treeListPathGetter=i,this.treeListFormatter=s,this.treeDataOrGrouping=r,this.allDisplayedItemsTree=[],this.activeDisplayedItemsFlat=[],this.selectAllItem={depth:0,filterPasses:!0,available:!0,treeKey:SetFilterDisplayValue.SELECT_ALL,children:this.allDisplayedItemsTree,expanded:!0,key:SetFilterDisplayValue.SELECT_ALL,parentTreeKeys:[]},this.addSelectionToFilterItem={depth:0,filterPasses:!0,available:!0,treeKey:SetFilterDisplayValue.ADD_SELECTION_TO_FILTER,expanded:!0,key:SetFilterDisplayValue.ADD_SELECTION_TO_FILTER,parentTreeKeys:[]}}updateDisplayedValuesToAllAvailable(e,i,s,r){r==="reload"?this.generateItemTree(e,i,s):r==="otherFilter"?(this.updateAvailable(s),this.updateExpandAll()):r==="miniFilter"&&(this.resetFilter(),this.updateExpandAll()),this.flattenItems()}updateDisplayedValuesToMatchMiniFilter(e,i,s,r,l,a){a==="reload"?this.generateItemTree(e,i,s):a==="otherFilter"&&this.updateAvailable(s),this.updateFilter(r,l),this.updateExpandAll(),this.flattenItems()}generateItemTree(e,i,s){var r;this.allDisplayedItemsTree=[],this.groupsExist=!1;const l=this.getTreeListPathGetter(e,s);for(let a of i){const n=e(a),h=(r=l(n))!=null?r:[null];h.length>1&&(this.groupsExist=!0);const o=s.has(a);let d=this.allDisplayedItemsTree,u,p=[];h.forEach((c,f)=>{d||(d=[],u.children=d),u=d.find(y=>{var m;return((m=y.treeKey)==null?void 0:m.toUpperCase())===c?.toUpperCase()}),u||(u={treeKey:c,depth:f,filterPasses:!0,expanded:!1,available:o,parentTreeKeys:p},f===h.length-1&&(u.key=a),d.push(u)),d=u.children,p=[...p,c]})}this.updateAvailable(s),this.selectAllItem.children=this.allDisplayedItemsTree,this.selectAllItem.expanded=!1}getTreeListPathGetter(e,i){if(this.treeListPathGetter)return this.treeListPathGetter;if(this.treeDataOrGrouping)return r=>r;let s=!1;for(const r of i){const l=e(r);if(l instanceof Date){s=!0;break}else if(l!=null)break}return s?w.DATE_TREE_LIST_PATH_GETTER:(import_core2._.warnOnce("property treeList=true for Set Filter params, but you did not provide a treeListPathGetter or values of type Date."),r=>[String(r)])}flattenItems(){this.activeDisplayedItemsFlat=[];const e=i=>{i.forEach(s=>{!s.filterPasses||!s.available||(this.activeDisplayedItemsFlat.push(s),s.children&&s.expanded&&e(s.children))})};e(this.allDisplayedItemsTree)}resetFilter(){const e=i=>{i.children&&i.children.forEach(s=>{e(s)}),i.filterPasses=!0};this.allDisplayedItemsTree.forEach(i=>e(i))}updateFilter(e,i){const s=r=>r.available?r.treeKey==null?i:e(this.formatter(this.treeListFormatter?this.treeListFormatter(r.treeKey,r.depth,r.parentTreeKeys):r.treeKey)):!1;this.allDisplayedItemsTree.forEach(r=>this.recursiveItemCheck(r,!1,s,"filterPasses"))}getDisplayedValueCount(){return this.activeDisplayedItemsFlat.length}getDisplayedItem(e){return this.activeDisplayedItemsFlat[e]}getSelectAllItem(){return this.selectAllItem}getAddSelectionToFilterItem(){return this.addSelectionToFilterItem}getDisplayedKeys(){const e=[];return this.forEachDisplayedKey(i=>e.push(i)),e}forEachDisplayedKey(e){const i=(s,r)=>{s.children?(!s.expanded||!r)&&s.children.forEach(l=>{l.filterPasses&&i(l,!1)}):e(s.key)};this.activeDisplayedItemsFlat.forEach(s=>i(s,!0))}someDisplayedKey(e){const i=(s,r)=>{if(s.children){if(!s.expanded||!r)return s.children.some(l=>l.filterPasses?i(l,!1):!1)}else return e(s.key);return!1};return this.activeDisplayedItemsFlat.some(s=>i(s,!0))}hasGroups(){return this.groupsExist}refresh(){this.updateExpandAll(),this.flattenItems()}updateExpandAll(){const e=(s,r,l)=>{for(const a of s){if(!a.filterPasses||!a.available||!a.children)continue;if(r=r||!!a.expanded,l=l||!a.expanded,r&&l)return;const n=e(a.children,r,l);if(n===void 0)return;n?r=!0:l=!0}return r&&l?void 0:r},i=this.getSelectAllItem();i.expanded=e(i.children,!1,!1)}recursiveItemCheck(e,i,s,r){let l=!1;e.children&&e.children.forEach(n=>{const h=this.recursiveItemCheck(n,i||s(e),s,r);l=l||h});const a=i||l||s(e);return e[r]=a,a}updateAvailable(e){const i=s=>e.has(s.key);this.allDisplayedItemsTree.forEach(s=>this.recursiveItemCheck(s,!1,i,"available"))}};_TreeSetDisplayValueModel.DATE_TREE_LIST_PATH_GETTER=t=>t?[String(t.getFullYear()),String(t.getMonth()+1),String(t.getDate())]:null;var TreeSetDisplayValueModel=_TreeSetDisplayValueModel,SetValueModelFilteringKeys=class{constructor({caseFormat:t}){this.filteringKeys=null,this.filteringKeysCaseFormatted=null,this.hasNoAppliedFilteringKeys=!1,this.caseFormat=t}allFilteringKeys(){return this.filteringKeys}allFilteringKeysCaseFormatted(){return this.filteringKeysCaseFormatted}noAppliedFilteringKeys(){return this.hasNoAppliedFilteringKeys}setFilteringKeys(t){this.filteringKeys=new Set(t),this.hasNoAppliedFilteringKeys=!this.filteringKeys||this.filteringKeys.size===0,this.filteringKeysCaseFormatted=new Set,this.filteringKeys.forEach(e=>this.filteringKeysCaseFormatted.add(this.caseFormat(e)))}addFilteringKey(t){this.filteringKeys==null&&(this.filteringKeys=new Set,this.filteringKeysCaseFormatted=new Set),this.filteringKeys.add(t),this.filteringKeysCaseFormatted.add(this.caseFormat(t)),this.hasNoAppliedFilteringKeys&&(this.hasNoAppliedFilteringKeys=!1)}hasCaseFormattedFilteringKey(t){return this.filteringKeysCaseFormatted.has(this.caseFormat(t))}hasFilteringKey(t){return this.filteringKeys.has(t)}reset(){this.filteringKeys=null,this.filteringKeysCaseFormatted=null,this.hasNoAppliedFilteringKeys=!1}},_SetValueModel=class K{constructor(e){this.localEventService=new import_core3.EventService,this.miniFilterText=null,this.addCurrentSelectionToFilter=!1,this.providedValues=null,this.allValues=new Map,this.availableKeys=new Set,this.selectedKeys=new Set,this.initialised=!1;const{usingComplexObjects:i,columnModel:s,valueService:r,treeDataTreeList:l,groupingTreeList:a,filterParams:n,gridOptionsService:h,valueFormatterService:o,valueFormatter:d,addManagedListener:u}=e,{column:p,colDef:c,textFormatter:f,doesRowPassOtherFilter:y,suppressSorting:m,comparator:T,rowModel:L,values:F,caseSensitive:x,convertValuesToStrings:b,treeList:S,treeListPathGetter:A,treeListFormatter:_}=n;this.filterParams=n,this.gridOptionsService=h,this.setIsLoading=e.setIsLoading,this.translate=e.translate,this.caseFormat=e.caseFormat,this.createKey=e.createKey,this.usingComplexObjects=!!e.usingComplexObjects,this.formatter=f||import_core3.TextFilter.DEFAULT_FORMATTER,this.doesRowPassOtherFilters=y,this.suppressSorting=m||!1,this.convertValuesToStrings=!!b,this.filteringKeys=new SetValueModelFilteringKeys({caseFormat:this.caseFormat});const g=T??c.comparator,M=!!l||!!a;this.compareByValue=!!(i&&g||M||S&&!A),M&&!g?this.entryComparator=this.createTreeDataOrGroupingComparator():S&&!A&&!g?this.entryComparator=([E,C],[P,V])=>import_core3._.defaultComparator(C,V):this.entryComparator=([E,C],[P,V])=>g(C,V),this.keyComparator=g??import_core3._.defaultComparator,this.caseSensitive=!!x;const D=h.get("getDataPath"),I=h.get("groupAllowUnbalanced");L.getType()==="clientSide"&&(this.clientSideValuesExtractor=new ClientSideValuesExtractor(L,this.filterParams,this.createKey,this.caseFormat,s,r,M,!!l,D,I,u)),F==null?this.valuesType=2:(this.valuesType=Array.isArray(F)?0:1,this.providedValues=F),this.displayValueModel=S?new TreeSetDisplayValueModel(this.formatter,A,_,l||a):new FlatSetDisplayValueModel(o,d,this.formatter,p),this.updateAllValues().then(E=>this.resetSelectionState(E||[]))}addEventListener(e,i,s){this.localEventService.addEventListener(e,i,s)}removeEventListener(e,i,s){this.localEventService.removeEventListener(e,i,s)}updateOnParamsChange(e){return new import_core3.AgPromise(i=>{const{values:s,textFormatter:r,suppressSorting:l}=e,a=this.providedValues,n=this.suppressSorting;if(this.filterParams=e,this.formatter=r||import_core3.TextFilter.DEFAULT_FORMATTER,this.suppressSorting=l||!1,this.providedValues=s??null,this.providedValues!==a||this.suppressSorting!==n){if(!s||s.length===0)this.valuesType=2,this.providedValues=null;else{const o=Array.isArray(s)&&s.length>0&&typeof s[0]=="function";this.valuesType=o?1:0}const h=this.getModel();this.updateAllValues().then(o=>{this.setModel(h).then(()=>i())})}else i()})}refreshValues(){return new import_core3.AgPromise(e=>{this.allValuesPromise.then(()=>{const i=this.getModel();this.updateAllValues(),this.setModel(i).then(()=>e())})})}overrideValues(e){return new import_core3.AgPromise(i=>{this.allValuesPromise.then(()=>{this.valuesType=0,this.providedValues=e,this.refreshValues().then(()=>i())})})}refreshAfterAnyFilterChanged(){return this.showAvailableOnly()?this.allValuesPromise.then(e=>(this.updateAvailableKeys(e??[],"otherFilter"),!0)):import_core3.AgPromise.resolve(!1)}isInitialised(){return this.initialised}updateAllValues(){return this.allValuesPromise=new import_core3.AgPromise(e=>{switch(this.valuesType){case 2:this.getValuesFromRowsAsync(!1).then(i=>e(this.processAllValues(i)));break;case 0:{e(this.processAllValues(this.uniqueValues(this.validateProvidedValues(this.providedValues))));break}case 1:{this.setIsLoading(!0);const i=this.providedValues,{column:s,colDef:r}=this.filterParams,l=this.gridOptionsService.addGridCommonParams({success:a=>{this.setIsLoading(!1),e(this.processAllValues(this.uniqueValues(this.validateProvidedValues(a))))},colDef:r,column:s});window.setTimeout(()=>i(l),0);break}default:throw new Error("Unrecognised valuesType")}}),this.allValuesPromise.then(e=>this.updateAvailableKeys(e||[],"reload")).then(()=>this.initialised=!0),this.allValuesPromise}processAllValues(e){const i=this.sortKeys(e);return this.allValues=e??new Map,i}validateProvidedValues(e){if(this.usingComplexObjects&&e?.length){const i=e[0];i&&typeof i!="object"&&typeof i!="function"&&(this.createKey(i)==null?import_core3._.warnOnce("Set Filter Key Creator is returning null for provided values and provided values are primitives. Please provide complex objects or set convertValuesToStrings=true in the filterParams. See https://www.ag-grid.com/javascript-data-grid/filter-set-filter-list/#filter-value-types"):import_core3._.warnOnce("Set Filter has a Key Creator, but provided values are primitives. Did you mean to provide complex objects or enable convertValuesToStrings?"))}return e}setValuesType(e){this.valuesType=e}getValuesType(){return this.valuesType}isKeyAvailable(e){return this.availableKeys.has(e)}showAvailableOnly(){return this.valuesType===2}updateAvailableKeys(e,i){const s=this.showAvailableOnly()?this.sortKeys(this.getValuesFromRows(!0)):e;this.availableKeys=new Set(s),this.localEventService.dispatchEvent({type:K.EVENT_AVAILABLE_VALUES_CHANGED}),this.updateDisplayedValues(i,e)}sortKeys(e){const i=e??new Map;if(this.suppressSorting)return Array.from(i.keys());let s;return this.compareByValue?s=Array.from(i.entries()).sort(this.entryComparator).map(([r])=>r):s=Array.from(i.keys()).sort(this.keyComparator),this.filterParams.excelMode&&i.has(null)&&(s=s.filter(r=>r!=null),s.push(null)),s}getParamsForValuesFromRows(e=!1){if(!this.clientSideValuesExtractor)return import_core3._.doOnce(()=>{console.error("AG Grid: Set Filter cannot initialise because you are using a row model that does not contain all rows in the browser. Either use a different filter type, or configure Set Filter such that you provide it with values")},"setFilterValueNotCSRM"),null;const i=r=>!e||this.doesRowPassOtherFilters(r),s=e&&!this.caseSensitive?this.allValues:void 0;return{predicate:i,existingValues:s}}getValuesFromRows(e=!1){const i=this.getParamsForValuesFromRows(e);return i?this.clientSideValuesExtractor.extractUniqueValues(i.predicate,i.existingValues):null}getValuesFromRowsAsync(e=!1){const i=this.getParamsForValuesFromRows(e);return i?this.clientSideValuesExtractor.extractUniqueValuesAsync(i.predicate,i.existingValues):import_core3.AgPromise.resolve(null)}setMiniFilter(e){return e=import_core3._.makeNull(e),this.miniFilterText===e?!1:(e===null&&this.setAddCurrentSelectionToFilter(!1),this.miniFilterText=e,this.updateDisplayedValues("miniFilter"),!0)}getMiniFilter(){return this.miniFilterText}updateDisplayedValues(e,i){if(e==="expansion"){this.displayValueModel.refresh();return}if(this.miniFilterText==null){this.displayValueModel.updateDisplayedValuesToAllAvailable(a=>this.getValue(a),i,this.availableKeys,e);return}const s=this.caseFormat(this.formatter(this.miniFilterText)||""),r=a=>a!=null&&this.caseFormat(a).indexOf(s)>=0,l=!!this.filterParams.excelMode&&r(this.translate("blanks"));this.displayValueModel.updateDisplayedValuesToMatchMiniFilter(a=>this.getValue(a),i,this.availableKeys,r,l,e)}getDisplayedValueCount(){return this.displayValueModel.getDisplayedValueCount()}getDisplayedItem(e){return this.displayValueModel.getDisplayedItem(e)}getSelectAllItem(){return this.displayValueModel.getSelectAllItem()}getAddSelectionToFilterItem(){return this.displayValueModel.getAddSelectionToFilterItem()}hasSelections(){return this.filterParams.defaultToNothingSelected?this.selectedKeys.size>0:this.allValues.size!==this.selectedKeys.size}getKeys(){return Array.from(this.allValues.keys())}getValues(){return Array.from(this.allValues.values())}getValue(e){return this.allValues.get(e)}setAddCurrentSelectionToFilter(e){this.addCurrentSelectionToFilter=e}isInWindowsExcelMode(){return this.filterParams.excelMode==="windows"}isAddCurrentSelectionToFilterChecked(){return this.isInWindowsExcelMode()&&this.addCurrentSelectionToFilter}showAddCurrentSelectionToFilter(){return this.isInWindowsExcelMode()&&import_core3._.exists(this.miniFilterText)&&this.miniFilterText.length>0}selectAllMatchingMiniFilter(e=!1){this.miniFilterText==null?this.selectedKeys=new Set(this.allValues.keys()):(e&&this.selectedKeys.clear(),this.displayValueModel.forEachDisplayedKey(i=>this.selectedKeys.add(i)))}deselectAllMatchingMiniFilter(){this.miniFilterText==null?this.selectedKeys.clear():this.displayValueModel.forEachDisplayedKey(e=>this.selectedKeys.delete(e))}selectKey(e){this.selectedKeys.add(e)}deselectKey(e){this.filterParams.excelMode&&this.isEverythingVisibleSelected()&&this.resetSelectionState(this.displayValueModel.getDisplayedKeys()),this.selectedKeys.delete(e)}isKeySelected(e){return this.selectedKeys.has(e)}isEverythingVisibleSelected(){return!this.displayValueModel.someDisplayedKey(e=>!this.isKeySelected(e))}isNothingVisibleSelected(){return!this.displayValueModel.someDisplayedKey(e=>this.isKeySelected(e))}getModel(){if(!this.hasSelections())return null;const e=this.isAddCurrentSelectionToFilterChecked()?this.filteringKeys.allFilteringKeys():null;if(e&&e.size>0){if(this.selectedKeys){const i=new Set([...Array.from(e),...Array.from(this.selectedKeys).filter(s=>!e.has(s))]);return Array.from(i)}return Array.from(e)}return Array.from(this.selectedKeys)}setModel(e){return this.allValuesPromise.then(i=>{if(e==null)this.resetSelectionState(i??[]);else{this.selectedKeys.clear();const s=new Map;this.allValues.forEach((r,l)=>{s.set(this.caseFormat(l),l)}),e.forEach(r=>{const l=this.caseFormat(import_core3._.makeNull(r)),a=s.get(l);a!==void 0&&this.selectKey(a)})}})}uniqueValues(e){const i=new Map,s=new Set;return(e??[]).forEach(r=>{const l=import_core3._.makeNull(r),a=this.convertAndGetKey(l),n=this.caseFormat(a);s.has(n)||(s.add(n),i.set(a,l))}),i}convertAndGetKey(e){return this.convertValuesToStrings?e:this.createKey(e)}resetSelectionState(e){this.filterParams.defaultToNothingSelected?this.selectedKeys.clear():this.selectedKeys=new Set(e)}hasGroups(){return this.displayValueModel.hasGroups()}createTreeDataOrGroupingComparator(){return([e,i],[s,r])=>{if(i==null)return r==null?0:-1;if(r==null)return 1;for(let l=0;l<i.length;l++){if(l>=r.length)return 1;const a=import_core3._.defaultComparator(i[l],r[l]);if(a!==0)return a}return 0}}setAppliedModelKeys(e){this.filteringKeys.setFilteringKeys(e)}addToAppliedModelKeys(e){this.filteringKeys.addFilteringKey(e)}getAppliedModelKeys(){return this.filteringKeys.allFilteringKeys()}getCaseFormattedAppliedModelKeys(){return this.filteringKeys.allFilteringKeysCaseFormatted()}hasAppliedModelKey(e){return this.filteringKeys.hasCaseFormattedFilteringKey(e)}hasAnyAppliedModelKey(){return!this.filteringKeys.noAppliedFilteringKeys()}};_SetValueModel.EVENT_AVAILABLE_VALUES_CHANGED="availableValuesChanged";var SetValueModel=_SetValueModel,import_core4=require("@ag-grid-community/core"),_SetFilterListItem=class v extends import_core4.Component{constructor(e){var i;super(e.isGroup?v.GROUP_TEMPLATE:v.TEMPLATE),this.focusWrapper=e.focusWrapper,this.value=e.value,this.params=e.params,this.translate=e.translate,this.valueFormatter=e.valueFormatter,this.item=e.item,this.isSelected=e.isSelected,this.isTree=e.isTree,this.depth=(i=e.depth)!=null?i:0,this.isGroup=e.isGroup,this.groupsExist=e.groupsExist,this.isExpanded=e.isExpanded,this.hasIndeterminateExpandState=e.hasIndeterminateExpandState}init(){this.addDestroyFunc(()=>{var e;return(e=this.destroyCellRendererComponent)==null?void 0:e.call(this)}),this.render(),this.eCheckbox.setLabelEllipsis(!0).setValue(this.isSelected,!0).setDisabled(!!this.params.readOnly).getInputElement().setAttribute("tabindex","-1"),this.refreshVariableAriaLabels(),this.isTree&&(this.depth>0&&this.addCssClass("ag-set-filter-indent-"+this.depth),this.isGroup?this.setupExpansion():this.groupsExist&&this.addCssClass("ag-set-filter-add-group-indent"),import_core4._.setAriaLevel(this.getAriaElement(),this.depth+1)),this.refreshAriaChecked(),!this.params.readOnly&&this.eCheckbox.onValueChange(e=>this.onCheckboxChanged(!!e))}getFocusableElement(){return this.focusWrapper}setupExpansion(){this.eGroupClosedIcon.appendChild(import_core4._.createIcon("setFilterGroupClosed",this.gridOptionsService,null)),this.eGroupOpenedIcon.appendChild(import_core4._.createIcon("setFilterGroupOpen",this.gridOptionsService,null)),this.addManagedListener(this.eGroupClosedIcon,"click",this.onExpandOrContractClicked.bind(this)),this.addManagedListener(this.eGroupOpenedIcon,"click",this.onExpandOrContractClicked.bind(this)),this.hasIndeterminateExpandState&&(this.eGroupIndeterminateIcon.appendChild(import_core4._.createIcon("setFilterGroupIndeterminate",this.gridOptionsService,null)),this.addManagedListener(this.eGroupIndeterminateIcon,"click",this.onExpandOrContractClicked.bind(this))),this.setExpandedIcons(),this.refreshAriaExpanded()}onExpandOrContractClicked(){this.setExpanded(!this.isExpanded)}setExpanded(e,i){if(this.isGroup&&e!==this.isExpanded){this.isExpanded=e;const s={type:v.EVENT_EXPANDED_CHANGED,isExpanded:!!e,item:this.item};i||this.dispatchEvent(s),this.setExpandedIcons(),this.refreshAriaExpanded()}}setExpandedIcons(){import_core4._.setDisplayed(this.eGroupClosedIcon,this.hasIndeterminateExpandState?this.isExpanded===!1:!this.isExpanded),import_core4._.setDisplayed(this.eGroupOpenedIcon,this.isExpanded===!0),this.hasIndeterminateExpandState&&import_core4._.setDisplayed(this.eGroupIndeterminateIcon,this.isExpanded===void 0)}onCheckboxChanged(e){this.isSelected=e;const i={type:v.EVENT_SELECTION_CHANGED,isSelected:e,item:this.item};this.dispatchEvent(i),this.refreshVariableAriaLabels(),this.refreshAriaChecked()}toggleSelected(){this.params.readOnly||this.setSelected(!this.isSelected)}setSelected(e,i){this.isSelected=e,this.eCheckbox.setValue(e,i),this.refreshAriaChecked()}refreshVariableAriaLabels(){if(!this.isTree)return;const e=this.localeService.getLocaleTextFunc(),i=this.eCheckbox.getValue(),s=i===void 0?e("ariaIndeterminate","indeterminate"):i?e("ariaVisible","visible"):e("ariaHidden","hidden"),r=e("ariaToggleVisibility","Press SPACE to toggle visibility");import_core4._.setAriaLabelledBy(this.eCheckbox.getInputElement(),void 0),this.eCheckbox.setInputAriaLabel(`${r} (${s})`)}setupFixedAriaLabels(e){if(!this.isTree)return;const s=this.localeService.getLocaleTextFunc()("ariaFilterValue","Filter Value"),r=this.getAriaElement();import_core4._.setAriaLabel(r,`${e} ${s}`),import_core4._.setAriaDescribedBy(r,this.eCheckbox.getInputElement().id)}refreshAriaChecked(){const e=this.getAriaElement();import_core4._.setAriaChecked(e,this.eCheckbox.getValue())}refreshAriaExpanded(){import_core4._.setAriaExpanded(this.getAriaElement(),!!this.isExpanded)}refresh(e,i,s){var r,l;if(this.item=e,i!==this.isSelected&&this.setSelected(i,!0),this.setExpanded(s,!0),this.valueFunction){const a=this.valueFunction();this.setTooltipAndCellRendererParams(a,a),this.cellRendererComponent||this.renderCellWithoutCellRenderer()}if(this.cellRendererComponent&&!((l=(r=this.cellRendererComponent).refresh)==null?void 0:l.call(r,this.cellRendererParams))){const n=this.cellRendererComponent;this.renderCell(),this.destroyBean(n)}}render(){const{params:{column:e}}=this;let{value:i}=this,s=null;typeof i=="function"?(this.valueFunction=i,s=this.valueFunction(),i=s):this.isTree?s=import_core4._.toStringOrNull(i):s=this.getFormattedValue(e,i),this.setTooltipAndCellRendererParams(i,s),this.renderCell()}setTooltipAndCellRendererParams(e,i){const s=this.gridOptionsService.get("tooltipShowMode")==="whenTruncated";if(this.params.showTooltips&&(!s||!this.params.cellRenderer)){const r=i??import_core4._.toStringOrNull(e);let l;s&&(l=()=>{const a=this.eCheckbox.getGui().querySelector(".ag-label");return a?a.scrollWidth>a.clientWidth:!0}),this.setTooltip({newTooltipText:r,location:"setFilterValue",shouldDisplayTooltip:l})}this.cellRendererParams=this.gridOptionsService.addGridCommonParams({value:e,valueFormatted:i,colDef:this.params.colDef,column:this.params.column,setTooltip:(r,l)=>{this.setTooltip({newTooltipText:r,location:"setFilterValue",shouldDisplayTooltip:l})}})}getTooltipParams(){const e=super.getTooltipParams();return e.location="setFilterValue",e.colDef=this.getComponentHolder(),this.isTree&&(e.level=this.depth),e}getFormattedValue(e,i){return this.valueFormatterService.formatValue(e,null,i,this.valueFormatter,!1)}renderCell(){const e=this.userComponentFactory.getSetFilterCellRendererDetails(this.params,this.cellRendererParams),i=e?e.newAgStackInstance():void 0;if(i==null){this.renderCellWithoutCellRenderer();return}i.then(s=>{s&&(this.cellRendererComponent=s,this.eCheckbox.setLabel(s.getGui()),this.destroyCellRendererComponent=()=>this.destroyBean(s))})}renderCellWithoutCellRenderer(){var e;let i=(e=this.cellRendererParams.valueFormatted==null?this.cellRendererParams.value:this.cellRendererParams.valueFormatted)!=null?e:this.translate("blanks");typeof i!="string"&&(import_core4._.warnOnce(`Set Filter Value Formatter must return string values. Please ensure the Set Filter Value Formatter returns string values for complex objects, or set convertValuesToStrings=true in the filterParams. See ${this.getFrameworkOverrides().getDocLink("filter-set-filter-list/#filter-value-types")}`),i=""),this.eCheckbox.setLabel(i),this.setupFixedAriaLabels(i)}getComponentHolder(){return this.params.column.getColDef()}};_SetFilterListItem.EVENT_SELECTION_CHANGED="selectionChanged",_SetFilterListItem.EVENT_EXPANDED_CHANGED="expandedChanged",_SetFilterListItem.GROUP_TEMPLATE=`
        <div class="ag-set-filter-item" aria-hidden="true">
            <span class="ag-set-filter-group-icons">
                <span class="ag-set-filter-group-closed-icon" ref="eGroupClosedIcon"></span>
                <span class="ag-set-filter-group-opened-icon" ref="eGroupOpenedIcon"></span>
                <span class="ag-set-filter-group-indeterminate-icon" ref="eGroupIndeterminateIcon"></span>
            </span>
            <ag-checkbox ref="eCheckbox" class="ag-set-filter-item-checkbox"></ag-checkbox>
        </div>`,_SetFilterListItem.TEMPLATE=`
        <div class="ag-set-filter-item">
            <ag-checkbox ref="eCheckbox" class="ag-set-filter-item-checkbox"></ag-checkbox>
        </div>`,__decorateClass([(0,import_core4.Autowired)("valueFormatterService")],_SetFilterListItem.prototype,"valueFormatterService",2),__decorateClass([(0,import_core4.Autowired)("userComponentFactory")],_SetFilterListItem.prototype,"userComponentFactory",2),__decorateClass([(0,import_core4.RefSelector)("eCheckbox")],_SetFilterListItem.prototype,"eCheckbox",2),__decorateClass([(0,import_core4.RefSelector)("eGroupOpenedIcon")],_SetFilterListItem.prototype,"eGroupOpenedIcon",2),__decorateClass([(0,import_core4.RefSelector)("eGroupClosedIcon")],_SetFilterListItem.prototype,"eGroupClosedIcon",2),__decorateClass([(0,import_core4.RefSelector)("eGroupIndeterminateIcon")],_SetFilterListItem.prototype,"eGroupIndeterminateIcon",2),__decorateClass([import_core4.PostConstruct],_SetFilterListItem.prototype,"init",1);var SetFilterListItem=_SetFilterListItem,DEFAULT_LOCALE_TEXT={loadingOoo:"Loading...",blanks:"(Blanks)",searchOoo:"Search...",selectAll:"(Select All)",selectAllSearchResults:"(Select All Search Results)",addCurrentSelectionToFilter:"Add current selection to filter",noMatches:"No matches."},SetFilterModelFormatter=class{getModelAsString(t,e){const{values:i}=t||e.getModel()||{},s=e.getValueModel();if(i==null||s==null)return"";const r=i.filter(n=>s.isKeyAvailable(n)),l=r.length,a=r.slice(0,10).map(n=>e.getFormattedValue(n));return`(${l}) ${a.join(",")}${l>10?",...":""}`}},SetFilter=class extends import_core5.ProvidedFilter{constructor(){super("setFilter"),this.valueModel=null,this.setFilterParams=null,this.virtualList=null,this.caseSensitive=!1,this.convertValuesToStrings=!1,this.treeDataTreeList=!1,this.groupingTreeList=!1,this.hardRefreshVirtualList=!1,this.noValueFormatterSupplied=!1,this.filterModelFormatter=new SetFilterModelFormatter,this.updateSetFilterOnParamsChange=t=>{var e;this.setFilterParams=t,this.convertValuesToStrings=!!t.convertValuesToStrings,this.caseSensitive=!!t.caseSensitive;const i=(e=t.keyCreator)!=null?e:t.colDef.keyCreator;this.setValueFormatter(t.valueFormatter,i,this.convertValuesToStrings,!!t.treeList,!!t.colDef.refData);const s=t.column.getId().startsWith(import_core5.GROUP_AUTO_COLUMN_ID);this.treeDataTreeList=this.gridOptionsService.get("treeData")&&!!t.treeList&&s,this.getDataPath=this.gridOptionsService.get("getDataPath"),this.groupingTreeList=!!this.columnModel.getRowGroupColumns().length&&!!t.treeList&&s,this.createKey=this.generateCreateKey(i,this.convertValuesToStrings,this.treeDataTreeList||this.groupingTreeList)}}postConstruct(){super.postConstruct()}updateUiVisibility(){}createBodyTemplate(){return`
            <div class="ag-set-filter">
                <div ref="eFilterLoading" class="ag-filter-loading ag-hidden">${this.translateForSetFilter("loadingOoo")}</div>
                <ag-input-text-field class="ag-mini-filter" ref="eMiniFilter"></ag-input-text-field>
                <div ref="eFilterNoMatches" class="ag-filter-no-matches ag-hidden">${this.translateForSetFilter("noMatches")}</div>
                <div ref="eSetFilterList" class="ag-set-filter-list" role="presentation"></div>
            </div>`}handleKeyDown(t){if(super.handleKeyDown(t),!t.defaultPrevented)switch(t.key){case import_core5.KeyCode.SPACE:this.handleKeySpace(t);break;case import_core5.KeyCode.ENTER:this.handleKeyEnter(t);break;case import_core5.KeyCode.LEFT:this.handleKeyLeft(t);break;case import_core5.KeyCode.RIGHT:this.handleKeyRight(t);break}}handleKeySpace(t){var e;(e=this.getComponentForKeyEvent(t))==null||e.toggleSelected()}handleKeyEnter(t){if(!this.setFilterParams)return;const{excelMode:e,readOnly:i}=this.setFilterParams||{};!e||i||(t.preventDefault(),this.onBtApply(!1,!1,t),this.setFilterParams.excelMode==="mac"&&this.eMiniFilter.getInputElement().select())}handleKeyLeft(t){var e;(e=this.getComponentForKeyEvent(t))==null||e.setExpanded(!1)}handleKeyRight(t){var e;(e=this.getComponentForKeyEvent(t))==null||e.setExpanded(!0)}getComponentForKeyEvent(t){var e;const i=this.gridOptionsService.getDocument();if(!this.eSetFilterList.contains(i.activeElement)||!this.virtualList)return;const s=this.virtualList.getLastFocusedRow();if(s==null)return;const r=this.virtualList.getComponentAt(s);if(r==null)return;t.preventDefault();const{readOnly:l}=(e=this.setFilterParams)!=null?e:{};if(!l)return r}getCssIdentifier(){return"set-filter"}setModel(t){var e;return t==null&&((e=this.valueModel)==null?void 0:e.getModel())==null?(this.setMiniFilter(null),import_core5.AgPromise.resolve()):super.setModel(t)}refresh(t){var e,i,s;return!super.refresh(t)||["treeList","treeListFormatter","treeListPathGetter","keyCreator","convertValuesToStrings","caseSensitive","comparator","suppressSelectAll","excelMode"].some(l=>{var a;return t[l]!==((a=this.setFilterParams)==null?void 0:a[l])})||this.haveColDefParamsChanged(t.colDef)?!1:(super.updateParams(t),this.updateSetFilterOnParamsChange(t),this.updateMiniFilter(),(t.cellRenderer!==((e=this.setFilterParams)==null?void 0:e.cellRenderer)||t.valueFormatter!==((i=this.setFilterParams)==null?void 0:i.valueFormatter))&&this.checkAndRefreshVirtualList(),(s=this.valueModel)==null||s.updateOnParamsChange(t).then(()=>{var l;(l=this.valueModel)!=null&&l.hasSelections()&&this.refreshFilterValues()}),!0)}haveColDefParamsChanged(t){var e;const i=["keyCreator","filterValueGetter"],s=(e=this.setFilterParams)==null?void 0:e.colDef;return i.some(r=>t[r]!==s?.[r])}setModelAndRefresh(t){return this.valueModel?this.valueModel.setModel(t).then(()=>this.checkAndRefreshVirtualList()):import_core5.AgPromise.resolve()}resetUiToDefaults(){return this.setMiniFilter(null),this.setModelAndRefresh(null)}setModelIntoUi(t){this.setMiniFilter(null);const e=t==null?null:t.values;return this.setModelAndRefresh(e)}getModelFromUi(){if(!this.valueModel)throw new Error("Value model has not been created.");const t=this.valueModel.getModel();return t?{values:t,filterType:this.getFilterType()}:null}getFilterType(){return"set"}getValueModel(){return this.valueModel}areModelsEqual(t,e){return t==null&&e==null?!0:t!=null&&e!=null&&import_core5._.areEqual(t.values,e.values)}setParams(t){var e;this.applyExcelModeOptions(t),super.setParams(t),this.updateSetFilterOnParamsChange(t);const i=(e=t.keyCreator)!=null?e:t.colDef.keyCreator;this.valueModel=new SetValueModel({filterParams:t,setIsLoading:s=>this.setIsLoading(s),valueFormatterService:this.valueFormatterService,translate:s=>this.translateForSetFilter(s),caseFormat:s=>this.caseFormat(s),createKey:this.createKey,valueFormatter:this.valueFormatter,usingComplexObjects:!!i,gridOptionsService:this.gridOptionsService,columnModel:this.columnModel,valueService:this.valueService,treeDataTreeList:this.treeDataTreeList,groupingTreeList:this.groupingTreeList,addManagedListener:(s,r)=>this.addManagedListener(this.eventService,s,r)}),this.initialiseFilterBodyUi(),this.addEventListenersForDataChanges()}onAddCurrentSelectionToFilterChange(t){if(!this.valueModel)throw new Error("Value model has not been created.");this.valueModel.setAddCurrentSelectionToFilter(t)}setValueFormatter(t,e,i,s,r){let l=t;if(!l){if(e&&!i&&!s)throw new Error("AG Grid: Must supply a Value Formatter in Set Filter params when using a Key Creator unless convertValuesToStrings is enabled");this.noValueFormatterSupplied=!0,r||(l=a=>import_core5._.toStringOrNull(a.value))}this.valueFormatter=l}generateCreateKey(t,e,i){if(i&&!t)throw new Error("AG Grid: Must supply a Key Creator in Set Filter params when `treeList = true` on a group column, and Tree Data or Row Grouping is enabled.");return t?(s,r=null)=>{const l=this.getKeyCreatorParams(s,r);return import_core5._.makeNull(t(l))}:e?s=>Array.isArray(s)?s:import_core5._.makeNull(import_core5._.toStringOrNull(s)):s=>import_core5._.makeNull(import_core5._.toStringOrNull(s))}getFormattedValue(t){var e;let i=this.valueModel.getValue(t);this.noValueFormatterSupplied&&(this.treeDataTreeList||this.groupingTreeList)&&Array.isArray(i)&&(i=import_core5._.last(i));const s=this.valueFormatterService.formatValue(this.setFilterParams.column,null,i,this.valueFormatter,!1);return(e=s??import_core5._.toStringOrNull(i))!=null?e:this.translateForSetFilter("blanks")}applyExcelModeOptions(t){t.excelMode==="windows"?(t.buttons||(t.buttons=["apply","cancel"]),t.closeOnApply==null&&(t.closeOnApply=!0)):t.excelMode==="mac"&&(t.buttons||(t.buttons=["reset"]),t.applyMiniFilterWhileTyping==null&&(t.applyMiniFilterWhileTyping=!0),t.debounceMs==null&&(t.debounceMs=500)),t.excelMode&&t.defaultToNothingSelected&&(t.defaultToNothingSelected=!1,import_core5._.warnOnce('The Set Filter Parameter "defaultToNothingSelected" value was ignored because it does not work when "excelMode" is used.'))}addEventListenersForDataChanges(){this.isValuesTakenFromGrid()&&(this.addManagedListener(this.eventService,import_core5.Events.EVENT_CELL_VALUE_CHANGED,t=>{this.setFilterParams&&t.column===this.setFilterParams.column&&this.syncAfterDataChange()}),this.addManagedPropertyListeners(["treeData","getDataPath","groupAllowUnbalanced"],()=>{this.syncAfterDataChange()}))}syncAfterDataChange(){if(!this.valueModel)throw new Error("Value model has not been created.");return this.valueModel.refreshValues().then(()=>{this.checkAndRefreshVirtualList(),this.onBtApply(!1,!0)})}setIsLoading(t){import_core5._.setDisplayed(this.eFilterLoading,t),t||(this.hardRefreshVirtualList=!0)}initialiseFilterBodyUi(){this.initVirtualList(),this.initMiniFilter()}initVirtualList(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const e=this.localeService.getLocaleTextFunc()("ariaFilterList","Filter List"),i=!!this.setFilterParams.treeList,s=this.virtualList=this.createBean(new import_core5.VirtualList({cssIdentifier:"filter",ariaRole:i?"tree":"listbox",listName:e})),r=this.getRefElement("eSetFilterList");i&&r.classList.add("ag-set-filter-tree-list"),r&&r.appendChild(s.getGui());const{cellHeight:l}=this.setFilterParams;l!=null&&s.setRowHeight(l);const a=(o,d)=>this.createSetListItem(o,i,d);s.setComponentCreator(a);const n=(o,d)=>this.updateSetListItem(o,d);s.setComponentUpdater(n);let h;this.setFilterParams.suppressSelectAll?h=new ModelWrapper(this.valueModel):h=new ModelWrapperWithSelectAll(this.valueModel,()=>this.isSelectAllSelected()),i&&(h=new TreeModelWrapper(h)),s.setModel(h)}getSelectAllLabel(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const t=this.valueModel.getMiniFilter()==null||!this.setFilterParams.excelMode?"selectAll":"selectAllSearchResults";return this.translateForSetFilter(t)}getAddSelectionToFilterLabel(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");return this.translateForSetFilter("addCurrentSelectionToFilter")}createSetListItem(t,e,i){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const s=this.valueModel.hasGroups(),{isSelected:r,isExpanded:l}=this.isSelectedExpanded(t),{value:a,depth:n,isGroup:h,hasIndeterminateExpandState:o,selectedListener:d,expandedListener:u}=this.newSetListItemAttributes(t,e),p={focusWrapper:i,value:a,params:this.setFilterParams,translate:f=>this.translateForSetFilter(f),valueFormatter:this.valueFormatter,item:t,isSelected:r,isTree:e,depth:n,groupsExist:s,isGroup:h,isExpanded:l,hasIndeterminateExpandState:o},c=this.createBean(new SetFilterListItem(p));return c.addEventListener(SetFilterListItem.EVENT_SELECTION_CHANGED,d),u&&c.addEventListener(SetFilterListItem.EVENT_EXPANDED_CHANGED,u),c}newSetTreeItemAttributes(t,e){var i,s,r,l,a,n;if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const h=this.valueModel.hasGroups();return t.key===SetFilterDisplayValue.SELECT_ALL?{value:()=>this.getSelectAllLabel(),isGroup:h,depth:t.depth,hasIndeterminateExpandState:!0,selectedListener:o=>this.onSelectAll(o.isSelected),expandedListener:o=>this.onExpandAll(o.item,o.isExpanded)}:t.key===SetFilterDisplayValue.ADD_SELECTION_TO_FILTER?{value:()=>this.getAddSelectionToFilterLabel(),depth:t.depth,isGroup:!1,hasIndeterminateExpandState:!1,selectedListener:o=>{this.onAddCurrentSelectionToFilterChange(o.isSelected)}}:t.children?{value:(r=(s=(i=this.setFilterParams).treeListFormatter)==null?void 0:s.call(i,t.treeKey,t.depth,t.parentTreeKeys))!=null?r:t.treeKey,depth:t.depth,isGroup:!0,selectedListener:o=>this.onGroupItemSelected(o.item,o.isSelected),expandedListener:o=>this.onExpandedChanged(o.item,o.isExpanded)}:{value:(n=(a=(l=this.setFilterParams).treeListFormatter)==null?void 0:a.call(l,t.treeKey,t.depth,t.parentTreeKeys))!=null?n:t.treeKey,depth:t.depth,selectedListener:o=>this.onItemSelected(o.item.key,o.isSelected)}}newSetListItemAttributes(t,e){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");return this.isSetFilterModelTreeItem(t)?this.newSetTreeItemAttributes(t,e):t===SetFilterDisplayValue.SELECT_ALL?{value:()=>this.getSelectAllLabel(),selectedListener:i=>this.onSelectAll(i.isSelected)}:t===SetFilterDisplayValue.ADD_SELECTION_TO_FILTER?{value:()=>this.getAddSelectionToFilterLabel(),selectedListener:i=>{this.onAddCurrentSelectionToFilterChange(i.isSelected)}}:{value:this.valueModel.getValue(t),selectedListener:i=>this.onItemSelected(i.item,i.isSelected)}}updateSetListItem(t,e){const{isSelected:i,isExpanded:s}=this.isSelectedExpanded(t);e.refresh(t,i,s)}isSelectedExpanded(t){let e,i;return this.isSetFilterModelTreeItem(t)?(i=t.expanded,t.key===SetFilterDisplayValue.SELECT_ALL?e=this.isSelectAllSelected():t.key===SetFilterDisplayValue.ADD_SELECTION_TO_FILTER?e=this.valueModel.isAddCurrentSelectionToFilterChecked():t.children?e=this.areAllChildrenSelected(t):e=this.valueModel.isKeySelected(t.key)):t===SetFilterDisplayValue.SELECT_ALL?e=this.isSelectAllSelected():t===SetFilterDisplayValue.ADD_SELECTION_TO_FILTER?e=this.valueModel.isAddCurrentSelectionToFilterChecked():e=this.valueModel.isKeySelected(t),{isSelected:e,isExpanded:i}}isSetFilterModelTreeItem(t){return t?.treeKey!==void 0}initMiniFilter(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const{eMiniFilter:t,localeService:e}=this,i=e.getLocaleTextFunc();t.setDisplayed(!this.setFilterParams.suppressMiniFilter),t.setValue(this.valueModel.getMiniFilter()),t.onValueChange(()=>this.onMiniFilterInput()),t.setInputAriaLabel(i("ariaSearchFilterValues","Search filter values")),this.addManagedListener(t.getInputElement(),"keydown",s=>this.onMiniFilterKeyDown(s))}updateMiniFilter(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const{eMiniFilter:t}=this;t.isDisplayed()!==!this.setFilterParams.suppressMiniFilter&&t.setDisplayed(!this.setFilterParams.suppressMiniFilter);const e=this.valueModel.getMiniFilter();t.getValue()!==e&&t.setValue(e)}afterGuiAttached(t){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");super.afterGuiAttached(t),this.resetExpansion(),this.refreshVirtualList();const{eMiniFilter:e}=this;e.setInputPlaceholder(this.translateForSetFilter("searchOoo")),(!t||!t.suppressFocus)&&e.getFocusableElement().focus()}afterGuiDetached(){var t,e;super.afterGuiDetached(),(t=this.setFilterParams)!=null&&t.excelMode&&this.resetMiniFilter();const i=this.getModel();((e=this.setFilterParams)!=null&&e.excelMode||!this.areModelsEqual(i,this.getModelFromUi()))&&(this.resetUiToActiveModel(i),this.showOrHideResults())}applyModel(t="api"){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");this.setFilterParams.excelMode&&t!=="rowDataUpdated"&&this.valueModel.isEverythingVisibleSelected()&&this.valueModel.selectAllMatchingMiniFilter();const e=this.valueModel.showAddCurrentSelectionToFilter()&&this.valueModel.isAddCurrentSelectionToFilterChecked();if(e&&!this.getModel())return!1;const i=super.applyModel(t),s=this.getModel();return s?(e||this.valueModel.setAppliedModelKeys(new Set),s.values.forEach(r=>{this.valueModel.addToAppliedModelKeys(r)})):e||this.valueModel.setAppliedModelKeys(null),i}isModelValid(t){return this.setFilterParams&&this.setFilterParams.excelMode?t==null||t.values.length>0:!0}doesFilterPass(t){if(!this.setFilterParams||!this.valueModel||!this.valueModel.getCaseFormattedAppliedModelKeys())return!0;if(!this.valueModel.hasAnyAppliedModelKey())return!1;const{node:e,data:i}=t;if(this.treeDataTreeList)return this.doesFilterPassForTreeData(e,i);if(this.groupingTreeList)return this.doesFilterPassForGrouping(e);let s=this.getValueFromNode(e);return this.convertValuesToStrings?this.doesFilterPassForConvertValuesToString(e,s):s!=null&&Array.isArray(s)?s.length===0?this.valueModel.hasAppliedModelKey(null):s.some(r=>this.isInAppliedModel(this.createKey(r,e))):this.isInAppliedModel(this.createKey(s,e))}doesFilterPassForConvertValuesToString(t,e){const i=this.createKey(e,t);return i!=null&&Array.isArray(i)?i.length===0?this.valueModel.hasAppliedModelKey(null):i.some(s=>this.isInAppliedModel(s)):this.isInAppliedModel(i)}doesFilterPassForTreeData(t,e){var i;return(i=t.childrenAfterGroup)!=null&&i.length?!1:this.isInAppliedModel(this.createKey(this.checkMakeNullDataPath(this.getDataPath(e))))}doesFilterPassForGrouping(t){const e=this.columnModel.getRowGroupColumns().map(i=>this.valueService.getKeyForNode(i,t));return e.push(this.getValueFromNode(t)),this.isInAppliedModel(this.createKey(this.checkMakeNullDataPath(e)))}checkMakeNullDataPath(t){return t&&(t=t.map(e=>import_core5._.toStringOrNull(import_core5._.makeNull(e)))),t?.some(e=>e==null)?null:t}isInAppliedModel(t){return this.valueModel.hasAppliedModelKey(t)}getValueFromNode(t){return this.setFilterParams.getValue(t)}getKeyCreatorParams(t,e=null){return{value:t,colDef:this.setFilterParams.colDef,column:this.setFilterParams.column,node:e,data:e?.data,api:this.setFilterParams.api,columnApi:this.setFilterParams.columnApi,context:this.setFilterParams.context}}onNewRowsLoaded(){this.isValuesTakenFromGrid()&&this.syncAfterDataChange()}isValuesTakenFromGrid(){return this.valueModel?this.valueModel.getValuesType()===2:!1}setFilterValues(t){if(!this.valueModel)throw new Error("Value model has not been created.");this.valueModel.overrideValues(t).then(()=>{this.checkAndRefreshVirtualList(),this.onUiChanged()})}resetFilterValues(){if(!this.valueModel)throw new Error("Value model has not been created.");this.valueModel.setValuesType(2),this.syncAfterDataChange()}refreshFilterValues(){if(!this.valueModel)throw new Error("Value model has not been created.");this.valueModel.isInitialised()&&this.valueModel.refreshValues().then(()=>{this.checkAndRefreshVirtualList(),this.onUiChanged()})}onAnyFilterChanged(){setTimeout(()=>{if(this.isAlive()){if(!this.valueModel)throw new Error("Value model has not been created.");this.valueModel.refreshAfterAnyFilterChanged().then(t=>{t&&(this.checkAndRefreshVirtualList(),this.showOrHideResults())})}},0)}onMiniFilterInput(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");if(!this.valueModel.setMiniFilter(this.eMiniFilter.getValue()))return;const{applyMiniFilterWhileTyping:t,readOnly:e}=this.setFilterParams||{};!e&&t?this.filterOnAllVisibleValues(!1):this.updateUiAfterMiniFilterChange()}updateUiAfterMiniFilterChange(){if(!this.setFilterParams)throw new Error("Set filter params have not been provided.");if(!this.valueModel)throw new Error("Value model has not been created.");const{excelMode:t,readOnly:e}=this.setFilterParams||{};t==null||e?this.checkAndRefreshVirtualList():this.valueModel.getMiniFilter()==null?this.resetUiToActiveModel(this.getModel()):(this.valueModel.selectAllMatchingMiniFilter(!0),this.checkAndRefreshVirtualList(),this.onUiChanged()),this.showOrHideResults()}showOrHideResults(){if(!this.valueModel)throw new Error("Value model has not been created.");const t=this.valueModel.getMiniFilter()!=null&&this.valueModel.getDisplayedValueCount()<1;import_core5._.setDisplayed(this.eNoMatches,t),import_core5._.setDisplayed(this.eSetFilterList,!t)}resetMiniFilter(){var t;this.eMiniFilter.setValue(null,!0),(t=this.valueModel)==null||t.setMiniFilter(null)}resetUiToActiveModel(t,e){this.setModelAndRefresh(t==null?null:t.values).then(()=>{this.onUiChanged(!1,"prevent"),e?.()})}handleCancelEnd(t){this.setMiniFilter(null),super.handleCancelEnd(t)}onMiniFilterKeyDown(t){const{excelMode:e,readOnly:i}=this.setFilterParams||{};t.key===import_core5.KeyCode.ENTER&&!e&&!i&&this.filterOnAllVisibleValues()}filterOnAllVisibleValues(t=!0){const{readOnly:e}=this.setFilterParams||{};if(!this.valueModel)throw new Error("Value model has not been created.");if(e)throw new Error("Unable to filter in readOnly mode.");this.valueModel.selectAllMatchingMiniFilter(!0),this.checkAndRefreshVirtualList(),this.onUiChanged(!1,t?"immediately":"debounce"),this.showOrHideResults()}focusRowIfAlive(t){t!=null&&window.setTimeout(()=>{if(!this.virtualList)throw new Error("Virtual list has not been created.");this.isAlive()&&this.virtualList.focusRow(t)},0)}onSelectAll(t){if(!this.valueModel)throw new Error("Value model has not been created.");if(!this.virtualList)throw new Error("Virtual list has not been created.");t?this.valueModel.selectAllMatchingMiniFilter():this.valueModel.deselectAllMatchingMiniFilter(),this.refreshAfterSelection()}onGroupItemSelected(t,e){const i=s=>{s.children?s.children.forEach(r=>i(r)):this.selectItem(s.key,e)};i(t),this.refreshAfterSelection()}onItemSelected(t,e){if(!this.valueModel)throw new Error("Value model has not been created.");if(!this.virtualList)throw new Error("Virtual list has not been created.");this.selectItem(t,e),this.refreshAfterSelection()}selectItem(t,e){e?this.valueModel.selectKey(t):this.valueModel.deselectKey(t)}onExpandAll(t,e){const i=s=>{s.filterPasses&&s.available&&s.children&&(s.children.forEach(r=>i(r)),s.expanded=e)};i(t),this.refreshAfterExpansion()}onExpandedChanged(t,e){t.expanded=e,this.refreshAfterExpansion()}refreshAfterExpansion(){const t=this.virtualList.getLastFocusedRow();this.valueModel.updateDisplayedValues("expansion"),this.checkAndRefreshVirtualList(),this.focusRowIfAlive(t)}refreshAfterSelection(){const t=this.virtualList.getLastFocusedRow();this.checkAndRefreshVirtualList(),this.onUiChanged(),this.focusRowIfAlive(t)}setMiniFilter(t){this.eMiniFilter.setValue(t),this.onMiniFilterInput()}getMiniFilter(){return this.valueModel?this.valueModel.getMiniFilter():null}checkAndRefreshVirtualList(){if(!this.virtualList)throw new Error("Virtual list has not been created.");this.virtualList.refresh(!this.hardRefreshVirtualList),this.hardRefreshVirtualList&&(this.hardRefreshVirtualList=!1)}getFilterKeys(){return this.valueModel?this.valueModel.getKeys():[]}getFilterValues(){return this.valueModel?this.valueModel.getValues():[]}getValues(){return this.getFilterKeys()}refreshVirtualList(){this.setFilterParams&&this.setFilterParams.refreshValuesOnOpen?this.refreshFilterValues():this.checkAndRefreshVirtualList()}translateForSetFilter(t){return this.localeService.getLocaleTextFunc()(t,DEFAULT_LOCALE_TEXT[t])}isSelectAllSelected(){if(!this.setFilterParams||!this.valueModel)return!1;if(this.setFilterParams.defaultToNothingSelected){if(this.valueModel.hasSelections()&&this.valueModel.isEverythingVisibleSelected())return!0;if(this.valueModel.isNothingVisibleSelected())return!1}else{if(this.valueModel.hasSelections()&&this.valueModel.isNothingVisibleSelected())return!1;if(this.valueModel.isEverythingVisibleSelected())return!0}}areAllChildrenSelected(t){const e=i=>{if(i.children){let s=!1,r=!1;return i.children.some(a=>{if(!a.filterPasses||!a.available)return!1;const n=e(a);return n===void 0?!0:(n?s=!0:r=!0,s&&r)})?void 0:s}else return this.valueModel.isKeySelected(i.key)};return this.setFilterParams.defaultToNothingSelected?this.valueModel.hasSelections()&&e(t):e(t)}destroy(){this.virtualList!=null&&(this.virtualList.destroy(),this.virtualList=null),super.destroy()}caseFormat(t){return t==null||typeof t!="string"||this.caseSensitive?t:t.toUpperCase()}resetExpansion(){var t,e;if(!((t=this.setFilterParams)!=null&&t.treeList))return;const i=(e=this.valueModel)==null?void 0:e.getSelectAllItem();if(this.isSetFilterModelTreeItem(i)){const s=r=>{r.children&&(r.children.forEach(l=>s(l)),r.expanded=!1)};s(i),this.valueModel.updateDisplayedValues("expansion")}}getModelAsString(t){return this.filterModelFormatter.getModelAsString(t,this)}getPositionableElement(){return this.eSetFilterList}};__decorateClass([(0,import_core5.RefSelector)("eMiniFilter")],SetFilter.prototype,"eMiniFilter",2),__decorateClass([(0,import_core5.RefSelector)("eFilterLoading")],SetFilter.prototype,"eFilterLoading",2),__decorateClass([(0,import_core5.RefSelector)("eSetFilterList")],SetFilter.prototype,"eSetFilterList",2),__decorateClass([(0,import_core5.RefSelector)("eFilterNoMatches")],SetFilter.prototype,"eNoMatches",2),__decorateClass([(0,import_core5.Autowired)("valueFormatterService")],SetFilter.prototype,"valueFormatterService",2),__decorateClass([(0,import_core5.Autowired)("columnModel")],SetFilter.prototype,"columnModel",2),__decorateClass([(0,import_core5.Autowired)("valueService")],SetFilter.prototype,"valueService",2);var ModelWrapper=class{constructor(t){this.model=t}getRowCount(){return this.model.getDisplayedValueCount()}getRow(t){return this.model.getDisplayedItem(t)}areRowsEqual(t,e){return t===e}},ModelWrapperWithSelectAll=class{constructor(t,e){this.model=t,this.isSelectAllSelected=e}getRowCount(){const e=this.model.showAddCurrentSelectionToFilter()?2:1;return this.model.getDisplayedValueCount()+e}getRow(t){if(t===0)return this.model.getSelectAllItem();const e=this.model.showAddCurrentSelectionToFilter(),i=e?2:1;return t===1&&e?this.model.getAddSelectionToFilterItem():this.model.getDisplayedItem(t-i)}areRowsEqual(t,e){return t===e}},TreeModelWrapper=class{constructor(t){this.model=t}getRowCount(){return this.model.getRowCount()}getRow(t){return this.model.getRow(t)}areRowsEqual(t,e){return t==null&&e==null?!0:t!=null&&e!=null&&t.treeKey===e.treeKey&&t.depth===e.depth}},import_core6=require("@ag-grid-community/core"),SetFloatingFilterComp=class extends import_core6.Component{constructor(){super(`
            <div class="ag-floating-filter-input ag-set-floating-filter-input" role="presentation">
                <ag-input-text-field ref="eFloatingFilterText"></ag-input-text-field>
            </div>`),this.availableValuesListenerAdded=!1,this.filterModelFormatter=new SetFilterModelFormatter}destroy(){super.destroy()}init(t){this.params=t,this.eFloatingFilterText.setDisabled(!0).addGuiEventListener("click",()=>this.params.showParentFilter()),this.setParams(t)}setParams(t){const e=this.columnModel.getDisplayNameForColumn(t.column,"header",!0),i=this.localeService.getLocaleTextFunc();this.eFloatingFilterText.setInputAriaLabel(`${e} ${i("ariaFilterInput","Filter Input")}`)}onParamsUpdated(t){this.refresh(t)}refresh(t){this.params=t,this.setParams(t)}onParentModelChanged(t){this.updateFloatingFilterText(t)}parentSetFilterInstance(t){this.params.parentFilterInstance(e=>{if(!(e instanceof SetFilter))throw new Error("AG Grid - SetFloatingFilter expects SetFilter as its parent");t(e)})}addAvailableValuesListener(){this.parentSetFilterInstance(t=>{const e=t.getValueModel();e&&this.addManagedListener(e,SetValueModel.EVENT_AVAILABLE_VALUES_CHANGED,()=>this.updateFloatingFilterText())}),this.availableValuesListenerAdded=!0}updateFloatingFilterText(t){this.availableValuesListenerAdded||this.addAvailableValuesListener(),this.parentSetFilterInstance(e=>{this.eFloatingFilterText.setValue(this.filterModelFormatter.getModelAsString(t,e))})}};__decorateClass([(0,import_core6.RefSelector)("eFloatingFilterText")],SetFloatingFilterComp.prototype,"eFloatingFilterText",2),__decorateClass([(0,import_core6.Autowired)("columnModel")],SetFloatingFilterComp.prototype,"columnModel",2);var VERSION="31.2.1",SetFilterModule={version:VERSION,moduleName:import_core7.ModuleNames.SetFilterModule,beans:[],userComponents:[{componentName:"agSetColumnFilter",componentClass:SetFilter},{componentName:"agSetColumnFloatingFilter",componentClass:SetFloatingFilterComp}],dependantModules:[import_core8.EnterpriseCoreModule]};
