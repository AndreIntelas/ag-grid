/**
          * @ag-grid-enterprise/server-side-row-model - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v28.0.2
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
/**
          * @ag-grid-enterprise/server-side-row-model - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v28.0.2
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t,o=require("@ag-grid-community/core"),r=require("@ag-grid-enterprise/core"),n=(e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)},function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}),i=function(e,t,o,r){var n,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,o,s):n(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pauseStoreUpdateListening=!1,t.started=!1,t}return n(t,e),t.prototype.ensureRowHeightsValid=function(){return!1},t.prototype.start=function(){this.started=!0;var e=this.gridOptionsWrapper.getServerSideDatasource();e&&this.setDatasource(e)},t.prototype.destroyDatasource=function(){this.datasource&&(this.datasource.destroy&&this.datasource.destroy(),this.rowRenderer.datasourceChanged(),this.datasource=void 0)},t.prototype.addEventListeners=function(){this.addManagedListener(this.eventService,o.Events.EVENT_NEW_COLUMNS_LOADED,this.onColumnEverything.bind(this)),this.addManagedListener(this.eventService,o.Events.EVENT_STORE_UPDATED,this.onStoreUpdated.bind(this));var e=this.resetRootStore.bind(this);this.addManagedListener(this.eventService,o.Events.EVENT_COLUMN_VALUE_CHANGED,e),this.addManagedListener(this.eventService,o.Events.EVENT_COLUMN_PIVOT_CHANGED,e),this.addManagedListener(this.eventService,o.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,e),this.addManagedListener(this.eventService,o.Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,e),this.verifyProps()},t.prototype.verifyProps=function(){if(null!=this.gridOptionsWrapper.getInitialGroupOrderComparator()){o._.doOnce((function(){return console.warn("AG Grid: initialGroupOrderComparator cannot be used with Server Side Row Model. If using Full Store, then provide the rows to the grid in the desired sort order. If using Infinite Scroll, then sorting is done on the server side, nothing to do with the client.")}),"SSRM.InitialGroupOrderComparator")}if(this.gridOptionsWrapper.isRowSelection()&&null==this.gridOptionsWrapper.getRowIdFunc()){o._.doOnce((function(){return console.warn("AG Grid: getRowId callback must be provided for Server Side Row Model selection to work correctly.")}),"SSRM.SelectionNeedsRowNodeIdFunc")}},t.prototype.setDatasource=function(e){this.started&&(this.destroyDatasource(),this.datasource=e,this.resetRootStore())},t.prototype.isLastRowIndexKnown=function(){var e=this.getRootStore();return!!e&&e.isLastRowIndexKnown()},t.prototype.onColumnEverything=function(){if(!this.gridOptionsWrapper.isSuppressEnterpriseResetOnNewColumns())if(this.storeParams){var e=this.columnsToValueObjects(this.columnModel.getRowGroupColumns()),t=this.columnsToValueObjects(this.columnModel.getValueColumns()),r=this.columnsToValueObjects(this.columnModel.getPivotColumns()),n=!o._.jsonEquals(this.storeParams.sortModel,this.sortController.getSortModel()),i=!o._.jsonEquals(this.storeParams.rowGroupCols,e),s=!o._.jsonEquals(this.storeParams.pivotCols,r),a=!o._.jsonEquals(this.storeParams.valueCols,t);(n||i||s||a)&&this.resetRootStore()}else this.resetRootStore()},t.prototype.destroyRootStore=function(){this.rootNode&&this.rootNode.childStore&&(this.rootNode.childStore=this.destroyBean(this.rootNode.childStore),this.nodeManager.clear())},t.prototype.refreshAfterSort=function(e,t){this.storeParams&&(this.storeParams.sortModel=e);var o=this.getRootStore();o&&(o.refreshAfterSort(t),this.onStoreUpdated())},t.prototype.resetRootStore=function(){this.destroyRootStore(),this.rootNode=new o.RowNode(this.beans),this.rootNode.group=!0,this.rootNode.level=-1,this.datasource&&(this.storeParams=this.createStoreParams(),this.rootNode.childStore=this.createBean(this.storeFactory.createStore(this.storeParams,this.rootNode)),this.updateRowIndexesAndBounds());var e={type:o.Events.EVENT_ROW_DATA_UPDATED,api:this.gridApi,columnApi:this.columnApi};this.eventService.dispatchEvent(e),this.dispatchModelUpdated(!0)},t.prototype.columnsToValueObjects=function(e){var t=this;return e.map((function(e){return{id:e.getId(),aggFunc:e.getAggFunc(),displayName:t.columnModel.getDisplayNameForColumn(e,"model"),field:e.getColDef().field}}))},t.prototype.createStoreParams=function(){var e=this.columnsToValueObjects(this.columnModel.getRowGroupColumns()),t=this.columnsToValueObjects(this.columnModel.getValueColumns()),r=this.columnsToValueObjects(this.columnModel.getPivotColumns()),n=this.gridOptionsWrapper.isDynamicRowHeight();return{valueCols:t,rowGroupCols:e,pivotCols:r,pivotMode:this.columnModel.isPivotMode(),filterModel:this.filterManager.getFilterModel(),sortModel:this.sortListener.extractSortModel(),datasource:this.datasource,lastAccessedSequence:new o.NumberSequence,dynamicRowHeight:n}},t.prototype.getParams=function(){return this.storeParams},t.prototype.dispatchModelUpdated=function(e){void 0===e&&(e=!1);var t={type:o.Events.EVENT_MODEL_UPDATED,api:this.gridApi,columnApi:this.columnApi,animate:!e,keepRenderedRows:!e,newPage:!1,newData:!1};this.eventService.dispatchEvent(t)},t.prototype.onStoreUpdated=function(){this.pauseStoreUpdateListening||(this.updateRowIndexesAndBounds(),this.dispatchModelUpdated())},t.prototype.onRowHeightChanged=function(){this.updateRowIndexesAndBounds(),this.dispatchModelUpdated()},t.prototype.updateRowIndexesAndBounds=function(){var e=this.getRootStore();e&&e.setDisplayIndexes(new o.NumberSequence,{value:0})},t.prototype.retryLoads=function(){var e=this.getRootStore();e&&(e.retryLoads(),this.onStoreUpdated())},t.prototype.getRow=function(e){var t=this.getRootStore();if(t)return t.getRowUsingDisplayIndex(e)},t.prototype.expandAll=function(e){this.pauseStoreUpdateListening=!0,this.forEachNode((function(t){t.group&&t.setExpanded(e)})),this.pauseStoreUpdateListening=!1,this.onStoreUpdated()},t.prototype.refreshAfterFilter=function(e,t){this.storeParams&&(this.storeParams.filterModel=e);var o=this.getRootStore();o&&(o.refreshAfterFilter(t),this.onStoreUpdated())},t.prototype.getRootStore=function(){if(this.rootNode&&this.rootNode.childStore)return this.rootNode.childStore},t.prototype.getRowCount=function(){var e=this.getRootStore();return e?e.getDisplayIndexEnd():0},t.prototype.getTopLevelRowCount=function(){var e=this.getRootStore();return e?e.getRowCount():1},t.prototype.getTopLevelRowDisplayedIndex=function(e){var t=this.getRootStore();return t?t.getTopLevelRowDisplayedIndex(e):e},t.prototype.getRowBounds=function(e){var t=this.getRootStore();return t?t.getRowBounds(e):{rowTop:0,rowHeight:this.gridOptionsWrapper.getRowHeightAsNumber()}},t.prototype.getRowIndexAtPixel=function(e){var t=this.getRootStore();return e<=0||!t?0:t.getRowIndexAtPixel(e)},t.prototype.isEmpty=function(){return!1},t.prototype.isRowsToRender=function(){return null!=this.getRootStore()&&this.getRowCount()>0},t.prototype.getType=function(){return o.Constants.ROW_MODEL_TYPE_SERVER_SIDE},t.prototype.forEachNode=function(e){var t=this.getRootStore();t&&t.forEachNodeDeep(e)},t.prototype.forEachNodeAfterFilterAndSort=function(e){var t=this.getRootStore();t&&t.forEachNodeDeepAfterFilterAndSort(e)},t.prototype.executeOnStore=function(e,t){var o=this.getRootStore();if(o){var r=o.getChildStore(e);r&&t(r)}},t.prototype.refreshStore=function(e){void 0===e&&(e={});var t=e.route?e.route:[];this.executeOnStore(t,(function(t){return t.refreshStore(1==e.purge)}))},t.prototype.getStoreState=function(){var e=[],t=this.getRootStore();return t&&t.addStoreStates(e),e},t.prototype.getNodesInRangeForSelection=function(e,t){return o._.exists(t)&&e.parent!==t.parent?[]:e.parent.childStore.getRowNodesInRange(t,e)},t.prototype.getRowNode=function(e){var t;return this.forEachNode((function(o){o.id===e&&(t=o),o.detailNode&&o.detailNode.id===e&&(t=o.detailNode)})),t},t.prototype.isRowPresent=function(e){return!!this.getRowNode(e.id)},i([o.Autowired("columnModel")],t.prototype,"columnModel",void 0),i([o.Autowired("filterManager")],t.prototype,"filterManager",void 0),i([o.Autowired("sortController")],t.prototype,"sortController",void 0),i([o.Autowired("gridApi")],t.prototype,"gridApi",void 0),i([o.Autowired("columnApi")],t.prototype,"columnApi",void 0),i([o.Autowired("rowRenderer")],t.prototype,"rowRenderer",void 0),i([o.Autowired("ssrmSortService")],t.prototype,"sortListener",void 0),i([o.Autowired("ssrmNodeManager")],t.prototype,"nodeManager",void 0),i([o.Autowired("ssrmStoreFactory")],t.prototype,"storeFactory",void 0),i([o.Autowired("beans")],t.prototype,"beans",void 0),i([o.PreDestroy],t.prototype,"destroyDatasource",null),i([o.PostConstruct],t.prototype,"addEventListeners",null),i([o.PreDestroy],t.prototype,"destroyRootStore",null),t=i([o.Bean("rowModel")],t)}(o.BeanStub),a=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),l=function(e,t,o,r){var n,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,o,s):n(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.loadFromDatasource=function(e){var t=e.storeParams,o=e.parentBlock,r=e.parentNode.getGroupKeys();if(t.datasource){var n={startRow:e.startRow,endRow:e.endRow,rowGroupCols:t.rowGroupCols,valueCols:t.valueCols,pivotCols:t.pivotCols,pivotMode:t.pivotMode,groupKeys:r,filterModel:t.filterModel,sortModel:t.sortModel},i={successCallback:e.successCallback,success:e.success,failCallback:e.failCallback,fail:e.fail,request:n,parentNode:e.parentNode,api:this.gridApi,columnApi:this.columnApi,context:this.gridOptionsWrapper.getContext()};window.setTimeout((function(){t.datasource&&o.isAlive()?t.datasource.getRows(i):e.failCallback()}),0)}},t.prototype.getChildStore=function(e,t,r){if(o._.missingOrEmpty(e))return t;var n=r(e[0]);if(n){var i=e.slice(1,e.length),s=n.childStore;return s?s.getChildStore(i):null}return null},t.prototype.isServerRefreshNeeded=function(e,t,o){if(o.valueColChanged||o.secondaryColChanged)return!0;var r=e.level+1;if(!(r<t.length))return!0;var n=t[r].id;return!!(o.changedColumns.indexOf(n)>-1)},l([o.Autowired("columnApi")],t.prototype,"columnApi",void 0),l([o.Autowired("gridApi")],t.prototype,"gridApi",void 0),t=l([o.Bean("ssrmStoreUtils")],t)}(o.BeanStub),c=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),u=function(e,t,o,r){var n,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,o,s):n(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t.prototype.postConstruct=function(){this.rowHeight=this.gridOptionsWrapper.getRowHeightAsNumber(),this.usingTreeData=this.gridOptionsWrapper.isTreeData(),this.usingMasterDetail=this.gridOptionsWrapper.isMasterDetail()},t.prototype.createRowNode=function(e){var t=new o.RowNode(this.beans),r=null!=e.rowHeight?e.rowHeight:this.rowHeight;return t.setRowHeight(r),t.group=e.group,t.leafGroup=e.leafGroup,t.level=e.level,t.uiLevel=e.level,t.parent=e.parent,t.stub=!0,t.group&&(t.expanded=!1,t.field=e.field,t.rowGroupColumn=e.rowGroupColumn),t},t.prototype.destroyRowNodes=function(e){var t=this;e&&e.forEach((function(e){return t.destroyRowNode(e)}))},t.prototype.destroyRowNode=function(e,t){void 0===t&&(t=!1),e.childStore&&!t&&(this.destroyBean(e.childStore),e.childStore=null),e.clearRowTopAndRowIndex(),null!=e.id&&this.nodeManager.removeNode(e)},t.prototype.setTreeGroupInfo=function(e){var t=this.gridOptionsWrapper.getIsServerSideGroupFunc(),o=this.gridOptionsWrapper.getServerSideGroupKeyFunc();null!=t&&(e.setGroup(t(e.data)),e.group&&null!=o&&(e.key=o(e.data))),e.group||null==e.childStore||(this.destroyBean(e.childStore),e.childStore=null)},t.prototype.setRowGroupInfo=function(e){e.key=this.valueService.getValue(e.rowGroupColumn,e),null!==e.key&&void 0!==e.key||o._.doOnce((function(){console.warn("AG Grid: null and undefined values are not allowed for server side row model keys"),e.rowGroupColumn&&console.warn("column = "+e.rowGroupColumn.getId()),console.warn("data is ",e.data)}),"ServerSideBlock-CannotHaveNullOrUndefinedForKey")},t.prototype.setMasterDetailInfo=function(e){var t=this.gridOptionsWrapper.getIsRowMasterFunc();e.master=null==t||t(e.data)},t.prototype.updateDataIntoRowNode=function(e,t){e.updateData(t),this.usingTreeData?this.setTreeGroupInfo(e):e.group||this.usingMasterDetail},t.prototype.setDataIntoRowNode=function(e,t,r,n){e.stub=!1,o._.exists(t)?(e.setDataAndId(t,r),this.usingTreeData?this.setTreeGroupInfo(e):e.group?this.setRowGroupInfo(e):this.usingMasterDetail&&this.setMasterDetailInfo(e)):(e.setDataAndId(void 0,void 0),e.key=null),(this.usingTreeData||e.group)&&(this.setGroupDataIntoRowNode(e),this.setChildCountIntoRowNode(e)),o._.exists(t)&&e.setRowHeight(this.gridOptionsWrapper.getRowHeightForNode(e,!1,n).height)},t.prototype.setChildCountIntoRowNode=function(e){var t=this.gridOptionsWrapper.getChildCountFunc();t&&(e.allChildrenCount=t(e.data))},t.prototype.setGroupDataIntoRowNode=function(e){var t=this,o=this.columnModel.getGroupDisplayColumns(),r=this.gridOptionsWrapper.isTreeData();o.forEach((function(o){if(null==e.groupData&&(e.groupData={}),r)e.groupData[o.getColId()]=e.key;else if(o.isRowGroupDisplayed(e.rowGroupColumn.getId())){var n=t.valueService.getValue(e.rowGroupColumn,e);e.groupData[o.getColId()]=n}}))},t.prototype.clearDisplayIndex=function(e){(e.clearRowTopAndRowIndex(),e.group&&o._.exists(e.childStore))&&e.childStore.clearDisplayIndexes();e.master&&e.detailNode&&e.detailNode.clearRowTopAndRowIndex()},t.prototype.setDisplayIndex=function(e,t,r){if(e.setRowIndex(t.next()),e.setRowTop(r.value),r.value+=e.rowHeight,e.master&&(e.expanded&&e.detailNode?(e.detailNode.setRowIndex(t.next()),e.detailNode.setRowTop(r.value),r.value+=e.detailNode.rowHeight):e.detailNode&&e.detailNode.clearRowTopAndRowIndex()),e.group&&o._.exists(e.childStore)){var n=e.childStore;e.expanded?n.setDisplayIndexes(t,r):n.clearDisplayIndexes()}},t.prototype.binarySearchForDisplayIndex=function(e,t){var r=0,n=t.length-1;if(o._.missing(n)||o._.missing(r))console.warn("AG Grid: error: topPointer = "+n+", bottomPointer = "+r);else for(;;){var i=Math.floor((r+n)/2),s=t[i];if(s.rowIndex===e)return s;var a=s.master&&s.expanded,l=s.detailNode;if(a&&l&&l.rowIndex===e)return s.detailNode;var d=s.childStore;if(s.expanded&&d&&d.isDisplayIndexInStore(e))return d.getRowUsingDisplayIndex(e);if(s.rowIndex<e)r=i+1;else{if(!(s.rowIndex>e))return void console.warn("AG Grid: error: unable to locate rowIndex = "+e+" in cache");n=i-1}}},t.prototype.extractRowBounds=function(e,t){var r=function(e){return{rowHeight:e.rowHeight,rowTop:e.rowTop}};if(e.rowIndex===t)return r(e);if(e.group&&e.expanded&&o._.exists(e.childStore)){var n=e.childStore;if(n.isDisplayIndexInStore(t))return n.getRowBounds(t)}else if(e.master&&e.expanded&&o._.exists(e.detailNode)&&e.detailNode.rowIndex===t)return r(e.detailNode)},t.prototype.getIndexAtPixel=function(e,t){if(e.isPixelInRange(t))return e.rowIndex;var r=e.master&&e.expanded,n=e.detailNode;if(r&&n&&n.isPixelInRange(t))return e.detailNode.rowIndex;if(e.group&&e.expanded&&o._.exists(e.childStore)){var i=e.childStore;if(i.isPixelInRange(t))return i.getRowIndexAtPixel(t)}return null},t.prototype.createNodeIdPrefix=function(e){for(var t=[],o=e;o&&o.level>=0;)t.push(o.key),o=o.parent;if(t.length>0)return t.reverse().join("-")},t.prototype.checkOpenByDefault=function(e){if(e.isExpandable()){var t=this.gridOptionsWrapper.getIsServerSideGroupOpenByDefaultFunc();if(t)t({data:e.data,rowNode:e})&&window.setTimeout((function(){return e.setExpanded(!0)}),0)}},u([o.Autowired("valueService")],t.prototype,"valueService",void 0),u([o.Autowired("columnModel")],t.prototype,"columnModel",void 0),u([o.Autowired("ssrmNodeManager")],t.prototype,"nodeManager",void 0),u([o.Autowired("beans")],t.prototype,"beans",void 0),u([o.PostConstruct],t.prototype,"postConstruct",null),t=u([o.Bean("ssrmBlockUtils")],t)}(o.BeanStub),h=function(e,t,o,r){var n,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,o,s):n(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},f=function(){function e(){this.rowNodes={}}return e.prototype.addRowNode=function(e){var t=e.id;this.rowNodes[t]&&(console.warn("AG Grid: Duplicate node id "+e.id+". Row ID's are provided via the getRowId() callback. Please modify the getRowId() callback code to provide unique row id values."),console.warn("first instance",this.rowNodes[t].data),console.warn("second instance",e.data)),this.rowNodes[t]=e},e.prototype.removeNode=function(e){var t=e.id;this.rowNodes[t]&&(this.rowNodes[t]=void 0)},e.prototype.clear=function(){this.rowNodes={}},h([o.PreDestroy],e.prototype,"clear",null),e=h([o.Bean("ssrmNodeManager")],e)}(),y=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),g=function(e,t,o,r){var n,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,o,s):n(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.asyncTransactions=[],t}return y(t,e),t.prototype.postConstruct=function(){this.gridOptionsWrapper.isRowModelServerSide()},t.prototype.applyTransactionAsync=function(e,t){null==this.asyncTransactionsTimeout&&this.scheduleExecuteAsync(),this.asyncTransactions.push({transaction:e,callback:t})},t.prototype.scheduleExecuteAsync=function(){var e=this,t=this.gridOptionsWrapper.getAsyncTransactionWaitMillis();this.asyncTransactionsTimeout=window.setTimeout((function(){e.executeAsyncTransactions()}),t)},t.prototype.executeAsyncTransactions=function(){var e=this;if(this.asyncTransactions){var t=[],r=[],n=[],i=!1;if(this.asyncTransactions.forEach((function(s){var a;e.serverSideRowModel.executeOnStore(s.transaction.route,(function(e){a=e.applyTransaction(s.transaction)})),null==a&&(a={status:o.ServerSideTransactionResultStatus.StoreNotFound}),r.push(a),a.status==o.ServerSideTransactionResultStatus.StoreLoading?n.push(s):(s.callback&&t.push((function(){return s.callback(a)})),a.status===o.ServerSideTransactionResultStatus.Applied&&(i=!0))})),t.length>0&&window.setTimeout((function(){t.forEach((function(e){return e()}))}),0),this.asyncTransactionsTimeout=void 0,this.asyncTransactions=n,i&&(this.valueCache.onDataChanged(),this.eventService.dispatchEvent({type:o.Events.EVENT_STORE_UPDATED})),r.length>0){var s={api:this.gridOptionsWrapper.getApi(),columnApi:this.gridOptionsWrapper.getColumnApi(),type:o.Events.EVENT_ASYNC_TRANSACTIONS_FLUSHED,results:r};this.eventService.dispatchEvent(s)}}},t.prototype.flushAsyncTransactions=function(){null!=this.asyncTransactionsTimeout&&clearTimeout(this.asyncTransactionsTimeout),this.executeAsyncTransactions()},t.prototype.applyTransaction=function(e){var t;return this.serverSideRowModel.executeOnStore(e.route,(function(o){t=o.applyTransaction(e)})),t?(this.valueCache.onDataChanged(),this.eventService.dispatchEvent({type:o.Events.EVENT_STORE_UPDATED}),t):{status:o.ServerSideTransactionResultStatus.StoreNotFound}},g([o.Autowired("rowNodeBlockLoader")],t.prototype,"rowNodeBlockLoader",void 0),g([o.Autowired("valueCache")],t.prototype,"valueCache",void 0),g([o.Autowired("rowModel")],t.prototype,"serverSideRowModel",void 0),g([o.PostConstruct],t.prototype,"postConstruct",null),t=g([o.Bean("ssrmTransactionManager")],t)}(o.BeanStub),w=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),S=function(e,t,o,r){var n,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,o,s):n(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},R=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return w(t,e),t.prototype.postConstruct=function(){this.gridOptionsWrapper.isRowModelServerSide()&&this.addManagedListener(this.eventService,o.Events.EVENT_ROW_GROUP_OPENED,this.onRowGroupOpened.bind(this))},t.prototype.onRowGroupOpened=function(e){var t=e.node;if(t.expanded){if(t.master)this.createDetailNode(t);else if(o._.missing(t.childStore)){var r=this.serverSideRowModel.getParams();t.childStore=this.createBean(this.storeFactory.createStore(r,t))}}else this.gridOptionsWrapper.isPurgeClosedRowNodes()&&o._.exists(t.childStore)&&(t.childStore=this.destroyBean(t.childStore));var n={type:o.Events.EVENT_STORE_UPDATED};this.eventService.dispatchEvent(n)},t.prototype.createDetailNode=function(e){if(o._.exists(e.detailNode))return e.detailNode;var t=new o.RowNode(this.beans);t.detail=!0,t.selectable=!1,t.parent=e,o._.exists(e.id)&&(t.id="detail_"+e.id),t.data=e.data,t.level=e.level+1;var r=this.gridOptionsWrapper.getRowHeightForNode(t).height;return t.rowHeight=r||200,e.detailNode=t,t},S([o.Autowired("rowModel")],t.prototype,"serverSideRowModel",void 0),S([o.Autowired("ssrmStoreFactory")],t.prototype,"storeFactory",void 0),S([o.Autowired("beans")],t.prototype,"beans",void 0),S([o.PostConstruct],t.prototype,"postConstruct",null),t=S([o.Bean("ssrmExpandListener")],t)}(o.BeanStub),N=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),I=function(e,t,o,r){var n,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,o,s):n(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return N(t,e),t.prototype.postConstruct=function(){this.gridOptionsWrapper.isRowModelServerSide()&&this.addManagedListener(this.eventService,o.Events.EVENT_SORT_CHANGED,this.onSortChanged.bind(this))},t.prototype.extractSortModel=function(){var e=this.sortController.getSortModel();return this.gridOptionsWrapper.isTreeData()||(this.replaceAutoGroupColumnWithActualRowGroupColumns(e),this.removeMultiColumnPrefixOnColumnIds(e)),e},t.prototype.removeMultiColumnPrefixOnColumnIds=function(e){if(this.gridOptionsWrapper.isGroupMultiAutoColumn())for(var t=o.Constants.GROUP_AUTO_COLUMN_ID+"-",r=0;r<e.length;++r)e[r].colId.indexOf(t)>-1&&(e[r].colId=e[r].colId.substr(t.length))},t.prototype.replaceAutoGroupColumnWithActualRowGroupColumns=function(e){var t=e.find((function(e){return e.colId==o.Constants.GROUP_AUTO_COLUMN_ID}));if(t){var r=e.indexOf(t);o._.removeFromArray(e,t);var n=this.columnModel.getRowGroupColumns().filter((function(t){return 0==e.filter((function(e){return e.colId===t.getColId()})).length})).map((function(e){return{colId:e.getId(),sort:t.sort}}));o._.insertArrayIntoArray(e,n,r)}},t.prototype.onSortChanged=function(){var e=this.serverSideRowModel.getParams();if(e){var t=this.extractSortModel(),o=e.sortModel,r=this.findChangedColumnsInSort(t,o),n={valueColChanged:this.listenerUtils.isSortingWithValueColumn(r),secondaryColChanged:this.listenerUtils.isSortingWithSecondaryColumn(r),changedColumns:r};this.serverSideRowModel.refreshAfterSort(t,n)}},t.prototype.findChangedColumnsInSort=function(e,t){var o=[];[e,t].forEach((function(e){if(e){var t=e.map((function(e){return e.colId}));o=o.concat(t)}}));return o.filter((function(o){var r=t.find((function(e){return e.colId===o})),n=e.find((function(e){return e.colId===o}));return function(e,t){return(e?e.sort:null)!==(t?t.sort:null)}(r,n)||function(o,r){return(o?t.indexOf(o):-1)!==(r?e.indexOf(r):-1)}(r,n)}))},I([o.Autowired("sortController")],t.prototype,"sortController",void 0),I([o.Autowired("columnModel")],t.prototype,"columnModel",void 0),I([o.Autowired("rowModel")],t.prototype,"serverSideRowModel",void 0),I([o.Autowired("ssrmListenerUtils")],t.prototype,"listenerUtils",void 0),I([o.PostConstruct],t.prototype,"postConstruct",null),t=I([o.Bean("ssrmSortService")],t)}(o.BeanStub),x=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),A=function(e,t,o,r){var n,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,o,s):n(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return x(t,e),t.prototype.postConstruct=function(){this.gridOptionsWrapper.isRowModelServerSide()&&this.addManagedListener(this.eventService,o.Events.EVENT_FILTER_CHANGED,this.onFilterChanged.bind(this))},t.prototype.onFilterChanged=function(){var e=this.serverSideRowModel.getParams();if(e){var t=this.filterManager.getFilterModel(),o=e?e.filterModel:{},r=this.findChangedColumns(t,o),n={valueColChanged:this.listenerUtils.isSortingWithValueColumn(r),secondaryColChanged:this.listenerUtils.isSortingWithSecondaryColumn(r),changedColumns:r};this.serverSideRowModel.refreshAfterFilter(t,n)}},t.prototype.findChangedColumns=function(e,t){var o={};Object.keys(e).forEach((function(e){return o[e]=!0})),Object.keys(t).forEach((function(e){return o[e]=!0}));var r=[];return Object.keys(o).forEach((function(o){JSON.stringify(e[o])!=JSON.stringify(t[o])&&r.push(o)})),r},A([o.Autowired("rowModel")],t.prototype,"serverSideRowModel",void 0),A([o.Autowired("filterManager")],t.prototype,"filterManager",void 0),A([o.Autowired("ssrmListenerUtils")],t.prototype,"listenerUtils",void 0),A([o.PostConstruct],t.prototype,"postConstruct",null),t=A([o.Bean("ssrmFilterListener")],t)}(o.BeanStub),O=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),E=function(e,t,o,r){var n,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,o,s):n(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},k=function(e,t){return function(o,r){t(o,r,e)}},D=function(e){var t="function"==typeof Symbol&&Symbol.iterator,o=t&&e[t],r=0;if(o)return o.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},P=function(e){function t(t,o,r,n,i){var s=e.call(this,t)||this;return s.ssrmParams=r,s.storeParams=n,s.parentRowNode=o,s.startRow=t*n.cacheBlockSize,s.parentStore=i,s.level=o.level+1,s.groupLevel=r.rowGroupCols?s.level<r.rowGroupCols.length:void 0,s.leafGroup=!!r.rowGroupCols&&s.level===r.rowGroupCols.length-1,s}return O(t,e),t.prototype.postConstruct=function(){if(this.usingTreeData=this.gridOptionsWrapper.isTreeData(),!this.usingTreeData&&this.groupLevel){var e=this.ssrmParams.rowGroupCols[this.level];this.groupField=e.field,this.rowGroupColumn=this.columnModel.getRowGroupColumns()[this.level]}this.nodeIdPrefix=this.blockUtils.createNodeIdPrefix(this.parentRowNode),this.setData([])},t.prototype.isDisplayIndexInBlock=function(e){return e>=this.displayIndexStart&&e<this.displayIndexEnd},t.prototype.isBlockBefore=function(e){return e>=this.displayIndexEnd},t.prototype.getDisplayIndexStart=function(){return this.displayIndexStart},t.prototype.getDisplayIndexEnd=function(){return this.displayIndexEnd},t.prototype.getBlockHeightPx=function(){return this.blockHeightPx},t.prototype.getBlockTopPx=function(){return this.blockTopPx},t.prototype.isGroupLevel=function(){return this.groupLevel},t.prototype.getGroupField=function(){return this.groupField},t.prototype.prefixId=function(e){return null!=this.nodeIdPrefix?this.nodeIdPrefix+"-"+e:e.toString()},t.prototype.getBlockStateJson=function(){return{id:this.prefixId(this.getId()),state:{blockNumber:this.getId(),startRow:this.startRow,endRow:this.startRow+this.storeParams.cacheBlockSize,pageStatus:this.getState()}}},t.prototype.isAnyNodeOpen=function(){return this.rowNodes.filter((function(e){return e.expanded})).length>0},t.prototype.forEachNode=function(e,t,r,n){void 0===t&&(t=new o.NumberSequence),this.rowNodes.forEach((function(o){if(e(o,t.next()),r&&o.childStore){var i=o.childStore;n?i.forEachNodeDeepAfterFilterAndSort(e,t):i.forEachNodeDeep(e,t)}}))},t.prototype.forEachNodeDeep=function(e,t){this.forEachNode(e,t,!0,!1)},t.prototype.forEachNodeAfterFilterAndSort=function(e,t){this.forEachNode(e,t,!0,!0)},t.prototype.forEachNodeShallow=function(e,t){this.forEachNode(e,t,!1,!1)},t.prototype.getLastAccessed=function(){return this.lastAccessed},t.prototype.getRowUsingLocalIndex=function(e){return this.rowNodes[e-this.startRow]},t.prototype.touchLastAccessed=function(){this.lastAccessed=this.ssrmParams.lastAccessedSequence.next()},t.prototype.processServerFail=function(){this.parentStore.onBlockLoadFailed(this)},t.prototype.retryLoads=function(){this.getState()===o.RowNodeBlock.STATE_FAILED&&(this.setStateWaitingToLoad(),this.rowNodeBlockLoader.checkBlockToLoad(),this.setData()),this.forEachNodeShallow((function(e){e.childStore&&e.childStore.retryLoads()}))},t.prototype.processServerResult=function(e){this.parentStore.onBlockLoaded(this,e)},t.prototype.setData=function(e,t){var o=this;void 0===e&&(e=[]),void 0===t&&(t=!1),this.destroyRowNodes();for(var r=this.parentStore.getRowCount(),n=this.getId()*this.storeParams.cacheBlockSize,i=Math.min(n+this.storeParams.cacheBlockSize,r)-n,s=this.columnModel.getAllDisplayedAutoHeightCols().length>0?this.parentStore.getCachedBlockHeight(this.getId()):void 0,a=s?Math.round(s/i):void 0,l=function(r){var n=r<e.length,i=function(i){var s=null!=i?i:o.blockUtils.createRowNode({field:o.groupField,group:o.groupLevel,leafGroup:o.leafGroup,level:o.level,parent:o.parentRowNode,rowGroupColumn:o.rowGroupColumn,rowHeight:a});if(n){var l=e[r];if(i)o.blockUtils.updateDataIntoRowNode(s,l);else{var d=o.prefixId(o.startRow+r);o.blockUtils.setDataIntoRowNode(s,l,d,a),o.blockUtils.checkOpenByDefault(s)}o.parentStore.removeDuplicateNode(s.id),o.nodeManager.addRowNode(s),o.allNodesMap[s.id]=s}return t&&(s.failedLoad=!0),s},s=d.gridOptionsWrapper.getRowIdFunc(),l=void 0;if(s&&n){var c=e[r],u=d.parentRowNode.getGroupKeys(),p=s({data:c,level:d.level,parentKeys:u.length>0?u:void 0});l=i(d.parentStore.retrieveNodeFromCache(p))}l||(l=i()),d.rowNodes.push(l)},d=this,c=0;c<i;c++)l(c)},t.prototype.removeDuplicateNode=function(e){if(this.getState()!=o.RowNodeBlock.STATE_LOADED){var t=this.allNodesMap[e];if(t){this.blockUtils.destroyRowNode(t);var r=this.rowNodes.indexOf(t),n=this.blockUtils.createRowNode({field:this.groupField,group:this.groupLevel,leafGroup:this.leafGroup,level:this.level,parent:this.parentRowNode,rowGroupColumn:this.rowGroupColumn});this.rowNodes[r]=n}}},t.prototype.refresh=function(){this.getState()!==o.RowNodeBlock.STATE_WAITING_TO_LOAD&&this.setStateWaitingToLoad()},t.prototype.destroyRowNodes=function(){var e,t=this;null===(e=this.rowNodes)||void 0===e||e.forEach((function(e){var o=t.parentStore.isNodeCached(e.id);t.blockUtils.destroyRowNode(e,o)})),this.rowNodes=[],this.allNodesMap={}},t.prototype.setBeans=function(e){this.logger=e.create("ServerSideBlock")},t.prototype.getRowUsingDisplayIndex=function(e){return this.touchLastAccessed(),this.blockUtils.binarySearchForDisplayIndex(e,this.rowNodes)},t.prototype.loadFromDatasource=function(){this.storeUtils.loadFromDatasource({startRow:this.startRow,endRow:this.startRow+this.storeParams.cacheBlockSize,parentBlock:this,parentNode:this.parentRowNode,storeParams:this.ssrmParams,successCallback:this.pageLoaded.bind(this,this.getVersion()),success:this.success.bind(this,this.getVersion()),failCallback:this.pageLoadFailed.bind(this,this.getVersion()),fail:this.pageLoadFailed.bind(this,this.getVersion())})},t.prototype.isPixelInRange=function(e){return e>=this.blockTopPx&&e<this.blockTopPx+this.blockHeightPx},t.prototype.getRowBounds=function(e){var t,o,r;this.touchLastAccessed();try{for(var n=D(this.rowNodes),i=n.next();!i.done;i=n.next()){var s=i.value;if(null!=(r=this.blockUtils.extractRowBounds(s,e)))break}}catch(e){t={error:e}}finally{try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(t)throw t.error}}return r},t.prototype.getRowIndexAtPixel=function(e){var t,o;this.touchLastAccessed();var r=null;try{for(var n=D(this.rowNodes),i=n.next();!i.done;i=n.next()){var s=i.value;if(null!=(r=this.blockUtils.getIndexAtPixel(s,e)))break}}catch(e){t={error:e}}finally{try{i&&!i.done&&(o=n.return)&&o.call(n)}finally{if(t)throw t.error}}return r},t.prototype.clearDisplayIndexes=function(){var e=this;this.displayIndexEnd=void 0,this.displayIndexStart=void 0,this.rowNodes.forEach((function(t){return e.blockUtils.clearDisplayIndex(t)}))},t.prototype.setDisplayIndexes=function(e,t){var o=this;this.displayIndexStart=e.peek(),this.blockTopPx=t.value,this.rowNodes.forEach((function(r){return o.blockUtils.setDisplayIndex(r,e,t)})),this.displayIndexEnd=e.peek(),this.blockHeightPx=t.value-this.blockTopPx},E([o.Autowired("columnModel")],t.prototype,"columnModel",void 0),E([o.Autowired("ssrmStoreUtils")],t.prototype,"storeUtils",void 0),E([o.Autowired("ssrmBlockUtils")],t.prototype,"blockUtils",void 0),E([o.Autowired("ssrmNodeManager")],t.prototype,"nodeManager",void 0),E([o.Autowired("rowNodeBlockLoader")],t.prototype,"rowNodeBlockLoader",void 0),E([o.PostConstruct],t.prototype,"postConstruct",null),E([o.PreDestroy],t.prototype,"destroyRowNodes",null),E([k(0,o.Qualifier("loggerFactory"))],t.prototype,"setBeans",null),t}(o.RowNodeBlock),b=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),_=function(e,t,o,r){var n,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,o,s):n(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},T=function(e,t){return function(o,r){t(o,r,e)}};!function(e){e[e.FOUND=0]="FOUND",e[e.CONTINUE_FIND=1]="CONTINUE_FIND",e[e.BREAK_FIND=2]="BREAK_FIND"}(t||(t={}));var B=function(e){function r(t,o,n){var i=e.call(this)||this;return i.blocks={},i.blockHeights={},i.lastRowIndexKnown=!1,i.displayIndexStart=0,i.displayIndexEnd=0,i.cacheTopPixel=0,i.info={},i.refreshedNodeCache={},i.ssrmParams=t,i.storeParams=o,i.parentRowNode=n,i.rowCount=r.INITIAL_ROW_COUNT,i}return b(r,e),r.prototype.postConstruct=function(){this.defaultRowHeight=this.gridOptionsWrapper.getRowHeightAsNumber()},r.prototype.destroyAllBlocks=function(){var e=this;this.getBlocksInOrder().forEach((function(t){return e.destroyBlock(t)})),this.blockUtils.destroyRowNodes(Object.values(this.refreshedNodeCache))},r.prototype.setBeans=function(e){this.logger=e.create("ServerSideCache")},r.prototype.getRowCount=function(){return this.rowCount},r.prototype.isLastRowIndexKnown=function(){return this.lastRowIndexKnown},r.prototype.retryLoads=function(){this.getBlocksInOrder().forEach((function(e){return e.retryLoads()}))},r.prototype.onBlockLoadFailed=function(e){e.setData([],!0),this.fireCacheUpdatedEvent()},r.prototype.onBlockLoaded=function(e,t){this.logger.log("onPageLoaded: page = "+e.getId()+", lastRow = "+t.rowCount);var r=t.storeInfo||t.groupLevelInfo;if(r&&Object.assign(this.info,r),!t.rowData){o._.doOnce((function(){return console.warn('AG Grid: "params.rowData" is missing from Server-Side Row Model success() callback. Please use the "rowData" attribute. If no data is returned, set an empty list.',t)}),"InfiniteStore.noData")}var n=null!=t.rowCount&&t.rowCount>=0?t.rowCount:void 0;this.isAlive()&&(this.checkRowCount(e,n),e.setData(t.rowData),this.destroyAllBlocksPastVirtualRowCount(),this.fireCacheUpdatedEvent())},r.prototype.purgeBlocksIfNeeded=function(e){var t=this,o=this.getBlocksInOrder().filter((function(t){return t!=e}));o.sort((function(e,t){return t.getLastAccessed()-e.getLastAccessed()}));var n=this.storeParams.maxBlocksInCache>0,i=n?this.storeParams.maxBlocksInCache-1:null,s=r.MAX_EMPTY_BLOCKS_TO_KEEP-1;o.forEach((function(e,o){if(e.getState()===P.STATE_WAITING_TO_LOAD&&o>=s||!!n&&o>=i){if(e.isAnyNodeOpen())return;if(t.isBlockCurrentlyDisplayed(e))return;if(t.isBlockFocused(e))return;t.destroyBlock(e)}}))},r.prototype.isBlockFocused=function(e){var t=this.focusService.getFocusCellToUseAfterRefresh();if(!t)return!1;if(null!=t.rowPinned)return!1;var o=e.getDisplayIndexStart(),r=e.getDisplayIndexEnd();return null!=r&&null!=o&&(t.rowIndex>=o&&t.rowIndex<r)},r.prototype.isBlockCurrentlyDisplayed=function(e){var t=e.getDisplayIndexStart(),o=e.getDisplayIndexEnd()-1;return this.rowRenderer.isRangeInRenderedViewport(t,o)},r.prototype.removeDuplicateNode=function(e){this.getBlocksInOrder().forEach((function(t){return t.removeDuplicateNode(e)}))},r.prototype.checkRowCount=function(e,t){if("number"==typeof t&&t>=0)this.rowCount=t,this.lastRowIndexKnown=!0;else if(!this.lastRowIndexKnown){var o=(e.getId()+1)*this.storeParams.cacheBlockSize+r.OVERFLOW_SIZE;this.rowCount<o&&(this.rowCount=o)}},r.prototype.forEachNodeDeep=function(e,t){void 0===t&&(t=new o.NumberSequence),this.getBlocksInOrder().forEach((function(o){return o.forEachNodeDeep(e,t)}))},r.prototype.forEachNodeDeepAfterFilterAndSort=function(e,t){void 0===t&&(t=new o.NumberSequence),this.getBlocksInOrder().forEach((function(o){return o.forEachNodeAfterFilterAndSort(e,t)}))},r.prototype.getBlocksInOrder=function(){return o._.getAllValuesInObject(this.blocks).sort((function(e,t){return e.getId()-t.getId()}))},r.prototype.destroyBlock=function(e){delete this.blocks[e.getId()],this.destroyBean(e),this.rowNodeBlockLoader.removeBlock(e)},r.prototype.fireCacheUpdatedEvent=function(){var e={type:o.Events.EVENT_STORE_UPDATED};this.eventService.dispatchEvent(e)},r.prototype.destroyAllBlocksPastVirtualRowCount=function(){var e=this,t=[];this.getBlocksInOrder().forEach((function(o){o.getId()*e.storeParams.cacheBlockSize>=e.rowCount&&t.push(o)})),t.length>0&&t.forEach((function(t){return e.destroyBlock(t)}))},r.prototype.refreshStore=function(e){0==this.getRowCount()||e?this.resetStore():this.refreshBlocks(),this.fireCacheUpdatedEvent()},r.prototype.isNodeCached=function(e){return!!this.refreshedNodeCache[e]},r.prototype.retrieveNodeFromCache=function(e){var t=this.refreshedNodeCache[e];return t&&delete this.refreshedNodeCache[e],t},r.prototype.buildRowNodeCache=function(){var e={};this.getBlocksInOrder().forEach((function(t){t.rowNodes.forEach((function(t){t.group&&(e[t.id]=t)}))})),this.refreshedNodeCache=e},r.prototype.refreshBlocks=function(){this.buildRowNodeCache(),this.getBlocksInOrder().forEach((function(e){e.refresh()})),this.lastRowIndexKnown=!1,this.rowNodeBlockLoader.checkBlockToLoad()},r.prototype.resetStore=function(){this.destroyAllBlocks(),this.lastRowIndexKnown=!1,(this.columnModel.isAutoRowHeightActive()||0===this.rowCount)&&(this.rowCount=r.INITIAL_ROW_COUNT)},r.prototype.getRowNodesInRange=function(e,t){var r=[],n=-1,i=!1;o._.missing(e)&&(i=!0);var s=!1;return this.getBlocksInOrder().forEach((function(o){s||(i&&n+1!==o.getId()?s=!0:(n=o.getId(),o.forEachNodeShallow((function(o){var n=o===e||o===t;(i||n)&&r.push(o),n&&(i=!i)}))))})),s||i?[]:r},r.prototype.findBlockAndExecute=function(e,o,r){var n,i=!1,s=!1,a=null;return this.getBlocksInOrder().forEach((function(r){if(!i&&!s){var l=e(r);l==t.FOUND?(n=o(r),i=!0):l==t.CONTINUE_FIND?a=r:l==t.BREAK_FIND&&(s=!0)}})),i||(n=r(a)),n},r.prototype.getRowBounds=function(e){var o=this;return this.findBlockAndExecute((function(o){return o.isDisplayIndexInBlock(e)?t.FOUND:o.isBlockBefore(e)?t.CONTINUE_FIND:t.BREAK_FIND}),(function(t){return t.getRowBounds(e)}),(function(t){var r,n;null!==t?(r=t.getBlockTopPx()+t.getBlockHeightPx(),n=t.getDisplayIndexEnd()):(r=o.cacheTopPixel,n=o.displayIndexStart);var i=e-n;return{rowHeight:o.defaultRowHeight,rowTop:r+i*o.defaultRowHeight}}))},r.prototype.getRowIndexAtPixel=function(e){var o=this,r=this.findBlockAndExecute((function(o){return o.isPixelInRange(e)?t.FOUND:o.getBlockTopPx()<e?t.CONTINUE_FIND:t.BREAK_FIND}),(function(t){return t.getRowIndexAtPixel(e)}),(function(t){var r,n;t?(r=t.getBlockTopPx()+t.getBlockHeightPx(),n=t.getDisplayIndexEnd()):(r=o.cacheTopPixel,n=o.displayIndexStart);for(var i=o.storeParams.cacheBlockSize,s=o.defaultRowHeight*i,a=t?t.getId()+1:0,l=function(t){var n=o.getCachedBlockHeight(t),i=null!=n?n:s;return{height:i,pixelInBlock:e<=i+r}},d=l(a);!d.pixelInBlock;)r+=d.height,n+=i,d=l(++a);var c=e-r,u=d.height/i;return n+(0|Math.floor(c/u))})),n=this.getDisplayIndexEnd()-1;return r=Math.min(r,n)},r.prototype.clearDisplayIndexes=function(){this.displayIndexStart=void 0,this.displayIndexEnd=void 0,this.getBlocksInOrder().forEach((function(e){return e.clearDisplayIndexes()}))},r.prototype.setDisplayIndexes=function(e,t){var r=this;this.displayIndexStart=e.peek(),this.cacheTopPixel=t.value;var n=-1,i=this.storeParams.cacheBlockSize;this.getBlocksInOrder().forEach((function(s){var a=s.getId(),l=a-n-1,d=l*i;d>0&&e.skip(d);for(var c=1;c<=l;c++){var u=a-c;o._.exists(r.blockHeights[u])?t.value+=r.blockHeights[u]:t.value+=i*r.defaultRowHeight}n=a,s.setDisplayIndexes(e,t),r.blockHeights[a]=s.getBlockHeightPx()}));var s=(n+1)*i-1,a=this.getRowCount()-s-1;a>0&&(e.skip(a),t.value+=a*this.defaultRowHeight),this.displayIndexEnd=e.peek(),this.cacheHeightPixels=t.value-this.cacheTopPixel},r.prototype.getRowUsingDisplayIndex=function(e,r){var n=this;if(void 0===r&&(r=!1),this.isDisplayIndexInStore(e)){return this.findBlockAndExecute((function(o){return o.isDisplayIndexInBlock(e)?t.FOUND:o.isBlockBefore(e)?t.CONTINUE_FIND:t.BREAK_FIND}),(function(t){return t.getRowUsingDisplayIndex(e)}),(function(t){if(!r){var i,s,a,l=n.storeParams.cacheBlockSize;if(t){i=t.getId()+1,s=t.getDisplayIndexEnd(),a=t.getBlockHeightPx()+t.getBlockTopPx();for(;!(e>=s&&e<s+l);){s+=l;var d=n.blockHeights[i];o._.exists(d)?a+=d:a+=n.defaultRowHeight*l,i++}}else{var c=e-n.displayIndexStart;i=Math.floor(c/l),s=n.displayIndexStart+i*l,a=n.cacheTopPixel+i*l*n.defaultRowHeight}return n.logger.log("block missing, rowIndex = "+e+", creating #"+i+", displayIndexStart = "+s),n.createBlock(i,s,{value:a}).getRowUsingDisplayIndex(e)}}))}},r.prototype.getTopLevelRowDisplayedIndex=function(e){var o=this.storeParams.cacheBlockSize,r=Math.floor(e/o);return this.findBlockAndExecute((function(e){return e.getId()===r?t.FOUND:e.getId()<r?t.CONTINUE_FIND:t.BREAK_FIND}),(function(t){return t.getRowUsingLocalIndex(e).rowIndex}),(function(t){if(!t)return e;var r,n=o*(t.getId()+1)-1,i=t.getRowUsingLocalIndex(n);i.expanded&&i.childStore?r=i.childStore.getDisplayIndexEnd()-1:r=i.expanded&&i.detailNode?i.detailNode.rowIndex:i.rowIndex;return r+(e-n)}))},r.prototype.addStoreStates=function(e){e.push({infiniteScroll:!0,route:this.parentRowNode.getGroupKeys(),rowCount:this.rowCount,lastRowIndexKnown:this.lastRowIndexKnown,info:this.info,maxBlocksInCache:this.storeParams.maxBlocksInCache,cacheBlockSize:this.storeParams.cacheBlockSize}),this.forEachChildStoreShallow((function(t){return t.addStoreStates(e)}))},r.prototype.getCachedBlockHeight=function(e){return this.blockHeights[e]},r.prototype.createBlock=function(e,t,r){var n=this.createBean(new P(e,this.parentRowNode,this.ssrmParams,this.storeParams,this));return n.setDisplayIndexes(new o.NumberSequence(t),r),this.blocks[n.getId()]=n,this.purgeBlocksIfNeeded(n),this.rowNodeBlockLoader.addBlock(n),n},r.prototype.getDisplayIndexEnd=function(){return this.displayIndexEnd},r.prototype.isDisplayIndexInStore=function(e){return 0!==this.getRowCount()&&(e>=this.displayIndexStart&&e<this.displayIndexEnd)},r.prototype.applyTransaction=function(e){return{status:o.ServerSideTransactionResultStatus.StoreWrongType}},r.prototype.getChildStore=function(e){var t=this;return this.storeUtils.getChildStore(e,this,(function(e){var r=null;return t.getBlocksInOrder().forEach((function(t){t.forEachNodeShallow((function(t){t.key==e&&(r=t)}),new o.NumberSequence)})),r}))},r.prototype.isPixelInRange=function(e){return 0!==this.getRowCount()&&(e>=this.cacheTopPixel&&e<this.cacheTopPixel+this.cacheHeightPixels)},r.prototype.refreshAfterFilter=function(e){this.gridOptionsWrapper.isServerSideFilterAllLevels()||this.storeUtils.isServerRefreshNeeded(this.parentRowNode,this.ssrmParams.rowGroupCols,e)?this.resetStore():this.forEachChildStoreShallow((function(t){return t.refreshAfterFilter(e)}))},r.prototype.refreshAfterSort=function(e){this.gridOptionsWrapper.isServerSideSortAllLevels()||this.storeUtils.isServerRefreshNeeded(this.parentRowNode,this.ssrmParams.rowGroupCols,e)?this.resetStore():this.forEachChildStoreShallow((function(t){return t.refreshAfterSort(e)}))},r.prototype.forEachChildStoreShallow=function(e){this.getBlocksInOrder().forEach((function(t){if(t.isGroupLevel()){t.forEachNodeShallow((function(t){var o=t.childStore;o&&e(o)}),new o.NumberSequence)}}))},r.MAX_EMPTY_BLOCKS_TO_KEEP=2,r.INITIAL_ROW_COUNT=1,r.OVERFLOW_SIZE=1,_([o.Autowired("rowRenderer")],r.prototype,"rowRenderer",void 0),_([o.Autowired("rowNodeBlockLoader")],r.prototype,"rowNodeBlockLoader",void 0),_([o.Autowired("ssrmStoreUtils")],r.prototype,"storeUtils",void 0),_([o.Autowired("focusService")],r.prototype,"focusService",void 0),_([o.Autowired("columnModel")],r.prototype,"columnModel",void 0),_([o.Autowired("ssrmBlockUtils")],r.prototype,"blockUtils",void 0),_([o.PostConstruct],r.prototype,"postConstruct",null),_([o.PreDestroy],r.prototype,"destroyAllBlocks",null),_([T(0,o.Qualifier("loggerFactory"))],r.prototype,"setBeans",null),r}(o.BeanStub),M=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),L=function(e,t,o,r){var n,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,o,s):n(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},U=function(e){function t(t,r,n){var i=e.call(this,0)||this;return i.nodeIdSequence=new o.NumberSequence,i.info={},i.ssrmParams=t,i.parentRowNode=n,i.level=n.level+1,i.groupLevel=t.rowGroupCols?i.level<t.rowGroupCols.length:void 0,i.leafGroup=!!t.rowGroupCols&&i.level===t.rowGroupCols.length-1,i}return M(t,e),t.prototype.postConstruct=function(){var e=this;if(this.usingTreeData=this.gridOptionsWrapper.isTreeData(),this.nodeIdPrefix=this.blockUtils.createNodeIdPrefix(this.parentRowNode),!this.usingTreeData&&this.groupLevel){var t=this.ssrmParams.rowGroupCols[this.level];this.groupField=t.field,this.rowGroupColumn=this.columnModel.getRowGroupColumns()[this.level]}this.initialiseRowNodes(),this.rowNodeBlockLoader.addBlock(this),this.addDestroyFunc((function(){return e.rowNodeBlockLoader.removeBlock(e)}))},t.prototype.destroyRowNodes=function(){this.blockUtils.destroyRowNodes(this.allRowNodes),this.allRowNodes=[],this.nodesAfterSort=[],this.nodesAfterFilter=[],this.allNodesMap={}},t.prototype.initialiseRowNodes=function(e,t){void 0===e&&(e=1),void 0===t&&(t=!1),this.destroyRowNodes();for(var o=0;o<e;o++){var r=this.blockUtils.createRowNode({field:this.groupField,group:this.groupLevel,leafGroup:this.leafGroup,level:this.level,parent:this.parentRowNode,rowGroupColumn:this.rowGroupColumn});t&&(r.failedLoad=!0),this.allRowNodes.push(r),this.nodesAfterFilter.push(r),this.nodesAfterSort.push(r)}},t.prototype.getBlockStateJson=function(){return{id:this.nodeIdPrefix?this.nodeIdPrefix:"",state:this.getState()}},t.prototype.loadFromDatasource=function(){this.storeUtils.loadFromDatasource({startRow:void 0,endRow:void 0,parentBlock:this,parentNode:this.parentRowNode,storeParams:this.ssrmParams,successCallback:this.pageLoaded.bind(this,this.getVersion()),success:this.success.bind(this,this.getVersion()),failCallback:this.pageLoadFailed.bind(this,this.getVersion()),fail:this.pageLoadFailed.bind(this,this.getVersion())})},t.prototype.getStartRow=function(){return 0},t.prototype.getEndRow=function(){return this.nodesAfterSort.length},t.prototype.createDataNode=function(e,t){var r=this.blockUtils.createRowNode({field:this.groupField,group:this.groupLevel,leafGroup:this.leafGroup,level:this.level,parent:this.parentRowNode,rowGroupColumn:this.rowGroupColumn});null!=t?o._.insertIntoArray(this.allRowNodes,r,t):this.allRowNodes.push(r);var n=this.prefixId(this.nodeIdSequence.next());return this.blockUtils.setDataIntoRowNode(r,e,n,void 0),this.nodeManager.addRowNode(r),this.blockUtils.checkOpenByDefault(r),this.allNodesMap[r.id]=r,r},t.prototype.prefixId=function(e){return this.nodeIdPrefix?this.nodeIdPrefix+"-"+e:e.toString()},t.prototype.processServerFail=function(){this.initialiseRowNodes(1,!0),this.fireStoreUpdatedEvent(),this.flushAsyncTransactions()},t.prototype.processServerResult=function(e){if(this.isAlive()){var t=e.storeInfo||e.groupLevelInfo;t&&Object.assign(this.info,t);var r=this.allRowNodes.length>0?this.allNodesMap:void 0;if(this.allRowNodes=[],this.nodesAfterSort=[],this.nodesAfterFilter=[],this.allNodesMap={},!e.rowData){o._.doOnce((function(){return console.warn('AG Grid: "params.data" is missing from Server-Side Row Model success() callback. Please use the "data" attribute. If no data is returned, set an empty list.',e)}),"FullStore.noData")}this.createOrRecycleNodes(r,e.rowData),r&&this.blockUtils.destroyRowNodes(o._.getAllValuesInObject(r)),this.filterAndSortNodes(),this.fireStoreUpdatedEvent(),this.flushAsyncTransactions()}},t.prototype.createOrRecycleNodes=function(e,t){var o=this;if(t){t.forEach((function(t){var r=function(t){if(e){var r=o.gridOptionsWrapper.getRowIdFunc();if(r){var n=o.parentRowNode.getGroupKeys(),i=o.level,s=r({data:t,parentKeys:n.length>0?n:void 0,level:i}),a=e[s];if(a)return delete e[s],a}}}(t);r?function(e,t){o.allNodesMap[e.id]=e,o.blockUtils.updateDataIntoRowNode(e,t),o.allRowNodes.push(e)}(r,t):o.createDataNode(t)}))}},t.prototype.flushAsyncTransactions=function(){var e=this;window.setTimeout((function(){return e.transactionManager.flushAsyncTransactions()}),0)},t.prototype.filterAndSortNodes=function(){this.filterRowNodes(),this.sortRowNodes()},t.prototype.sortRowNodes=function(){var e=this.gridOptionsWrapper.isServerSideSortAllLevels()||this.gridOptionsWrapper.isServerSideSortOnServer(),t=this.sortController.getSortOptions(),o=!t||0==t.length;this.nodesAfterSort=e||o?this.nodesAfterFilter:this.rowNodeSorter.doFullSort(this.nodesAfterFilter,t)},t.prototype.filterRowNodes=function(){var e=this,t=this.gridOptionsWrapper.isServerSideFilterAllLevels()||this.gridOptionsWrapper.isServerSideFilterOnServer(),o=this.groupLevel;this.nodesAfterFilter=t||o?this.allRowNodes:this.allRowNodes.filter((function(t){return e.filterManager.doesRowPassFilter({rowNode:t})}))},t.prototype.clearDisplayIndexes=function(){var e=this;this.displayIndexStart=void 0,this.displayIndexEnd=void 0,this.allRowNodes.forEach((function(t){return e.blockUtils.clearDisplayIndex(t)}))},t.prototype.getDisplayIndexEnd=function(){return this.displayIndexEnd},t.prototype.isDisplayIndexInStore=function(e){return 0!==this.getRowCount()&&(e>=this.displayIndexStart&&e<this.displayIndexEnd)},t.prototype.setDisplayIndexes=function(e,t){var o=this;this.displayIndexStart=e.peek(),this.topPx=t.value;var r={};this.nodesAfterSort.forEach((function(n){o.blockUtils.setDisplayIndex(n,e,t),r[n.id]=!0})),this.allRowNodes.forEach((function(e){r[e.id]||o.blockUtils.clearDisplayIndex(e)})),this.displayIndexEnd=e.peek(),this.heightPx=t.value-this.topPx},t.prototype.forEachNodeDeep=function(e,t){void 0===t&&(t=new o.NumberSequence),this.allRowNodes.forEach((function(o){e(o,t.next());var r=o.childStore;r&&r.forEachNodeDeep(e,t)}))},t.prototype.forEachNodeDeepAfterFilterAndSort=function(e,t){void 0===t&&(t=new o.NumberSequence),this.nodesAfterSort.forEach((function(o){e(o,t.next());var r=o.childStore;r&&r.forEachNodeDeepAfterFilterAndSort(e,t)}))},t.prototype.getRowUsingDisplayIndex=function(e){if(this.isDisplayIndexInStore(e))return this.blockUtils.binarySearchForDisplayIndex(e,this.nodesAfterSort)},t.prototype.getRowBounds=function(e){for(var t=0;t<this.nodesAfterSort.length;t++){var o=this.nodesAfterSort[t],r=this.blockUtils.extractRowBounds(o,e);if(r)return r}return null},t.prototype.isPixelInRange=function(e){return e>=this.topPx&&e<this.topPx+this.heightPx},t.prototype.getRowIndexAtPixel=function(e){var t=this;if(e<=this.topPx)return this.nodesAfterSort[0].rowIndex;if(e>=this.topPx+this.heightPx){var o=this.nodesAfterSort[this.nodesAfterSort.length-1],r=o.rowTop+o.rowHeight;if(e>=r&&o.expanded){if(o.childStore&&o.childStore.getRowCount()>0)return o.childStore.getRowIndexAtPixel(e);if(o.detailNode)return o.detailNode.rowIndex}return o.rowIndex}var n=null;return this.nodesAfterSort.forEach((function(o){var r=t.blockUtils.getIndexAtPixel(o,e);null!=r&&(n=r)})),null==n?this.displayIndexEnd-1:n},t.prototype.getChildStore=function(e){var t=this;return this.storeUtils.getChildStore(e,this,(function(e){return t.allRowNodes.find((function(t){return t.key==e}))}))},t.prototype.forEachChildStoreShallow=function(e){this.allRowNodes.forEach((function(t){var o=t.childStore;o&&e(o)}))},t.prototype.refreshAfterFilter=function(e){var t=this.gridOptionsWrapper.isServerSideFilterOnServer(),o=this.storeUtils.isServerRefreshNeeded(this.parentRowNode,this.ssrmParams.rowGroupCols,e);if(this.gridOptionsWrapper.isServerSideFilterAllLevels()||t&&o)return this.refreshStore(!0),void this.sortRowNodes();this.filterRowNodes(),this.sortRowNodes(),this.forEachChildStoreShallow((function(t){return t.refreshAfterFilter(e)}))},t.prototype.refreshAfterSort=function(e){var t=this.gridOptionsWrapper.isServerSideSortOnServer(),o=this.storeUtils.isServerRefreshNeeded(this.parentRowNode,this.ssrmParams.rowGroupCols,e);if(this.gridOptionsWrapper.isServerSideSortAllLevels()||t&&o)return this.refreshStore(!0),void this.filterRowNodes();this.filterRowNodes(),this.sortRowNodes(),this.forEachChildStoreShallow((function(t){return t.refreshAfterSort(e)}))},t.prototype.applyTransaction=function(e){switch(this.getState()){case o.RowNodeBlock.STATE_FAILED:return{status:o.ServerSideTransactionResultStatus.StoreLoadingFailed};case o.RowNodeBlock.STATE_LOADING:return{status:o.ServerSideTransactionResultStatus.StoreLoading};case o.RowNodeBlock.STATE_WAITING_TO_LOAD:return{status:o.ServerSideTransactionResultStatus.StoreWaitingToLoad}}var t=this.gridOptionsWrapper.getIsApplyServerSideTransactionFunc();if(t&&!t({transaction:e,parentNode:this.parentRowNode,storeInfo:this.info,groupLevelInfo:this.info}))return{status:o.ServerSideTransactionResultStatus.Cancelled};var r={status:o.ServerSideTransactionResultStatus.Applied,remove:[],update:[],add:[]},n=[];return this.executeAdd(e,r),this.executeRemove(e,r,n),this.executeUpdate(e,r,n),this.filterAndSortNodes(),this.updateSelection(n),r},t.prototype.updateSelection=function(e){if(e.length>0){e.forEach((function(e){e.setSelected(!1,!1,!0)}));var t={type:o.Events.EVENT_SELECTION_CHANGED,api:this.gridOptionsWrapper.getApi(),columnApi:this.gridOptionsWrapper.getColumnApi()};this.eventService.dispatchEvent(t)}},t.prototype.executeAdd=function(e,t){var r=this,n=e.add,i=e.addIndex;o._.missingOrEmpty(n)||("number"==typeof i&&i>=0?n.reverse().forEach((function(e){var o=r.createDataNode(e,i);t.add.push(o)})):n.forEach((function(e){var o=r.createDataNode(e);t.add.push(o)})))},t.prototype.executeRemove=function(e,t,o){var r=this,n=e.remove;if(null!=n){var i={};n.forEach((function(e){var n=r.lookupRowNode(e);n&&(n.isSelected()&&o.push(n),n.clearRowTopAndRowIndex(),i[n.id]=!0,delete r.allNodesMap[n.id],t.remove.push(n),r.nodeManager.removeNode(n))})),this.allRowNodes=this.allRowNodes.filter((function(e){return!i[e.id]}))}},t.prototype.executeUpdate=function(e,t,o){var r=this,n=e.update;null!=n&&n.forEach((function(e){var n=r.lookupRowNode(e);n&&(n.updateData(e),!n.selectable&&n.isSelected()&&o.push(n),t.update.push(n))}))},t.prototype.lookupRowNode=function(e){var t,o=this.gridOptionsWrapper.getRowIdFunc();if(null!=o){var r=this.level,n=this.parentRowNode.getGroupKeys(),i=o({data:e,parentKeys:n.length>0?n:void 0,level:r});if(!(t=this.allNodesMap[i]))return console.error("AG Grid: could not find row id="+i+", data item was not found for this id"),null}else if(!(t=this.allRowNodes.find((function(t){return t.data===e}))))return console.error("AG Grid: could not find data item as object was not found",e),null;return t},t.prototype.addStoreStates=function(e){e.push({infiniteScroll:!1,route:this.parentRowNode.getGroupKeys(),rowCount:this.allRowNodes.length,info:this.info}),this.forEachChildStoreShallow((function(t){return t.addStoreStates(e)}))},t.prototype.refreshStore=function(e){if(e){var t=this.nodesAfterSort?this.nodesAfterSort.length:1;this.initialiseRowNodes(t)}this.scheduleLoad(),this.fireStoreUpdatedEvent()},t.prototype.retryLoads=function(){this.getState()===o.RowNodeBlock.STATE_FAILED&&(this.initialiseRowNodes(1),this.scheduleLoad()),this.forEachChildStoreShallow((function(e){return e.retryLoads()}))},t.prototype.scheduleLoad=function(){this.setStateWaitingToLoad(),this.rowNodeBlockLoader.checkBlockToLoad()},t.prototype.fireStoreUpdatedEvent=function(){var e={type:o.Events.EVENT_STORE_UPDATED};this.eventService.dispatchEvent(e)},t.prototype.getRowCount=function(){return this.nodesAfterSort.length},t.prototype.getTopLevelRowDisplayedIndex=function(e){return this.nodesAfterSort[e].rowIndex},t.prototype.isLastRowIndexKnown=function(){return this.getState()==o.RowNodeBlock.STATE_LOADED},t.prototype.getRowNodesInRange=function(e,t){var r=[],n=!1;return o._.missing(e)&&(n=!0),this.nodesAfterSort.forEach((function(o){var i=o===e||o===t;(n||i)&&r.push(o),i&&(n=!n)})),n?[]:r},L([o.Autowired("ssrmStoreUtils")],t.prototype,"storeUtils",void 0),L([o.Autowired("ssrmBlockUtils")],t.prototype,"blockUtils",void 0),L([o.Autowired("columnModel")],t.prototype,"columnModel",void 0),L([o.Autowired("rowNodeBlockLoader")],t.prototype,"rowNodeBlockLoader",void 0),L([o.Autowired("rowNodeSorter")],t.prototype,"rowNodeSorter",void 0),L([o.Autowired("sortController")],t.prototype,"sortController",void 0),L([o.Autowired("ssrmNodeManager")],t.prototype,"nodeManager",void 0),L([o.Autowired("filterManager")],t.prototype,"filterManager",void 0),L([o.Autowired("ssrmTransactionManager")],t.prototype,"transactionManager",void 0),L([o.PostConstruct],t.prototype,"postConstruct",null),L([o.PreDestroy],t.prototype,"destroyRowNodes",null),t}(o.RowNodeBlock),F=function(e,t,o,r){var n,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,o,s):n(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},G=function(){function e(){}return e.prototype.createStore=function(e,t){var o=this.getStoreParams(e,t);return new(o.infiniteScroll?B:U)(e,o,t)},e.prototype.getStoreParams=function(e,t){var o=this.getLevelSpecificParams(t),r=this.isInfiniteScroll(o);return{infiniteScroll:r,cacheBlockSize:this.getBlockSize(r,o),maxBlocksInCache:this.getMaxBlocksInCache(r,e,o)}},e.prototype.getMaxBlocksInCache=function(e,t,r){if(e){var n=r&&null!=r.maxBlocksInCache?r.maxBlocksInCache:this.gridOptionsWrapper.getMaxBlocksInCache();if(null!=n&&n>=0)if(t.dynamicRowHeight){o._.doOnce((function(){return console.warn("AG Grid: Server Side Row Model does not support Dynamic Row Height and Cache Purging. Either a) remove getRowHeight() callback or b) remove maxBlocksInCache property. Purging has been disabled.")}),"storeFactory.maxBlocksInCache.dynamicRowHeight")}else{if(!this.columnModel.isAutoRowHeightActive())return n;o._.doOnce((function(){return console.warn("AG Grid: Server Side Row Model does not support Auto Row Height and Cache Purging. Either a) remove colDef.autoHeight or b) remove maxBlocksInCache property. Purging has been disabled.")}),"storeFactory.maxBlocksInCache.autoRowHeightActive")}}},e.prototype.getBlockSize=function(e,t){if(e){var o=t&&null!=t.cacheBlockSize?t.cacheBlockSize:this.gridOptionsWrapper.getCacheBlockSize();return null!=o&&o>0?o:100}},e.prototype.getLevelSpecificParams=function(e){var t=this.gridOptionsWrapper.getServerSideGroupLevelParamsFunc();if(t){var o=t({level:e.level+1,parentRowNode:e.level>=0?e:void 0,rowGroupColumns:this.columnModel.getRowGroupColumns(),pivotColumns:this.columnModel.getPivotColumns(),pivotMode:this.columnModel.isPivotMode()});return null!=o.storeType&&(o.infiniteScroll="partial"===o.storeType),o}},e.prototype.isInfiniteScroll=function(e){return e&&null!=e.infiniteScroll?e.infiniteScroll:this.gridOptionsWrapper.isServerSideInfiniteScroll()},F([o.Autowired("gridOptionsWrapper")],e.prototype,"gridOptionsWrapper",void 0),F([o.Autowired("columnModel")],e.prototype,"columnModel",void 0),e=F([o.Bean("ssrmStoreFactory")],e)}(),j=function(e,t,o,r){var n,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,o,s):n(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},W=function(){function e(){}return e.prototype.isSortingWithValueColumn=function(e){for(var t=this.columnModel.getValueColumns().map((function(e){return e.getColId()})),o=0;o<e.length;o++)if(t.indexOf(e[o])>-1)return!0;return!1},e.prototype.isSortingWithSecondaryColumn=function(e){if(!this.columnModel.getSecondaryColumns())return!1;for(var t=this.columnModel.getSecondaryColumns().map((function(e){return e.getColId()})),o=0;o<e.length;o++)if(t.indexOf(e[o])>-1)return!0;return!1},j([o.Autowired("columnModel")],e.prototype,"columnModel",void 0),e=j([o.Bean("ssrmListenerUtils")],e)}(),H={moduleName:o.ModuleNames.ServerSideRowModelModule,rowModels:{serverSide:s},beans:[R,m,d,p,f,v,C,G,W],dependantModules:[r.EnterpriseCoreModule]};exports.ServerSideRowModelModule=H;