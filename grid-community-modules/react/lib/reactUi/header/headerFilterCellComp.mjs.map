{"version":3,"sources":["reactUi/header/headerFilterCellComp.tsx"],"names":[],"mappings":"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","file":"headerFilterCellComp.mjs","sourcesContent":["import React, { memo, useCallback, useContext, useLayoutEffect, useMemo, useRef, useState } from 'react';\nimport { BeansContext } from '../beansContext';\nimport { AgPromise, HeaderFilterCellCtrl, IFloatingFilter, IHeaderFilterCellComp, UserCompDetails } from '@ag-grid-community/core';\nimport { CssClasses, isComponentStateless } from '../utils';\nimport { showJsComp } from '../jsComp';\nimport { FloatingFilterComponentProxy } from '../../shared/customComp/floatingFilterComponentProxy';\nimport { CustomContext } from '../../shared/customComp/customContext';\nimport { CustomFloatingFilterCallbacks } from '../../shared/customComp/interfaces';\nimport { warnReactiveCustomComponents } from '../../shared/customComp/util';\n\nconst HeaderFilterCellComp = (props: {ctrl: HeaderFilterCellCtrl}) => {\n\n    const { context, gridOptionsService } = useContext(BeansContext);\n\n    const [cssClasses, setCssClasses] = useState<CssClasses>(() => new CssClasses('ag-header-cell', 'ag-floating-filter'));\n    const [cssBodyClasses, setBodyCssClasses] = useState<CssClasses>(() => new CssClasses());\n    const [cssButtonWrapperClasses, setButtonWrapperCssClasses] = useState<CssClasses>(() => new CssClasses('ag-floating-filter-button', 'ag-hidden'));\n    const [buttonWrapperAriaHidden, setButtonWrapperAriaHidden] = useState<\"true\" | \"false\">(\"false\");\n    const [userCompDetails, setUserCompDetails] = useState<UserCompDetails | null>();\n    const [renderKey, setRenderKey] = useState<number>(1);\n\n    const eGui = useRef<HTMLDivElement | null>(null);\n    const eFloatingFilterBody = useRef<HTMLDivElement>(null);\n    const eButtonWrapper = useRef<HTMLDivElement>(null);\n    const eButtonShowMainFilter = useRef<HTMLButtonElement>(null);\n\n    const userCompResolve = useRef<(value: IFloatingFilter)=>void>();  \n    const userCompPromise = useRef<AgPromise<IFloatingFilter>>();\n    \n    const userCompRef = (value: IFloatingFilter) => {\n\n        // We skip when it's un-setting\n        if (value == null) {\n            return;\n        }\n\n        userCompResolve.current && userCompResolve.current(value);\n    };\n\n    const { ctrl } = props;\n\n    const setRef = useCallback((e: HTMLDivElement) => {\n        eGui.current = e;\n        if (!eGui.current) {\n            return;\n        }\n\n        userCompPromise.current = new AgPromise<IFloatingFilter>(resolve => {\n            userCompResolve.current = resolve;\n        });\n\n        const compProxy: IHeaderFilterCellComp = {\n            addOrRemoveCssClass: (name, on) => setCssClasses(prev => prev.setClass(name, on)),\n            addOrRemoveBodyCssClass: (name, on) => setBodyCssClasses(prev => prev.setClass(name, on)),\n            setButtonWrapperDisplayed: (displayed) => {\n                setButtonWrapperCssClasses(prev => prev.setClass('ag-hidden', !displayed))\n                setButtonWrapperAriaHidden(!displayed ? \"true\" : \"false\");\n            },\n            setWidth: width => {\n                if (eGui.current) {\n                    eGui.current.style.width = width;\n                }\n            },\n            setCompDetails: compDetails => setUserCompDetails(compDetails),\n            getFloatingFilterComp: ()=> userCompPromise.current ? userCompPromise.current :  null,\n            setMenuIcon: eIcon => eButtonShowMainFilter.current?.appendChild(eIcon)\n        };\n\n        ctrl.setComp(compProxy, eGui.current, eButtonShowMainFilter.current!, eFloatingFilterBody.current!);\n\n    }, []);\n\n\n    // js comps\n    useLayoutEffect(() => showJsComp(userCompDetails, context, eFloatingFilterBody.current!, userCompRef), [userCompDetails]);\n\n    const className = useMemo(() => cssClasses.toString(), [cssClasses] );\n    const bodyClassName = useMemo(() => cssBodyClasses.toString(), [cssBodyClasses] );\n    const buttonWrapperClassName = useMemo(() => cssButtonWrapperClasses.toString(), [cssButtonWrapperClasses] );\n\n    const userCompStateless = useMemo(() => {\n        const res = userCompDetails \n                    && userCompDetails.componentFromFramework \n                    && isComponentStateless(userCompDetails.componentClass);\n        return !!res;\n    }, [userCompDetails]);\n\n\n    const reactiveCustomComponents = useMemo(() => gridOptionsService.get('reactiveCustomComponents'), []);\n    const floatingFilterCompProxy = useMemo(() => {\n        if (userCompDetails) {\n            if (reactiveCustomComponents) {\n                const compProxy = new FloatingFilterComponentProxy(userCompDetails!.params, () => setRenderKey(prev => prev + 1));\n                userCompRef(compProxy);\n                return compProxy;\n            } else if (userCompDetails.componentFromFramework) {\n                warnReactiveCustomComponents();\n            }\n        }\n        return undefined;\n    }, [userCompDetails]);\n    const floatingFilterProps = floatingFilterCompProxy?.getProps();\n\n    const reactUserComp = userCompDetails && userCompDetails.componentFromFramework;\n    const UserCompClass = userCompDetails && userCompDetails.componentClass;\n\n    return (\n        <div ref={setRef} className={className} role=\"gridcell\">\n            <div ref={eFloatingFilterBody} className={bodyClassName} role=\"presentation\">\n                { reactUserComp && !reactiveCustomComponents && <UserCompClass { ...userCompDetails!.params } ref={ userCompStateless ? () => {} : userCompRef }/> }\n                { reactUserComp && reactiveCustomComponents && <CustomContext.Provider value={{\n                    setMethods: (methods: CustomFloatingFilterCallbacks) => floatingFilterCompProxy!.setMethods(methods)\n                }}>\n                    <UserCompClass { ...floatingFilterProps! }/>\n                </CustomContext.Provider> }\n            </div>\n            <div ref={eButtonWrapper} aria-hidden={buttonWrapperAriaHidden} className={buttonWrapperClassName} role=\"presentation\">\n                <button ref={eButtonShowMainFilter} type=\"button\" className=\"ag-button ag-floating-filter-button-button\" tabIndex={-1}></button>\n            </div>\n        </div>\n    );\n};\n\nexport default memo(HeaderFilterCellComp);"]}