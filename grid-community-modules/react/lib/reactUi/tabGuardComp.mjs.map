{"version":3,"sources":["reactUi/tabGuardComp.tsx"],"names":[],"mappings":";AAAA,OAAO,KAAK,EAAE,EAAE,MAAM,EAAuB,UAAU,EAAE,mBAAmB,EAA4B,IAAI,EAAE,UAAU,EAAE,MAAM,OAAO,CAAC;AAExI,OAAO,EACH,YAAY,EAAuB,kBAAkB,EACxD,MAAM,yBAAyB,CAAC;AACjC,OAAO,EAAE,YAAY,EAAE,MAAM,gBAAgB,CAAC;AAC9C,OAAO,EAAE,mBAAmB,EAAE,MAAM,iBAAiB,CAAC;AActD,MAAM,eAAe,GAAkE,CAAC,KAAU,EAAE,UAAe,EAAE,EAAE;IAEnH,MAAM,EAAE,QAAQ,EAAE,iBAAiB,EAAE,YAAY,EAAE,QAAQ,EAAE,GAAG,KAAK,CAAC;IACtE,MAAM,EAAE,OAAO,EAAE,GAAG,UAAU,CAAC,YAAY,CAAC,CAAC;IAE7C,MAAM,cAAc,GAAG,MAAM,CAAiB,IAAI,CAAC,CAAC;IACpD,MAAM,iBAAiB,GAAG,MAAM,CAAiB,IAAI,CAAC,CAAC;IACvD,MAAM,eAAe,GAAG,MAAM,EAAgB,CAAC;IAE/C,MAAM,WAAW,GAAG,CAAC,KAAqB,EAAE,EAAE;QAC1C,MAAM,cAAc,GAAG,KAAK,IAAI,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,QAAQ,EAAE,CAAC;QAElF,CAAC,cAAc,EAAE,iBAAiB,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;;YACnD,IAAI,cAAc,KAAK,SAAS,EAAE;gBAC9B,MAAA,QAAQ,CAAC,OAAO,0CAAE,eAAe,CAAC,UAAU,CAAC,CAAC;aACjD;iBAAM;gBACH,MAAA,QAAQ,CAAC,OAAO,0CAAE,YAAY,CAAC,UAAU,EAAE,cAAc,CAAC,CAAC;aAC9D;QAEL,CAAC,CAAC,CAAA;IACN,CAAC,CAAA;IAED,mBAAmB,CAAC,UAAU,EAAE,GAAG,EAAE,CAAC,CAAC;QACnC,wBAAwB;;YACpB,MAAA,eAAe,CAAC,OAAO,0CAAE,wBAAwB,EAAE,CAAC;QACxD,CAAC;KACJ,CAAC,CAAC,CAAC;IAEJ,mBAAmB,CAAC,GAAG,EAAE;QACrB,MAAM,SAAS,GAAG,cAAc,CAAC,OAAQ,CAAC;QAC1C,MAAM,YAAY,GAAG,iBAAiB,CAAC,OAAQ,CAAC;QAGhD,MAAM,SAAS,GAAc;YACzB,WAAW;SACd,CAAC;QAEF,MAAM,IAAI,GAAG,eAAe,CAAC,OAAO,GAAG,OAAO,CAAC,UAAU,CAAC,IAAI,YAAY,CAAC;YACvE,IAAI,EAAE,SAAS;YACf,SAAS,EAAE,SAAS;YACpB,YAAY,EAAE,YAAY;YAC1B,iBAAiB,EAAE,iBAAiB;YAEpC,YAAY,EAAE,YAAY;YAC1B,iBAAiB,EAAE,UAAU,CAAC,EAAE,CAAC,QAAQ,CAAC,iBAAiB,CAAC,UAAU,CAAC;SAC1E,CAAC,CAAC,CAAC;QAEJ,OAAO,GAAG,EAAE;YACR,OAAO,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;QAC9B,CAAC,CAAC;IAEN,CAAC,CAAC,CAAC;IAEH,MAAM,cAAc,GAAG,CAAC,IAAsB,EAAE,EAAE;QAC9C,MAAM,SAAS,GAAG,IAAI,KAAK,KAAK,CAAC,CAAC,CAAC,kBAAkB,CAAC,aAAa,CAAC,CAAC,CAAC,kBAAkB,CAAC,gBAAgB,CAAC;QAE1G,OAAO,CACH,6BACI,SAAS,EAAG,GAAG,kBAAkB,CAAC,SAAS,IAAI,SAAS,EAAE,EAC1D,IAAI,EAAC,cAAc,EACnB,GAAG,EAAG,IAAI,KAAK,KAAK,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,iBAAiB,GACtD,CACV,CAAC;IACN,CAAC,CAAA;IAED,OAAO,CACH;QACK,cAAc,CAAC,KAAK,CAAC;QACpB,QAAQ;QACT,cAAc,CAAC,QAAQ,CAAC,CAC1B,CACN,CAAA;AACL,CAAC,CAAC;AAEF,MAAM,YAAY,GAAG,UAAU,CAAC,eAAe,CAAC,CAAC;AAEjD,eAAe,IAAI,CAAC,YAAY,CAAC,CAAC","file":"tabGuardComp.mjs","sourcesContent":["import React, { useRef, useEffect, useState, forwardRef, useImperativeHandle, ForwardRefRenderFunction, memo, useContext } from 'react';\n\nimport {\n    TabGuardCtrl, ITabGuard, GridCtrl, TabGuardClassNames\n} from '@ag-grid-community/core';\nimport { BeansContext } from './beansContext';\nimport { useLayoutEffectOnce } from './useEffectOnce';\nimport { agFlushSync } from './utils';\n\nexport interface TabGuardCompCallback {\n    forceFocusOutOfContainer(): void;\n}\n\ninterface TabGuardProps {\n    children: React.ReactNode,\n    eFocusableElement: HTMLDivElement,\n    onTabKeyDown: (e: KeyboardEvent) => void,\n    gridCtrl: GridCtrl,\n}\n\nconst TabGuardCompRef: ForwardRefRenderFunction<TabGuardCompCallback, TabGuardProps> = (props: any, forwardRef: any) => {\n\n    const { children, eFocusableElement, onTabKeyDown, gridCtrl } = props;\n    const { context } = useContext(BeansContext);\n\n    const topTabGuardRef = useRef<HTMLDivElement>(null);\n    const bottomTabGuardRef = useRef<HTMLDivElement>(null);\n    const tabGuardCtrlRef = useRef<TabGuardCtrl>();\n\n    const setTabIndex = (value?: string | null) => {\n        const processedValue = value == null ? undefined : parseInt(value, 10).toString();\n\n        [topTabGuardRef, bottomTabGuardRef].forEach(tabGuard => {\n            if (processedValue === undefined) {\n                tabGuard.current?.removeAttribute('tabindex');\n            } else {\n                tabGuard.current?.setAttribute('tabindex', processedValue);\n            }\n            \n        })\n    }\n\n    useImperativeHandle(forwardRef, () => ({\n        forceFocusOutOfContainer() {\n            tabGuardCtrlRef.current?.forceFocusOutOfContainer();\n        }\n    }));\n\n    useLayoutEffectOnce(() => {\n        const eTopGuard = topTabGuardRef.current!;\n        const eBottomGuard = bottomTabGuardRef.current!;\n\n\n        const compProxy: ITabGuard = {\n            setTabIndex\n        };\n\n        const ctrl = tabGuardCtrlRef.current = context.createBean(new TabGuardCtrl({\n            comp: compProxy,\n            eTopGuard: eTopGuard,\n            eBottomGuard: eBottomGuard,\n            eFocusableElement: eFocusableElement,\n            \n            onTabKeyDown: onTabKeyDown,\n            focusInnerElement: fromBottom => gridCtrl.focusInnerElement(fromBottom)\n        }));\n\n        return () => {\n            context.destroyBean(ctrl);\n        };\n\n    });\n\n    const createTabGuard = (side: 'top' | 'bottom') => {\n        const className = side === 'top' ? TabGuardClassNames.TAB_GUARD_TOP : TabGuardClassNames.TAB_GUARD_BOTTOM;\n\n        return (\n            <div \n                className={ `${TabGuardClassNames.TAB_GUARD} ${className}` }\n                role=\"presentation\"\n                ref={ side === 'top' ? topTabGuardRef : bottomTabGuardRef }\n            ></div>\n        );\n    }\n\n    return (\n        <>\n            {createTabGuard('top')}\n            { children }\n            {createTabGuard('bottom')}\n        </>\n    )\n};\n\nconst TabGuardComp = forwardRef(TabGuardCompRef);\n\nexport default memo(TabGuardComp);\n"]}