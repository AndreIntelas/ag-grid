{"version":3,"sources":["shared/reactComponent.ts"],"names":[],"mappings":"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","file":"reactComponent.mjs","sourcesContent":["import { createElement, ReactPortal } from 'react';\nimport { AgPromise, ComponentType, IComponent, WrappableInterface, _ } from '@ag-grid-community/core';\nimport { PortalManager } from './portalManager';\nimport generateNewKey from './keyGenerator';\nimport { createPortal } from 'react-dom';\nimport { renderToStaticMarkup } from 'react-dom/server';\n\nexport class ReactComponent implements IComponent<any>, WrappableInterface {\n    protected eParentElement!: HTMLElement;\n    protected componentInstance: any;\n    protected reactComponent: any;\n    protected portalManager: PortalManager;\n    protected portal: ReactPortal | null = null;\n    protected statelessComponent: boolean;\n    protected componentType: ComponentType;\n\n    protected key: string;\n    protected ref?: (element: any) => void;\n    private portalKey: string;\n    private oldPortal: ReactPortal | null = null;\n    private reactElement: any;\n    private params: any;\n    protected instanceCreated: AgPromise<boolean>;\n    private resolveInstanceCreated?: (value: boolean) => void;\n    private suppressFallbackMethods: boolean;\n\n    constructor(reactComponent: any, portalManager: PortalManager, componentType: ComponentType, suppressFallbackMethods?: boolean) {\n        this.reactComponent = reactComponent;\n        this.portalManager = portalManager;\n        this.componentType = componentType;\n        this.suppressFallbackMethods = !!suppressFallbackMethods;\n\n        this.statelessComponent = this.isStateless(this.reactComponent);\n\n        this.key = generateNewKey();\n        this.portalKey = generateNewKey();\n\n        this.instanceCreated = this.isStatelessComponent() ? AgPromise.resolve(false) : new AgPromise(resolve => {\n            this.resolveInstanceCreated = resolve;\n        })\n    }\n\n    public getGui(): HTMLElement {\n        return this.eParentElement;\n    }\n\n    /** `getGui()` returns the parent element. This returns the actual root element. */\n    public getRootElement(): HTMLElement {\n        const firstChild = this.eParentElement.firstChild;\n        return firstChild as HTMLElement;\n    }\n\n    public destroy(): void {\n        if (this.componentInstance && typeof this.componentInstance.destroy == 'function') {\n            this.componentInstance.destroy();\n        }\n        return this.portalManager.destroyPortal(this.portal as ReactPortal);\n    }\n\n    protected createParentElement(params: any) {\n        const componentWrappingElement = this.portalManager.getComponentWrappingElement();\n        const eParentElement = document.createElement(componentWrappingElement || 'div');\n\n        (eParentElement as HTMLElement).classList.add('ag-react-container');\n\n        /** @deprecated v21.2 */\n        params.reactContainer = eParentElement;\n\n        return eParentElement;\n    }\n\n    protected addParentContainerStyleAndClasses() {\n        if (!this.componentInstance) {\n            return;\n        }\n\n        if (this.componentInstance.getReactContainerStyle && this.componentInstance.getReactContainerStyle()) {\n            _.warnOnce('Since v31.1 \"getReactContainerStyle\" is deprecated. Apply styling directly to \".ag-react-container\" if needed.');\n            Object.assign(this.eParentElement.style, this.componentInstance.getReactContainerStyle());\n        }\n\n        if (this.componentInstance.getReactContainerClasses && this.componentInstance.getReactContainerClasses()) {\n            _.warnOnce('Since v31.1 \"getReactContainerClasses\" is deprecated. Apply styling directly to \".ag-react-container\" if needed.');\n            const parentContainerClasses: string[] = this.componentInstance.getReactContainerClasses();\n            parentContainerClasses.forEach(className => this.eParentElement.classList.add(className));\n        }\n    }\n\n    public statelessComponentRendered(): boolean {\n        // fixed fragmentsFuncRendererCreateDestroy funcRendererWithNan (changeDetectionService too for NaN)\n        return this.eParentElement.childElementCount > 0 || this.eParentElement.childNodes.length > 0;\n    }\n\n    public getFrameworkComponentInstance(): any {\n        return this.componentInstance;\n    }\n\n    public isStatelessComponent(): boolean {\n        return this.statelessComponent;\n    }\n\n    public getReactComponentName(): string {\n        return this.reactComponent.name;\n    }\n\n    public getMemoType() {\n        return this.hasSymbol() ? Symbol.for('react.memo') : 0xead3;\n    }\n\n    private hasSymbol() {\n        return typeof Symbol === 'function' && Symbol.for;\n    }\n\n    protected isStateless(Component: any) {\n        return (typeof Component === 'function' && !(Component.prototype && Component.prototype.isReactComponent))\n            || (typeof Component === 'object' && Component.$$typeof === this.getMemoType());\n    }\n\n    public hasMethod(name: string): boolean {\n        const frameworkComponentInstance = this.getFrameworkComponentInstance();\n        return (!!frameworkComponentInstance && frameworkComponentInstance[name] != null) ||\n            this.fallbackMethodAvailable(name);\n    }\n\n    public callMethod(name: string, args: IArguments): void {\n        const frameworkComponentInstance = this.getFrameworkComponentInstance();\n\n        if (this.isStatelessComponent()) {\n            return this.fallbackMethod(name, !!args && args[0] ? args[0] : {});\n        } else if (!(!!frameworkComponentInstance)) {\n            // instance not ready yet - wait for it\n            setTimeout(() => this.callMethod(name, args));\n            return;\n        }\n\n        const method = frameworkComponentInstance[name];\n\n        if (!!method) {\n            return method.apply(frameworkComponentInstance, args);\n        }\n\n        if (this.fallbackMethodAvailable(name)) {\n            return this.fallbackMethod(name, !!args && args[0] ? args[0] : {});\n        }\n    }\n\n    public addMethod(name: string, callback: Function): void {\n        (this as any)[name] = callback;\n    }\n\n    public init(params: any): AgPromise<void> {\n        this.eParentElement = this.createParentElement(params);\n        this.params = params;\n\n        this.createOrUpdatePortal(params);\n\n        return new AgPromise<void>(resolve => this.createReactComponent(resolve));\n    }\n\n    private createOrUpdatePortal(params: any) {\n        if (!this.isStatelessComponent()) {\n            // grab hold of the actual instance created\n            this.ref = (element: any) => {\n                this.componentInstance = element;\n                this.addParentContainerStyleAndClasses();\n                this.resolveInstanceCreated?.(true);\n                this.resolveInstanceCreated = undefined;\n            };\n            params.ref = this.ref;\n        }\n\n        this.reactElement = this.createElement(this.reactComponent, { ...params, key: this.key });\n\n        this.portal = createPortal(\n            this.reactElement,\n            this.eParentElement as any,\n            this.portalKey // fixed deltaRowModeRefreshCompRenderer\n        );\n    }\n\n    protected createElement(reactComponent: any, props: any): any {\n        return createElement(reactComponent, props);\n    }\n\n    private createReactComponent(resolve: (value: any) => void) {\n        this.portalManager.mountReactPortal(this.portal!, this, (value: any) => {\n            resolve(value);\n        });\n    }\n\n    public isNullValue(): boolean {\n        return this.valueRenderedIsNull(this.params);\n    }\n\n    public rendered(): boolean {\n        return (this.isStatelessComponent() && this.statelessComponentRendered()) ||\n            !!(!this.isStatelessComponent() && this.getFrameworkComponentInstance());\n    }\n\n    private valueRenderedIsNull(params: any): boolean {\n        // we only do this for cellRenderers\n        if (!this.componentType.cellRenderer) {\n            return false;\n        }\n\n        // we've no way of knowing if a component returns null without rendering it first\n        // so we render it to markup and check the output - if it'll be null we know and won't timeout\n        // waiting for a component that will never be created\n\n        const originalConsoleError = console.error;\n        try {\n            // if a user is doing anything that uses useLayoutEffect (like material ui) then it will throw and we\n            // can't do anything to stop it; this is just a warning and has no effect on anything so just suppress it\n            // for this single operation\n            console.error = () => {\n            };\n            const staticMarkup = renderToStaticMarkup(createElement(this.reactComponent, params));\n            return staticMarkup === '';\n        } catch (ignore) {\n        } finally {\n            console.error = originalConsoleError;\n        }\n\n        return false;\n    }\n\n    /*\n    * fallback methods - these will be invoked if a corresponding instance method is not present\n    * for example if refresh is called and is not available on the component instance, then refreshComponent on this\n    * class will be invoked instead\n    *\n    * Currently only refresh is supported\n    */\n    protected refreshComponent(args: any): void {\n        this.oldPortal = this.portal;\n        this.createOrUpdatePortal(args);\n        this.portalManager.updateReactPortal(this.oldPortal!, this.portal!);\n    }\n\n    protected fallbackMethod(name: string, params: any): any {\n        const method = (this as any)[`${name}Component`];\n        if (!this.suppressFallbackMethods && !!method) {\n            return method.bind(this)(params);\n        }\n    }\n\n    protected fallbackMethodAvailable(name: string): boolean {\n        if (this.suppressFallbackMethods) { return false; }\n        const method = (this as any)[`${name}Component`];\n        return !!method;\n    }\n}\n"]}